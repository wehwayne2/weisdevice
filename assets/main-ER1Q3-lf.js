import{C as Cn,V as b,M as ce,T as le,Q as Ne,S as Bt,a as k,R as Nn,P as Fn,b as Fe,L as sn,F as He,c as K,d as V,B as on,e as ye,f as G,g as gt,h as Hn,i as yt,j as rn,k as Te,l as X,m as Bn,n as Un,D as Gn,o as Be,I as jn,p as Kn,O as an,q as ln,r as zn,s as Vn,t as cn,N as Xn,u as Yn,v as qn,w as Q,x as un,y as we,z as Wn,A as Jn,E as Zn,G as ot,H as Qn,J as bt,K as dn,U as te,W as $n,X as es,Y as Se,Z as ts,_ as ns,$ as ss,a0 as os,a1 as it,a2 as fn,a3 as is,a4 as rs,a5 as as,a6 as ls,a7 as cs,a8 as hn,a9 as us,aa as Ut,ab as Gt,ac as jt,ad as Kt,ae as ds,af as fs,ag as hs,ah as ps,ai as _s,aj as ms,ak as L,al as gs,am as ys,an as Ye,ao as qe,ap as rt,aq as Ts,ar as vs}from"./vendor-xVeN9iEI.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();const zt={type:"change"},At={type:"start"},pn={type:"end"},De=new Nn,Vt=new Fn,ws=Math.cos(70*Fe.DEG2RAD),xs=new b(-3,-1,-4),bs=new b(2,5,8),S=new b,I=2*Math.PI,A={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},at=1e-6;class As extends Cn{constructor(n,t=null){super(n,t),this.state=A.NONE,this.enabled=!0,this.target=new b,this.cursor=new b,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ce.ROTATE,MIDDLE:ce.DOLLY,RIGHT:ce.PAN},this.touches={ONE:le.ROTATE,TWO:le.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new b,this._lastQuaternion=new Ne,this._lastTargetPosition=new b,this._quat=new Ne().setFromUnitVectors(n.up,new b(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Bt,this._sphericalDelta=new Bt,this._scale=1,this._panOffset=new b,this._rotateStart=new k,this._rotateEnd=new k,this._rotateDelta=new k,this._panStart=new k,this._panEnd=new k,this._panDelta=new k,this._dollyStart=new k,this._dollyEnd=new k,this._dollyDelta=new k,this._dollyDirection=new b,this._mouse=new k,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=Ss.bind(this),this._onPointerDown=Es.bind(this),this._onPointerUp=Ls.bind(this),this._onContextMenu=Os.bind(this),this._onMouseWheel=Ms.bind(this),this._onKeyDown=Ps.bind(this),this._onTouchStart=Is.bind(this),this._onTouchMove=ks.bind(this),this._onMouseDown=Ds.bind(this),this._onMouseMove=Rs.bind(this),this._interceptControlDown=Cs.bind(this),this._interceptControlUp=Ns.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(n){n.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=n}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(zt),this.update(),this.state=A.NONE}update(n=null){const t=this.object.position;S.copy(t).sub(this.target),S.applyQuaternion(this._quat),this._spherical.setFromVector3(S),this.autoRotate&&this.state===A.NONE&&this._rotateLeft(this._getAutoRotationAngle(n)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let s=this.minAzimuthAngle,o=this.maxAzimuthAngle;isFinite(s)&&isFinite(o)&&(s<-Math.PI?s+=I:s>Math.PI&&(s-=I),o<-Math.PI?o+=I:o>Math.PI&&(o-=I),s<=o?this._spherical.theta=Math.max(s,Math.min(o,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(s+o)/2?Math.max(s,this._spherical.theta):Math.min(o,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.clamp(xs,bs),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let a=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const r=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),a=r!=this._spherical.radius}if(S.setFromSpherical(this._spherical),S.applyQuaternion(this._quatInverse),t.copy(this.target).add(S),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let r=null;if(this.object.isPerspectiveCamera){const u=S.length();r=this._clampDistance(u*this._scale);const c=u-r;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),a=!!c}else if(this.object.isOrthographicCamera){const u=new b(this._mouse.x,this._mouse.y,0);u.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),a=c!==this.object.zoom;const f=new b(this._mouse.x,this._mouse.y,0);f.unproject(this.object),this.object.position.sub(f).add(u),this.object.updateMatrixWorld(),r=S.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;r!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(r).add(this.object.position):(De.origin.copy(this.object.position),De.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(De.direction))<ws?this.object.lookAt(this.target):(Vt.setFromNormalAndCoplanarPoint(this.object.up,this.target),De.intersectPlane(Vt,this.target))))}else if(this.object.isOrthographicCamera){const r=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),r!==this.object.zoom&&(this.object.updateProjectionMatrix(),a=!0)}return this._scale=1,this._performCursorZoom=!1,a||this._lastPosition.distanceToSquared(this.object.position)>at||8*(1-this._lastQuaternion.dot(this.object.quaternion))>at||this._lastTargetPosition.distanceToSquared(this.target)>at?(this.dispatchEvent(zt),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(n){return n!==null?I/60*this.autoRotateSpeed*n:I/60/60*this.autoRotateSpeed}_getZoomScale(n){const t=Math.abs(n*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(n){this._sphericalDelta.theta-=n}_rotateUp(n){this._sphericalDelta.phi-=n}_panLeft(n,t){S.setFromMatrixColumn(t,0),S.multiplyScalar(-n),this._panOffset.add(S)}_panUp(n,t){this.screenSpacePanning===!0?S.setFromMatrixColumn(t,1):(S.setFromMatrixColumn(t,0),S.crossVectors(this.object.up,S)),S.multiplyScalar(n),this._panOffset.add(S)}_pan(n,t){const s=this.domElement;if(this.object.isPerspectiveCamera){const o=this.object.position;S.copy(o).sub(this.target);let a=S.length();a*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*n*a/s.clientHeight,this.object.matrix),this._panUp(2*t*a/s.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(n*(this.object.right-this.object.left)/this.object.zoom/s.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/s.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(n){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=n:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(n){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=n:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(n,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const s=this.domElement.getBoundingClientRect(),o=n-s.left,a=t-s.top,r=s.width,u=s.height;this._mouse.x=o/r*2-1,this._mouse.y=-(a/u)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(n){return Math.max(this.minDistance,Math.min(this.maxDistance,n))}_handleMouseDownRotate(n){this._rotateStart.set(n.clientX,n.clientY)}_handleMouseDownDolly(n){this._updateZoomParameters(n.clientX,n.clientX),this._dollyStart.set(n.clientX,n.clientY)}_handleMouseDownPan(n){this._panStart.set(n.clientX,n.clientY)}_handleMouseMoveRotate(n){this._rotateEnd.set(n.clientX,n.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(I*this._rotateDelta.x/t.clientHeight),this._rotateUp(I*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(n){this._dollyEnd.set(n.clientX,n.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(n){this._panEnd.set(n.clientX,n.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(n){this._updateZoomParameters(n.clientX,n.clientY),n.deltaY<0?this._dollyIn(this._getZoomScale(n.deltaY)):n.deltaY>0&&this._dollyOut(this._getZoomScale(n.deltaY)),this.update()}_handleKeyDown(n){let t=!1;switch(n.code){case this.keys.UP:n.ctrlKey||n.metaKey||n.shiftKey?this.enableRotate&&this._rotateUp(I*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:n.ctrlKey||n.metaKey||n.shiftKey?this.enableRotate&&this._rotateUp(-I*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:n.ctrlKey||n.metaKey||n.shiftKey?this.enableRotate&&this._rotateLeft(I*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:n.ctrlKey||n.metaKey||n.shiftKey?this.enableRotate&&this._rotateLeft(-I*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(n.preventDefault(),this.update())}_handleTouchStartRotate(n){if(this._pointers.length===1)this._rotateStart.set(n.pageX,n.pageY);else{const t=this._getSecondPointerPosition(n),s=.5*(n.pageX+t.x),o=.5*(n.pageY+t.y);this._rotateStart.set(s,o)}}_handleTouchStartPan(n){if(this._pointers.length===1)this._panStart.set(n.pageX,n.pageY);else{const t=this._getSecondPointerPosition(n),s=.5*(n.pageX+t.x),o=.5*(n.pageY+t.y);this._panStart.set(s,o)}}_handleTouchStartDolly(n){const t=this._getSecondPointerPosition(n),s=n.pageX-t.x,o=n.pageY-t.y,a=Math.sqrt(s*s+o*o);this._dollyStart.set(0,a)}_handleTouchStartDollyPan(n){this.enableZoom&&this._handleTouchStartDolly(n),this.enablePan&&this._handleTouchStartPan(n)}_handleTouchStartDollyRotate(n){this.enableZoom&&this._handleTouchStartDolly(n),this.enableRotate&&this._handleTouchStartRotate(n)}_handleTouchMoveRotate(n){if(this._pointers.length==1)this._rotateEnd.set(n.pageX,n.pageY);else{const s=this._getSecondPointerPosition(n),o=.5*(n.pageX+s.x),a=.5*(n.pageY+s.y);this._rotateEnd.set(o,a)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(I*this._rotateDelta.x/t.clientHeight),this._rotateUp(I*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(n){if(this._pointers.length===1)this._panEnd.set(n.pageX,n.pageY);else{const t=this._getSecondPointerPosition(n),s=.5*(n.pageX+t.x),o=.5*(n.pageY+t.y);this._panEnd.set(s,o)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(n){const t=this._getSecondPointerPosition(n),s=n.pageX-t.x,o=n.pageY-t.y,a=Math.sqrt(s*s+o*o);this._dollyEnd.set(0,a),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const r=(n.pageX+t.x)*.5,u=(n.pageY+t.y)*.5;this._updateZoomParameters(r,u)}_handleTouchMoveDollyPan(n){this.enableZoom&&this._handleTouchMoveDolly(n),this.enablePan&&this._handleTouchMovePan(n)}_handleTouchMoveDollyRotate(n){this.enableZoom&&this._handleTouchMoveDolly(n),this.enableRotate&&this._handleTouchMoveRotate(n)}_addPointer(n){this._pointers.push(n.pointerId)}_removePointer(n){delete this._pointerPositions[n.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==n.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(n){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==n.pointerId)return!0;return!1}_trackPointer(n){let t=this._pointerPositions[n.pointerId];t===void 0&&(t=new k,this._pointerPositions[n.pointerId]=t),t.set(n.pageX,n.pageY)}_getSecondPointerPosition(n){const t=n.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(n){const t=n.deltaMode,s={clientX:n.clientX,clientY:n.clientY,deltaY:n.deltaY};switch(t){case 1:s.deltaY*=16;break;case 2:s.deltaY*=100;break}return n.ctrlKey&&!this._controlActive&&(s.deltaY*=10),s}}function Es(d){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(d.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(d)&&(this._addPointer(d),d.pointerType==="touch"?this._onTouchStart(d):this._onMouseDown(d)))}function Ss(d){this.enabled!==!1&&(d.pointerType==="touch"?this._onTouchMove(d):this._onMouseMove(d))}function Ls(d){switch(this._removePointer(d),this._pointers.length){case 0:this.domElement.releasePointerCapture(d.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(pn),this.state=A.NONE;break;case 1:const n=this._pointers[0],t=this._pointerPositions[n];this._onTouchStart({pointerId:n,pageX:t.x,pageY:t.y});break}}function Ds(d){let n;switch(d.button){case 0:n=this.mouseButtons.LEFT;break;case 1:n=this.mouseButtons.MIDDLE;break;case 2:n=this.mouseButtons.RIGHT;break;default:n=-1}switch(n){case ce.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(d),this.state=A.DOLLY;break;case ce.ROTATE:if(d.ctrlKey||d.metaKey||d.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(d),this.state=A.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(d),this.state=A.ROTATE}break;case ce.PAN:if(d.ctrlKey||d.metaKey||d.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(d),this.state=A.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(d),this.state=A.PAN}break;default:this.state=A.NONE}this.state!==A.NONE&&this.dispatchEvent(At)}function Rs(d){switch(this.state){case A.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(d);break;case A.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(d);break;case A.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(d);break}}function Ms(d){this.enabled===!1||this.enableZoom===!1||this.state!==A.NONE||(d.preventDefault(),this.dispatchEvent(At),this._handleMouseWheel(this._customWheelEvent(d)),this.dispatchEvent(pn))}function Ps(d){this.enabled!==!1&&this._handleKeyDown(d)}function Is(d){switch(this._trackPointer(d),this._pointers.length){case 1:switch(this.touches.ONE){case le.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(d),this.state=A.TOUCH_ROTATE;break;case le.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(d),this.state=A.TOUCH_PAN;break;default:this.state=A.NONE}break;case 2:switch(this.touches.TWO){case le.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(d),this.state=A.TOUCH_DOLLY_PAN;break;case le.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(d),this.state=A.TOUCH_DOLLY_ROTATE;break;default:this.state=A.NONE}break;default:this.state=A.NONE}this.state!==A.NONE&&this.dispatchEvent(At)}function ks(d){switch(this._trackPointer(d),this.state){case A.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(d),this.update();break;case A.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(d),this.update();break;case A.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(d),this.update();break;case A.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(d),this.update();break;default:this.state=A.NONE}}function Os(d){this.enabled!==!1&&d.preventDefault()}function Cs(d){d.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Ns(d){d.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const lt=new WeakMap;class Fs extends sn{constructor(n){super(n),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(n){return this.decoderPath=n,this}setDecoderConfig(n){return this.decoderConfig=n,this}setWorkerLimit(n){return this.workerLimit=n,this}load(n,t,s,o){const a=new He(this.manager);a.setPath(this.path),a.setResponseType("arraybuffer"),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(n,r=>{this.parse(r,t,o)},s,o)}parse(n,t,s=()=>{}){this.decodeDracoFile(n,t,null,null,K,s).catch(s)}decodeDracoFile(n,t,s,o,a=V,r=()=>{}){const u={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:o||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:a};return this.decodeGeometry(n,u).then(t).catch(r)}decodeGeometry(n,t){const s=JSON.stringify(t);if(lt.has(n)){const c=lt.get(n);if(c.key===s)return c.promise;if(n.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let o;const a=this.workerNextTaskID++,r=n.byteLength,u=this._getWorker(a,r).then(c=>(o=c,new Promise((f,_)=>{o._callbacks[a]={resolve:f,reject:_},o.postMessage({type:"decode",id:a,taskConfig:t,buffer:n},[n])}))).then(c=>this._createGeometry(c.geometry));return u.catch(()=>!0).then(()=>{o&&a&&this._releaseTask(o,a)}),lt.set(n,{key:s,promise:u}),u}_createGeometry(n){const t=new on;n.index&&t.setIndex(new ye(n.index.array,1));for(let s=0;s<n.attributes.length;s++){const o=n.attributes[s],a=o.name,r=o.array,u=o.itemSize,c=new ye(r,u);a==="color"&&(this._assignVertexColorSpace(c,o.vertexColorSpace),c.normalized=!(r instanceof Float32Array)),t.setAttribute(a,c)}return t}_assignVertexColorSpace(n,t){if(t!==K)return;const s=new G;for(let o=0,a=n.count;o<a;o++)s.fromBufferAttribute(n,o),gt.toWorkingColorSpace(s,K),n.setXYZ(o,s.r,s.g,s.b)}_loadLibrary(n,t){const s=new He(this.manager);return s.setPath(this.decoderPath),s.setResponseType(t),s.setWithCredentials(this.withCredentials),new Promise((o,a)=>{s.load(n,o,void 0,a)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const n=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return n?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(s=>{const o=s[0];n||(this.decoderConfig.wasmBinary=s[1]);const a=Hs.toString(),r=["/* draco decoder */",o,"","/* worker */",a.substring(a.indexOf("{")+1,a.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([r]))}),this.decoderPending}_getWorker(n,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const o=new Worker(this.workerSourceURL);o._callbacks={},o._taskCosts={},o._taskLoad=0,o.postMessage({type:"init",decoderConfig:this.decoderConfig}),o.onmessage=function(a){const r=a.data;switch(r.type){case"decode":o._callbacks[r.id].resolve(r);break;case"error":o._callbacks[r.id].reject(r);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+r.type+'"')}},this.workerPool.push(o)}else this.workerPool.sort(function(o,a){return o._taskLoad>a._taskLoad?-1:1});const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[n]=t,s._taskLoad+=t,s})}_releaseTask(n,t){n._taskLoad-=n._taskCosts[t],delete n._callbacks[t],delete n._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(n=>n._taskLoad))}dispose(){for(let n=0;n<this.workerPool.length;++n)this.workerPool[n].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function Hs(){let d,n;onmessage=function(r){const u=r.data;switch(u.type){case"init":d=u.decoderConfig,n=new Promise(function(_){d.onModuleLoaded=function(e){_({draco:e})},DracoDecoderModule(d)});break;case"decode":const c=u.buffer,f=u.taskConfig;n.then(_=>{const e=_.draco,i=new e.Decoder;try{const l=t(e,i,new Int8Array(c),f),h=l.attributes.map(g=>g.array.buffer);l.index&&h.push(l.index.array.buffer),self.postMessage({type:"decode",id:u.id,geometry:l},h)}catch(l){console.error(l),self.postMessage({type:"error",id:u.id,error:l.message})}finally{e.destroy(i)}});break}};function t(r,u,c,f){const _=f.attributeIDs,e=f.attributeTypes;let i,l;const h=u.GetEncodedGeometryType(c);if(h===r.TRIANGULAR_MESH)i=new r.Mesh,l=u.DecodeArrayToMesh(c,c.byteLength,i);else if(h===r.POINT_CLOUD)i=new r.PointCloud,l=u.DecodeArrayToPointCloud(c,c.byteLength,i);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!l.ok()||i.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+l.error_msg());const g={index:null,attributes:[]};for(const m in _){const p=self[e[m]];let y,T;if(f.useUniqueIDs)T=_[m],y=u.GetAttributeByUniqueId(i,T);else{if(T=u.GetAttributeId(i,r[_[m]]),T===-1)continue;y=u.GetAttribute(i,T)}const v=o(r,u,i,m,p,y);m==="color"&&(v.vertexColorSpace=f.vertexColorSpace),g.attributes.push(v)}return h===r.TRIANGULAR_MESH&&(g.index=s(r,u,i)),r.destroy(i),g}function s(r,u,c){const _=c.num_faces()*3,e=_*4,i=r._malloc(e);u.GetTrianglesUInt32Array(c,e,i);const l=new Uint32Array(r.HEAPF32.buffer,i,_).slice();return r._free(i),{array:l,itemSize:1}}function o(r,u,c,f,_,e){const i=e.num_components(),h=c.num_points()*i,g=h*_.BYTES_PER_ELEMENT,m=a(r,_),p=r._malloc(g);u.GetAttributeDataArrayForAllPoints(c,e,m,g,p);const y=new _(r.HEAPF32.buffer,p,h).slice();return r._free(p),{name:f,array:y,itemSize:i}}function a(r,u){switch(u){case Float32Array:return r.DT_FLOAT32;case Int8Array:return r.DT_INT8;case Int16Array:return r.DT_INT16;case Int32Array:return r.DT_INT32;case Uint8Array:return r.DT_UINT8;case Uint16Array:return r.DT_UINT16;case Uint32Array:return r.DT_UINT32}}}function Xt(d,n){if(n===Hn)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),d;if(n===yt||n===rn){let t=d.getIndex();if(t===null){const r=[],u=d.getAttribute("position");if(u!==void 0){for(let c=0;c<u.count;c++)r.push(c);d.setIndex(r),t=d.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),d}const s=t.count-2,o=[];if(n===yt)for(let r=1;r<=s;r++)o.push(t.getX(0)),o.push(t.getX(r)),o.push(t.getX(r+1));else for(let r=0;r<s;r++)r%2===0?(o.push(t.getX(r)),o.push(t.getX(r+1)),o.push(t.getX(r+2))):(o.push(t.getX(r+2)),o.push(t.getX(r+1)),o.push(t.getX(r)));o.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const a=d.clone();return a.setIndex(o),a.clearGroups(),a}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",n),d}class Bs extends sn{constructor(n){super(n),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new zs(t)}),this.register(function(t){return new Vs(t)}),this.register(function(t){return new eo(t)}),this.register(function(t){return new to(t)}),this.register(function(t){return new no(t)}),this.register(function(t){return new Ys(t)}),this.register(function(t){return new qs(t)}),this.register(function(t){return new Ws(t)}),this.register(function(t){return new Js(t)}),this.register(function(t){return new Ks(t)}),this.register(function(t){return new Zs(t)}),this.register(function(t){return new Xs(t)}),this.register(function(t){return new $s(t)}),this.register(function(t){return new Qs(t)}),this.register(function(t){return new Gs(t)}),this.register(function(t){return new so(t)}),this.register(function(t){return new oo(t)})}load(n,t,s,o){const a=this;let r;if(this.resourcePath!=="")r=this.resourcePath;else if(this.path!==""){const f=Te.extractUrlBase(n);r=Te.resolveURL(f,this.path)}else r=Te.extractUrlBase(n);this.manager.itemStart(n);const u=function(f){o?o(f):console.error(f),a.manager.itemError(n),a.manager.itemEnd(n)},c=new He(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(n,function(f){try{a.parse(f,r,function(_){t(_),a.manager.itemEnd(n)},u)}catch(_){u(_)}},s,u)}setDRACOLoader(n){return this.dracoLoader=n,this}setKTX2Loader(n){return this.ktx2Loader=n,this}setMeshoptDecoder(n){return this.meshoptDecoder=n,this}register(n){return this.pluginCallbacks.indexOf(n)===-1&&this.pluginCallbacks.push(n),this}unregister(n){return this.pluginCallbacks.indexOf(n)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(n),1),this}parse(n,t,s,o){let a;const r={},u={},c=new TextDecoder;if(typeof n=="string")a=JSON.parse(n);else if(n instanceof ArrayBuffer)if(c.decode(new Uint8Array(n,0,4))===_n){try{r[w.KHR_BINARY_GLTF]=new io(n)}catch(e){o&&o(e);return}a=JSON.parse(r[w.KHR_BINARY_GLTF].content)}else a=JSON.parse(c.decode(n));else a=n;if(a.asset===void 0||a.asset.version[0]<2){o&&o(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const f=new To(a,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});f.fileLoader.setRequestHeader(this.requestHeader);for(let _=0;_<this.pluginCallbacks.length;_++){const e=this.pluginCallbacks[_](f);e.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),u[e.name]=e,r[e.name]=!0}if(a.extensionsUsed)for(let _=0;_<a.extensionsUsed.length;++_){const e=a.extensionsUsed[_],i=a.extensionsRequired||[];switch(e){case w.KHR_MATERIALS_UNLIT:r[e]=new js;break;case w.KHR_DRACO_MESH_COMPRESSION:r[e]=new ro(a,this.dracoLoader);break;case w.KHR_TEXTURE_TRANSFORM:r[e]=new ao;break;case w.KHR_MESH_QUANTIZATION:r[e]=new lo;break;default:i.indexOf(e)>=0&&u[e]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+e+'".')}}f.setExtensions(r),f.setPlugins(u),f.parse(s,o)}parseAsync(n,t){const s=this;return new Promise(function(o,a){s.parse(n,t,o,a)})}}function Us(){let d={};return{get:function(n){return d[n]},add:function(n,t){d[n]=t},remove:function(n){delete d[n]},removeAll:function(){d={}}}}const w={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class Gs{constructor(n){this.parser=n,this.name=w.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const n=this.parser,t=this.parser.json.nodes||[];for(let s=0,o=t.length;s<o;s++){const a=t[s];a.extensions&&a.extensions[this.name]&&a.extensions[this.name].light!==void 0&&n._addNodeRef(this.cache,a.extensions[this.name].light)}}_loadLight(n){const t=this.parser,s="light:"+n;let o=t.cache.get(s);if(o)return o;const a=t.json,c=((a.extensions&&a.extensions[this.name]||{}).lights||[])[n];let f;const _=new G(16777215);c.color!==void 0&&_.setRGB(c.color[0],c.color[1],c.color[2],V);const e=c.range!==void 0?c.range:0;switch(c.type){case"directional":f=new Gn(_),f.target.position.set(0,0,-1),f.add(f.target);break;case"point":f=new Un(_),f.distance=e;break;case"spot":f=new Bn(_),f.distance=e,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,f.angle=c.spot.outerConeAngle,f.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,f.target.position.set(0,0,-1),f.add(f.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return f.position.set(0,0,0),W(f,c),c.intensity!==void 0&&(f.intensity=c.intensity),f.name=t.createUniqueName(c.name||"light_"+n),o=Promise.resolve(f),t.cache.add(s,o),o}getDependency(n,t){if(n==="light")return this._loadLight(t)}createNodeAttachment(n){const t=this,s=this.parser,a=s.json.nodes[n],u=(a.extensions&&a.extensions[this.name]||{}).light;return u===void 0?null:this._loadLight(u).then(function(c){return s._getNodeRef(t.cache,u,c)})}}class js{constructor(){this.name=w.KHR_MATERIALS_UNLIT}getMaterialType(){return te}extendParams(n,t,s){const o=[];n.color=new G(1,1,1),n.opacity=1;const a=t.pbrMetallicRoughness;if(a){if(Array.isArray(a.baseColorFactor)){const r=a.baseColorFactor;n.color.setRGB(r[0],r[1],r[2],V),n.opacity=r[3]}a.baseColorTexture!==void 0&&o.push(s.assignTexture(n,"map",a.baseColorTexture,K))}return Promise.all(o)}}class Ks{constructor(n){this.parser=n,this.name=w.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(n,t){const o=this.parser.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=o.extensions[this.name].emissiveStrength;return a!==void 0&&(t.emissiveIntensity=a),Promise.resolve()}}class zs{constructor(n){this.parser=n,this.name=w.KHR_MATERIALS_CLEARCOAT}getMaterialType(n){const s=this.parser.json.materials[n];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(n,t){const s=this.parser,o=s.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],r=o.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&a.push(s.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&a.push(s.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(a.push(s.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const u=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new k(u,u)}return Promise.all(a)}}class Vs{constructor(n){this.parser=n,this.name=w.KHR_MATERIALS_DISPERSION}getMaterialType(n){const s=this.parser.json.materials[n];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(n,t){const o=this.parser.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=o.extensions[this.name];return t.dispersion=a.dispersion!==void 0?a.dispersion:0,Promise.resolve()}}class Xs{constructor(n){this.parser=n,this.name=w.KHR_MATERIALS_IRIDESCENCE}getMaterialType(n){const s=this.parser.json.materials[n];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(n,t){const s=this.parser,o=s.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],r=o.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&a.push(s.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&a.push(s.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(a)}}class Ys{constructor(n){this.parser=n,this.name=w.KHR_MATERIALS_SHEEN}getMaterialType(n){const s=this.parser.json.materials[n];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(n,t){const s=this.parser,o=s.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[];t.sheenColor=new G(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=o.extensions[this.name];if(r.sheenColorFactor!==void 0){const u=r.sheenColorFactor;t.sheenColor.setRGB(u[0],u[1],u[2],V)}return r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&a.push(s.assignTexture(t,"sheenColorMap",r.sheenColorTexture,K)),r.sheenRoughnessTexture!==void 0&&a.push(s.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(a)}}class qs{constructor(n){this.parser=n,this.name=w.KHR_MATERIALS_TRANSMISSION}getMaterialType(n){const s=this.parser.json.materials[n];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(n,t){const s=this.parser,o=s.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],r=o.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&a.push(s.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(a)}}class Ws{constructor(n){this.parser=n,this.name=w.KHR_MATERIALS_VOLUME}getMaterialType(n){const s=this.parser.json.materials[n];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(n,t){const s=this.parser,o=s.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],r=o.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&a.push(s.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||1/0;const u=r.attenuationColor||[1,1,1];return t.attenuationColor=new G().setRGB(u[0],u[1],u[2],V),Promise.all(a)}}class Js{constructor(n){this.parser=n,this.name=w.KHR_MATERIALS_IOR}getMaterialType(n){const s=this.parser.json.materials[n];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(n,t){const o=this.parser.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=o.extensions[this.name];return t.ior=a.ior!==void 0?a.ior:1.5,Promise.resolve()}}class Zs{constructor(n){this.parser=n,this.name=w.KHR_MATERIALS_SPECULAR}getMaterialType(n){const s=this.parser.json.materials[n];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(n,t){const s=this.parser,o=s.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],r=o.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&a.push(s.assignTexture(t,"specularIntensityMap",r.specularTexture));const u=r.specularColorFactor||[1,1,1];return t.specularColor=new G().setRGB(u[0],u[1],u[2],V),r.specularColorTexture!==void 0&&a.push(s.assignTexture(t,"specularColorMap",r.specularColorTexture,K)),Promise.all(a)}}class Qs{constructor(n){this.parser=n,this.name=w.EXT_MATERIALS_BUMP}getMaterialType(n){const s=this.parser.json.materials[n];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(n,t){const s=this.parser,o=s.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],r=o.extensions[this.name];return t.bumpScale=r.bumpFactor!==void 0?r.bumpFactor:1,r.bumpTexture!==void 0&&a.push(s.assignTexture(t,"bumpMap",r.bumpTexture)),Promise.all(a)}}class $s{constructor(n){this.parser=n,this.name=w.KHR_MATERIALS_ANISOTROPY}getMaterialType(n){const s=this.parser.json.materials[n];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(n,t){const s=this.parser,o=s.json.materials[n];if(!o.extensions||!o.extensions[this.name])return Promise.resolve();const a=[],r=o.extensions[this.name];return r.anisotropyStrength!==void 0&&(t.anisotropy=r.anisotropyStrength),r.anisotropyRotation!==void 0&&(t.anisotropyRotation=r.anisotropyRotation),r.anisotropyTexture!==void 0&&a.push(s.assignTexture(t,"anisotropyMap",r.anisotropyTexture)),Promise.all(a)}}class eo{constructor(n){this.parser=n,this.name=w.KHR_TEXTURE_BASISU}loadTexture(n){const t=this.parser,s=t.json,o=s.textures[n];if(!o.extensions||!o.extensions[this.name])return null;const a=o.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(n,a.source,r)}}class to{constructor(n){this.parser=n,this.name=w.EXT_TEXTURE_WEBP}loadTexture(n){const t=this.name,s=this.parser,o=s.json,a=o.textures[n];if(!a.extensions||!a.extensions[t])return null;const r=a.extensions[t],u=o.images[r.source];let c=s.textureLoader;if(u.uri){const f=s.options.manager.getHandler(u.uri);f!==null&&(c=f)}return s.loadTextureImage(n,r.source,c)}}class no{constructor(n){this.parser=n,this.name=w.EXT_TEXTURE_AVIF}loadTexture(n){const t=this.name,s=this.parser,o=s.json,a=o.textures[n];if(!a.extensions||!a.extensions[t])return null;const r=a.extensions[t],u=o.images[r.source];let c=s.textureLoader;if(u.uri){const f=s.options.manager.getHandler(u.uri);f!==null&&(c=f)}return s.loadTextureImage(n,r.source,c)}}class so{constructor(n){this.name=w.EXT_MESHOPT_COMPRESSION,this.parser=n}loadBufferView(n){const t=this.parser.json,s=t.bufferViews[n];if(s.extensions&&s.extensions[this.name]){const o=s.extensions[this.name],a=this.parser.getDependency("buffer",o.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return a.then(function(u){const c=o.byteOffset||0,f=o.byteLength||0,_=o.count,e=o.byteStride,i=new Uint8Array(u,c,f);return r.decodeGltfBufferAsync?r.decodeGltfBufferAsync(_,e,i,o.mode,o.filter).then(function(l){return l.buffer}):r.ready.then(function(){const l=new ArrayBuffer(_*e);return r.decodeGltfBuffer(new Uint8Array(l),_,e,i,o.mode,o.filter),l})})}else return null}}class oo{constructor(n){this.name=w.EXT_MESH_GPU_INSTANCING,this.parser=n}createNodeMesh(n){const t=this.parser.json,s=t.nodes[n];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const o=t.meshes[s.mesh];for(const f of o.primitives)if(f.mode!==U.TRIANGLES&&f.mode!==U.TRIANGLE_STRIP&&f.mode!==U.TRIANGLE_FAN&&f.mode!==void 0)return null;const r=s.extensions[this.name].attributes,u=[],c={};for(const f in r)u.push(this.parser.getDependency("accessor",r[f]).then(_=>(c[f]=_,c[f])));return u.length<1?null:(u.push(this.parser.createNodeMesh(n)),Promise.all(u).then(f=>{const _=f.pop(),e=_.isGroup?_.children:[_],i=f[0].count,l=[];for(const h of e){const g=new Be,m=new b,p=new Ne,y=new b(1,1,1),T=new jn(h.geometry,h.material,i);for(let v=0;v<i;v++)c.TRANSLATION&&m.fromBufferAttribute(c.TRANSLATION,v),c.ROTATION&&p.fromBufferAttribute(c.ROTATION,v),c.SCALE&&y.fromBufferAttribute(c.SCALE,v),T.setMatrixAt(v,g.compose(m,p,y));for(const v in c)if(v==="_COLOR_0"){const E=c[v];T.instanceColor=new Kn(E.array,E.itemSize,E.normalized)}else v!=="TRANSLATION"&&v!=="ROTATION"&&v!=="SCALE"&&h.geometry.setAttribute(v,c[v]);an.prototype.copy.call(T,h),this.parser.assignFinalMaterial(T),l.push(T)}return _.isGroup?(_.clear(),_.add(...l),_):l[0]}))}}const _n="glTF",pe=12,Yt={JSON:1313821514,BIN:5130562};class io{constructor(n){this.name=w.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(n,0,pe),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(n.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==_n)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const o=this.header.length-pe,a=new DataView(n,pe);let r=0;for(;r<o;){const u=a.getUint32(r,!0);r+=4;const c=a.getUint32(r,!0);if(r+=4,c===Yt.JSON){const f=new Uint8Array(n,pe+r,u);this.content=s.decode(f)}else if(c===Yt.BIN){const f=pe+r;this.body=n.slice(f,f+u)}r+=u}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ro{constructor(n,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=w.KHR_DRACO_MESH_COMPRESSION,this.json=n,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(n,t){const s=this.json,o=this.dracoLoader,a=n.extensions[this.name].bufferView,r=n.extensions[this.name].attributes,u={},c={},f={};for(const _ in r){const e=Tt[_]||_.toLowerCase();u[e]=r[_]}for(const _ in n.attributes){const e=Tt[_]||_.toLowerCase();if(r[_]!==void 0){const i=s.accessors[n.attributes[_]],l=ue[i.componentType];f[e]=l.name,c[e]=i.normalized===!0}}return t.getDependency("bufferView",a).then(function(_){return new Promise(function(e,i){o.decodeDracoFile(_,function(l){for(const h in l.attributes){const g=l.attributes[h],m=c[h];m!==void 0&&(g.normalized=m)}e(l)},u,f,V,i)})})}}class ao{constructor(){this.name=w.KHR_TEXTURE_TRANSFORM}extendTexture(n,t){return(t.texCoord===void 0||t.texCoord===n.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(n=n.clone(),t.texCoord!==void 0&&(n.channel=t.texCoord),t.offset!==void 0&&n.offset.fromArray(t.offset),t.rotation!==void 0&&(n.rotation=t.rotation),t.scale!==void 0&&n.repeat.fromArray(t.scale),n.needsUpdate=!0),n}}class lo{constructor(){this.name=w.KHR_MESH_QUANTIZATION}}class mn extends fs{constructor(n,t,s,o){super(n,t,s,o)}copySampleValue_(n){const t=this.resultBuffer,s=this.sampleValues,o=this.valueSize,a=n*o*3+o;for(let r=0;r!==o;r++)t[r]=s[a+r];return t}interpolate_(n,t,s,o){const a=this.resultBuffer,r=this.sampleValues,u=this.valueSize,c=u*2,f=u*3,_=o-t,e=(s-t)/_,i=e*e,l=i*e,h=n*f,g=h-f,m=-2*l+3*i,p=l-i,y=1-m,T=p-i+e;for(let v=0;v!==u;v++){const E=r[g+v+u],P=r[g+v+c]*_,R=r[h+v+u],Y=r[h+v]*_;a[v]=y*E+T*P+m*R+p*Y}return a}}const co=new Ne;class uo extends mn{interpolate_(n,t,s,o){const a=super.interpolate_(n,t,s,o);return co.fromArray(a).normalize().toArray(a),a}}const U={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},ue={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},qt={9728:un,9729:Q,9984:qn,9985:Yn,9986:Xn,9987:cn},Wt={33071:Jn,33648:Wn,10497:we},ct={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},Tt={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Z={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},fo={CUBICSPLINE:void 0,LINEAR:hn,STEP:cs},ut={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function ho(d){return d.DefaultMaterial===void 0&&(d.DefaultMaterial=new bt({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:ds})),d.DefaultMaterial}function ee(d,n,t){for(const s in t.extensions)d[s]===void 0&&(n.userData.gltfExtensions=n.userData.gltfExtensions||{},n.userData.gltfExtensions[s]=t.extensions[s])}function W(d,n){n.extras!==void 0&&(typeof n.extras=="object"?Object.assign(d.userData,n.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+n.extras))}function po(d,n,t){let s=!1,o=!1,a=!1;for(let f=0,_=n.length;f<_;f++){const e=n[f];if(e.POSITION!==void 0&&(s=!0),e.NORMAL!==void 0&&(o=!0),e.COLOR_0!==void 0&&(a=!0),s&&o&&a)break}if(!s&&!o&&!a)return Promise.resolve(d);const r=[],u=[],c=[];for(let f=0,_=n.length;f<_;f++){const e=n[f];if(s){const i=e.POSITION!==void 0?t.getDependency("accessor",e.POSITION):d.attributes.position;r.push(i)}if(o){const i=e.NORMAL!==void 0?t.getDependency("accessor",e.NORMAL):d.attributes.normal;u.push(i)}if(a){const i=e.COLOR_0!==void 0?t.getDependency("accessor",e.COLOR_0):d.attributes.color;c.push(i)}}return Promise.all([Promise.all(r),Promise.all(u),Promise.all(c)]).then(function(f){const _=f[0],e=f[1],i=f[2];return s&&(d.morphAttributes.position=_),o&&(d.morphAttributes.normal=e),a&&(d.morphAttributes.color=i),d.morphTargetsRelative=!0,d})}function _o(d,n){if(d.updateMorphTargets(),n.weights!==void 0)for(let t=0,s=n.weights.length;t<s;t++)d.morphTargetInfluences[t]=n.weights[t];if(n.extras&&Array.isArray(n.extras.targetNames)){const t=n.extras.targetNames;if(d.morphTargetInfluences.length===t.length){d.morphTargetDictionary={};for(let s=0,o=t.length;s<o;s++)d.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function mo(d){let n;const t=d.extensions&&d.extensions[w.KHR_DRACO_MESH_COMPRESSION];if(t?n="draco:"+t.bufferView+":"+t.indices+":"+dt(t.attributes):n=d.indices+":"+dt(d.attributes)+":"+d.mode,d.targets!==void 0)for(let s=0,o=d.targets.length;s<o;s++)n+=":"+dt(d.targets[s]);return n}function dt(d){let n="";const t=Object.keys(d).sort();for(let s=0,o=t.length;s<o;s++)n+=t[s]+":"+d[t[s]]+";";return n}function vt(d){switch(d){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function go(d){return d.search(/\.jpe?g($|\?)/i)>0||d.search(/^data\:image\/jpeg/)===0?"image/jpeg":d.search(/\.webp($|\?)/i)>0||d.search(/^data\:image\/webp/)===0?"image/webp":d.search(/\.ktx2($|\?)/i)>0||d.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const yo=new Be;class To{constructor(n={},t={}){this.json=n,this.extensions={},this.plugins={},this.options=t,this.cache=new Us,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,o=-1,a=!1,r=-1;if(typeof navigator<"u"){const u=navigator.userAgent;s=/^((?!chrome|android).)*safari/i.test(u)===!0;const c=u.match(/Version\/(\d+)/);o=s&&c?parseInt(c[1],10):-1,a=u.indexOf("Firefox")>-1,r=a?u.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||s&&o<17||a&&r<98?this.textureLoader=new ln(this.options.manager):this.textureLoader=new zn(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new He(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(n){this.extensions=n}setPlugins(n){this.plugins=n}parse(n,t){const s=this,o=this.json,a=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(r){const u={scene:r[0][o.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:o.asset,parser:s,userData:{}};return ee(a,u,o),W(u,o),Promise.all(s._invokeAll(function(c){return c.afterRoot&&c.afterRoot(u)})).then(function(){for(const c of u.scenes)c.updateMatrixWorld();n(u)})}).catch(t)}_markDefs(){const n=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let o=0,a=t.length;o<a;o++){const r=t[o].joints;for(let u=0,c=r.length;u<c;u++)n[r[u]].isBone=!0}for(let o=0,a=n.length;o<a;o++){const r=n[o];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(s[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(n,t){t!==void 0&&(n.refs[t]===void 0&&(n.refs[t]=n.uses[t]=0),n.refs[t]++)}_getNodeRef(n,t,s){if(n.refs[t]<=1)return s;const o=s.clone(),a=(r,u)=>{const c=this.associations.get(r);c!=null&&this.associations.set(u,c);for(const[f,_]of r.children.entries())a(_,u.children[f])};return a(s,o),o.name+="_instance_"+n.uses[t]++,o}_invokeOne(n){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const o=n(t[s]);if(o)return o}return null}_invokeAll(n){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let o=0;o<t.length;o++){const a=n(t[o]);a&&s.push(a)}return s}getDependency(n,t){const s=n+":"+t;let o=this.cache.get(s);if(!o){switch(n){case"scene":o=this.loadScene(t);break;case"node":o=this._invokeOne(function(a){return a.loadNode&&a.loadNode(t)});break;case"mesh":o=this._invokeOne(function(a){return a.loadMesh&&a.loadMesh(t)});break;case"accessor":o=this.loadAccessor(t);break;case"bufferView":o=this._invokeOne(function(a){return a.loadBufferView&&a.loadBufferView(t)});break;case"buffer":o=this.loadBuffer(t);break;case"material":o=this._invokeOne(function(a){return a.loadMaterial&&a.loadMaterial(t)});break;case"texture":o=this._invokeOne(function(a){return a.loadTexture&&a.loadTexture(t)});break;case"skin":o=this.loadSkin(t);break;case"animation":o=this._invokeOne(function(a){return a.loadAnimation&&a.loadAnimation(t)});break;case"camera":o=this.loadCamera(t);break;default:if(o=this._invokeOne(function(a){return a!=this&&a.getDependency&&a.getDependency(n,t)}),!o)throw new Error("Unknown type: "+n);break}this.cache.add(s,o)}return o}getDependencies(n){let t=this.cache.get(n);if(!t){const s=this,o=this.json[n+(n==="mesh"?"es":"s")]||[];t=Promise.all(o.map(function(a,r){return s.getDependency(n,r)})),this.cache.add(n,t)}return t}loadBuffer(n){const t=this.json.buffers[n],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&n===0)return Promise.resolve(this.extensions[w.KHR_BINARY_GLTF].body);const o=this.options;return new Promise(function(a,r){s.load(Te.resolveURL(t.uri,o.path),a,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(n){const t=this.json.bufferViews[n];return this.getDependency("buffer",t.buffer).then(function(s){const o=t.byteLength||0,a=t.byteOffset||0;return s.slice(a,a+o)})}loadAccessor(n){const t=this,s=this.json,o=this.json.accessors[n];if(o.bufferView===void 0&&o.sparse===void 0){const r=ct[o.type],u=ue[o.componentType],c=o.normalized===!0,f=new u(o.count*r);return Promise.resolve(new ye(f,r,c))}const a=[];return o.bufferView!==void 0?a.push(this.getDependency("bufferView",o.bufferView)):a.push(null),o.sparse!==void 0&&(a.push(this.getDependency("bufferView",o.sparse.indices.bufferView)),a.push(this.getDependency("bufferView",o.sparse.values.bufferView))),Promise.all(a).then(function(r){const u=r[0],c=ct[o.type],f=ue[o.componentType],_=f.BYTES_PER_ELEMENT,e=_*c,i=o.byteOffset||0,l=o.bufferView!==void 0?s.bufferViews[o.bufferView].byteStride:void 0,h=o.normalized===!0;let g,m;if(l&&l!==e){const p=Math.floor(i/l),y="InterleavedBuffer:"+o.bufferView+":"+o.componentType+":"+p+":"+o.count;let T=t.cache.get(y);T||(g=new f(u,p*l,o.count*l/_),T=new Vn(g,l/_),t.cache.add(y,T)),m=new us(T,c,i%l/_,h)}else u===null?g=new f(o.count*c):g=new f(u,i,o.count*c),m=new ye(g,c,h);if(o.sparse!==void 0){const p=ct.SCALAR,y=ue[o.sparse.indices.componentType],T=o.sparse.indices.byteOffset||0,v=o.sparse.values.byteOffset||0,E=new y(r[1],T,o.sparse.count*p),P=new f(r[2],v,o.sparse.count*c);u!==null&&(m=new ye(m.array.slice(),m.itemSize,m.normalized)),m.normalized=!1;for(let R=0,Y=E.length;R<Y;R++){const x=E[R];if(m.setX(x,P[R*c]),c>=2&&m.setY(x,P[R*c+1]),c>=3&&m.setZ(x,P[R*c+2]),c>=4&&m.setW(x,P[R*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}m.normalized=h}return m})}loadTexture(n){const t=this.json,s=this.options,a=t.textures[n].source,r=t.images[a];let u=this.textureLoader;if(r.uri){const c=s.manager.getHandler(r.uri);c!==null&&(u=c)}return this.loadTextureImage(n,a,u)}loadTextureImage(n,t,s){const o=this,a=this.json,r=a.textures[n],u=a.images[t],c=(u.uri||u.bufferView)+":"+r.sampler;if(this.textureCache[c])return this.textureCache[c];const f=this.loadImageSource(t,s).then(function(_){_.flipY=!1,_.name=r.name||u.name||"",_.name===""&&typeof u.uri=="string"&&u.uri.startsWith("data:image/")===!1&&(_.name=u.uri);const i=(a.samplers||{})[r.sampler]||{};return _.magFilter=qt[i.magFilter]||Q,_.minFilter=qt[i.minFilter]||cn,_.wrapS=Wt[i.wrapS]||we,_.wrapT=Wt[i.wrapT]||we,_.generateMipmaps=!_.isCompressedTexture&&_.minFilter!==un&&_.minFilter!==Q,o.associations.set(_,{textures:n}),_}).catch(function(){return null});return this.textureCache[c]=f,f}loadImageSource(n,t){const s=this,o=this.json,a=this.options;if(this.sourceCache[n]!==void 0)return this.sourceCache[n].then(e=>e.clone());const r=o.images[n],u=self.URL||self.webkitURL;let c=r.uri||"",f=!1;if(r.bufferView!==void 0)c=s.getDependency("bufferView",r.bufferView).then(function(e){f=!0;const i=new Blob([e],{type:r.mimeType});return c=u.createObjectURL(i),c});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+n+" is missing URI and bufferView");const _=Promise.resolve(c).then(function(e){return new Promise(function(i,l){let h=i;t.isImageBitmapLoader===!0&&(h=function(g){const m=new Ut(g);m.needsUpdate=!0,i(m)}),t.load(Te.resolveURL(e,a.path),h,void 0,l)})}).then(function(e){return f===!0&&u.revokeObjectURL(c),W(e,r),e.userData.mimeType=r.mimeType||go(r.uri),e}).catch(function(e){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),e});return this.sourceCache[n]=_,_}assignTexture(n,t,s,o){const a=this;return this.getDependency("texture",s.index).then(function(r){if(!r)return null;if(s.texCoord!==void 0&&s.texCoord>0&&(r=r.clone(),r.channel=s.texCoord),a.extensions[w.KHR_TEXTURE_TRANSFORM]){const u=s.extensions!==void 0?s.extensions[w.KHR_TEXTURE_TRANSFORM]:void 0;if(u){const c=a.associations.get(r);r=a.extensions[w.KHR_TEXTURE_TRANSFORM].extendTexture(r,u),a.associations.set(r,c)}}return o!==void 0&&(r.colorSpace=o),n[t]=r,r})}assignFinalMaterial(n){const t=n.geometry;let s=n.material;const o=t.attributes.tangent===void 0,a=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(n.isPoints){const u="PointsMaterial:"+s.uuid;let c=this.cache.get(u);c||(c=new Zn,ot.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,c.sizeAttenuation=!1,this.cache.add(u,c)),s=c}else if(n.isLine){const u="LineBasicMaterial:"+s.uuid;let c=this.cache.get(u);c||(c=new Qn,ot.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,this.cache.add(u,c)),s=c}if(o||a||r){let u="ClonedMaterial:"+s.uuid+":";o&&(u+="derivative-tangents:"),a&&(u+="vertex-colors:"),r&&(u+="flat-shading:");let c=this.cache.get(u);c||(c=s.clone(),a&&(c.vertexColors=!0),r&&(c.flatShading=!0),o&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(u,c),this.associations.set(c,this.associations.get(s))),s=c}n.material=s}getMaterialType(){return bt}loadMaterial(n){const t=this,s=this.json,o=this.extensions,a=s.materials[n];let r;const u={},c=a.extensions||{},f=[];if(c[w.KHR_MATERIALS_UNLIT]){const e=o[w.KHR_MATERIALS_UNLIT];r=e.getMaterialType(),f.push(e.extendParams(u,a,t))}else{const e=a.pbrMetallicRoughness||{};if(u.color=new G(1,1,1),u.opacity=1,Array.isArray(e.baseColorFactor)){const i=e.baseColorFactor;u.color.setRGB(i[0],i[1],i[2],V),u.opacity=i[3]}e.baseColorTexture!==void 0&&f.push(t.assignTexture(u,"map",e.baseColorTexture,K)),u.metalness=e.metallicFactor!==void 0?e.metallicFactor:1,u.roughness=e.roughnessFactor!==void 0?e.roughnessFactor:1,e.metallicRoughnessTexture!==void 0&&(f.push(t.assignTexture(u,"metalnessMap",e.metallicRoughnessTexture)),f.push(t.assignTexture(u,"roughnessMap",e.metallicRoughnessTexture))),r=this._invokeOne(function(i){return i.getMaterialType&&i.getMaterialType(n)}),f.push(Promise.all(this._invokeAll(function(i){return i.extendMaterialParams&&i.extendMaterialParams(n,u)})))}a.doubleSided===!0&&(u.side=dn);const _=a.alphaMode||ut.OPAQUE;if(_===ut.BLEND?(u.transparent=!0,u.depthWrite=!1):(u.transparent=!1,_===ut.MASK&&(u.alphaTest=a.alphaCutoff!==void 0?a.alphaCutoff:.5)),a.normalTexture!==void 0&&r!==te&&(f.push(t.assignTexture(u,"normalMap",a.normalTexture)),u.normalScale=new k(1,1),a.normalTexture.scale!==void 0)){const e=a.normalTexture.scale;u.normalScale.set(e,e)}if(a.occlusionTexture!==void 0&&r!==te&&(f.push(t.assignTexture(u,"aoMap",a.occlusionTexture)),a.occlusionTexture.strength!==void 0&&(u.aoMapIntensity=a.occlusionTexture.strength)),a.emissiveFactor!==void 0&&r!==te){const e=a.emissiveFactor;u.emissive=new G().setRGB(e[0],e[1],e[2],V)}return a.emissiveTexture!==void 0&&r!==te&&f.push(t.assignTexture(u,"emissiveMap",a.emissiveTexture,K)),Promise.all(f).then(function(){const e=new r(u);return a.name&&(e.name=a.name),W(e,a),t.associations.set(e,{materials:n}),a.extensions&&ee(o,e,a),e})}createUniqueName(n){const t=$n.sanitizeNodeName(n||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(n){const t=this,s=this.extensions,o=this.primitiveCache;function a(u){return s[w.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(u,t).then(function(c){return Jt(c,u,t)})}const r=[];for(let u=0,c=n.length;u<c;u++){const f=n[u],_=mo(f),e=o[_];if(e)r.push(e.promise);else{let i;f.extensions&&f.extensions[w.KHR_DRACO_MESH_COMPRESSION]?i=a(f):i=Jt(new on,f,t),o[_]={primitive:f,promise:i},r.push(i)}}return Promise.all(r)}loadMesh(n){const t=this,s=this.json,o=this.extensions,a=s.meshes[n],r=a.primitives,u=[];for(let c=0,f=r.length;c<f;c++){const _=r[c].material===void 0?ho(this.cache):this.getDependency("material",r[c].material);u.push(_)}return u.push(t.loadGeometries(r)),Promise.all(u).then(function(c){const f=c.slice(0,c.length-1),_=c[c.length-1],e=[];for(let l=0,h=_.length;l<h;l++){const g=_[l],m=r[l];let p;const y=f[l];if(m.mode===U.TRIANGLES||m.mode===U.TRIANGLE_STRIP||m.mode===U.TRIANGLE_FAN||m.mode===void 0)p=a.isSkinnedMesh===!0?new es(g,y):new Se(g,y),p.isSkinnedMesh===!0&&p.normalizeSkinWeights(),m.mode===U.TRIANGLE_STRIP?p.geometry=Xt(p.geometry,rn):m.mode===U.TRIANGLE_FAN&&(p.geometry=Xt(p.geometry,yt));else if(m.mode===U.LINES)p=new ts(g,y);else if(m.mode===U.LINE_STRIP)p=new ns(g,y);else if(m.mode===U.LINE_LOOP)p=new ss(g,y);else if(m.mode===U.POINTS)p=new os(g,y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+m.mode);Object.keys(p.geometry.morphAttributes).length>0&&_o(p,a),p.name=t.createUniqueName(a.name||"mesh_"+n),W(p,a),m.extensions&&ee(o,p,m),t.assignFinalMaterial(p),e.push(p)}for(let l=0,h=e.length;l<h;l++)t.associations.set(e[l],{meshes:n,primitives:l});if(e.length===1)return a.extensions&&ee(o,e[0],a),e[0];const i=new it;a.extensions&&ee(o,i,a),t.associations.set(i,{meshes:n});for(let l=0,h=e.length;l<h;l++)i.add(e[l]);return i})}loadCamera(n){let t;const s=this.json.cameras[n],o=s[s.type];if(!o){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new fn(Fe.radToDeg(o.yfov),o.aspectRatio||1,o.znear||1,o.zfar||2e6):s.type==="orthographic"&&(t=new is(-o.xmag,o.xmag,o.ymag,-o.ymag,o.znear,o.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),W(t,s),Promise.resolve(t)}loadSkin(n){const t=this.json.skins[n],s=[];for(let o=0,a=t.joints.length;o<a;o++)s.push(this._loadNodeShallow(t.joints[o]));return t.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(o){const a=o.pop(),r=o,u=[],c=[];for(let f=0,_=r.length;f<_;f++){const e=r[f];if(e){u.push(e);const i=new Be;a!==null&&i.fromArray(a.array,f*16),c.push(i)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[f])}return new rs(u,c)})}loadAnimation(n){const t=this.json,s=this,o=t.animations[n],a=o.name?o.name:"animation_"+n,r=[],u=[],c=[],f=[],_=[];for(let e=0,i=o.channels.length;e<i;e++){const l=o.channels[e],h=o.samplers[l.sampler],g=l.target,m=g.node,p=o.parameters!==void 0?o.parameters[h.input]:h.input,y=o.parameters!==void 0?o.parameters[h.output]:h.output;g.node!==void 0&&(r.push(this.getDependency("node",m)),u.push(this.getDependency("accessor",p)),c.push(this.getDependency("accessor",y)),f.push(h),_.push(g))}return Promise.all([Promise.all(r),Promise.all(u),Promise.all(c),Promise.all(f),Promise.all(_)]).then(function(e){const i=e[0],l=e[1],h=e[2],g=e[3],m=e[4],p=[];for(let y=0,T=i.length;y<T;y++){const v=i[y],E=l[y],P=h[y],R=g[y],Y=m[y];if(v===void 0)continue;v.updateMatrix&&v.updateMatrix();const x=s._createAnimationTracks(v,E,P,R,Y);if(x)for(let re=0;re<x.length;re++)p.push(x[re])}return new as(a,void 0,p)})}createNodeMesh(n){const t=this.json,s=this,o=t.nodes[n];return o.mesh===void 0?null:s.getDependency("mesh",o.mesh).then(function(a){const r=s._getNodeRef(s.meshCache,o.mesh,a);return o.weights!==void 0&&r.traverse(function(u){if(u.isMesh)for(let c=0,f=o.weights.length;c<f;c++)u.morphTargetInfluences[c]=o.weights[c]}),r})}loadNode(n){const t=this.json,s=this,o=t.nodes[n],a=s._loadNodeShallow(n),r=[],u=o.children||[];for(let f=0,_=u.length;f<_;f++)r.push(s.getDependency("node",u[f]));const c=o.skin===void 0?Promise.resolve(null):s.getDependency("skin",o.skin);return Promise.all([a,Promise.all(r),c]).then(function(f){const _=f[0],e=f[1],i=f[2];i!==null&&_.traverse(function(l){l.isSkinnedMesh&&l.bind(i,yo)});for(let l=0,h=e.length;l<h;l++)_.add(e[l]);return _})}_loadNodeShallow(n){const t=this.json,s=this.extensions,o=this;if(this.nodeCache[n]!==void 0)return this.nodeCache[n];const a=t.nodes[n],r=a.name?o.createUniqueName(a.name):"",u=[],c=o._invokeOne(function(f){return f.createNodeMesh&&f.createNodeMesh(n)});return c&&u.push(c),a.camera!==void 0&&u.push(o.getDependency("camera",a.camera).then(function(f){return o._getNodeRef(o.cameraCache,a.camera,f)})),o._invokeAll(function(f){return f.createNodeAttachment&&f.createNodeAttachment(n)}).forEach(function(f){u.push(f)}),this.nodeCache[n]=Promise.all(u).then(function(f){let _;if(a.isBone===!0?_=new ls:f.length>1?_=new it:f.length===1?_=f[0]:_=new an,_!==f[0])for(let e=0,i=f.length;e<i;e++)_.add(f[e]);if(a.name&&(_.userData.name=a.name,_.name=r),W(_,a),a.extensions&&ee(s,_,a),a.matrix!==void 0){const e=new Be;e.fromArray(a.matrix),_.applyMatrix4(e)}else a.translation!==void 0&&_.position.fromArray(a.translation),a.rotation!==void 0&&_.quaternion.fromArray(a.rotation),a.scale!==void 0&&_.scale.fromArray(a.scale);return o.associations.has(_)||o.associations.set(_,{}),o.associations.get(_).nodes=n,_}),this.nodeCache[n]}loadScene(n){const t=this.extensions,s=this.json.scenes[n],o=this,a=new it;s.name&&(a.name=o.createUniqueName(s.name)),W(a,s),s.extensions&&ee(t,a,s);const r=s.nodes||[],u=[];for(let c=0,f=r.length;c<f;c++)u.push(o.getDependency("node",r[c]));return Promise.all(u).then(function(c){for(let _=0,e=c.length;_<e;_++)a.add(c[_]);const f=_=>{const e=new Map;for(const[i,l]of o.associations)(i instanceof ot||i instanceof Ut)&&e.set(i,l);return _.traverse(i=>{const l=o.associations.get(i);l!=null&&e.set(i,l)}),e};return o.associations=f(a),a})}_createAnimationTracks(n,t,s,o,a){const r=[],u=n.name?n.name:n.uuid,c=[];Z[a.path]===Z.weights?n.traverse(function(i){i.morphTargetInfluences&&c.push(i.name?i.name:i.uuid)}):c.push(u);let f;switch(Z[a.path]){case Z.weights:f=jt;break;case Z.rotation:f=Kt;break;case Z.translation:case Z.scale:f=Gt;break;default:switch(s.itemSize){case 1:f=jt;break;case 2:case 3:default:f=Gt;break}break}const _=o.interpolation!==void 0?fo[o.interpolation]:hn,e=this._getArrayFromAccessor(s);for(let i=0,l=c.length;i<l;i++){const h=new f(c[i]+"."+Z[a.path],t.array,e,_);o.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(h),r.push(h)}return r}_getArrayFromAccessor(n){let t=n.array;if(n.normalized){const s=vt(t.constructor),o=new Float32Array(t.length);for(let a=0,r=t.length;a<r;a++)o[a]=t[a]*s;t=o}return t}_createCubicSplineTrackInterpolant(n){n.createInterpolant=function(s){const o=this instanceof Kt?uo:mn;return new o(this.times,this.values,this.getValueSize()/3,s)},n.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function vo(d,n,t){const s=n.attributes,o=new hs;if(s.POSITION!==void 0){const u=t.json.accessors[s.POSITION],c=u.min,f=u.max;if(c!==void 0&&f!==void 0){if(o.set(new b(c[0],c[1],c[2]),new b(f[0],f[1],f[2])),u.normalized){const _=vt(ue[u.componentType]);o.min.multiplyScalar(_),o.max.multiplyScalar(_)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const a=n.targets;if(a!==void 0){const u=new b,c=new b;for(let f=0,_=a.length;f<_;f++){const e=a[f];if(e.POSITION!==void 0){const i=t.json.accessors[e.POSITION],l=i.min,h=i.max;if(l!==void 0&&h!==void 0){if(c.setX(Math.max(Math.abs(l[0]),Math.abs(h[0]))),c.setY(Math.max(Math.abs(l[1]),Math.abs(h[1]))),c.setZ(Math.max(Math.abs(l[2]),Math.abs(h[2]))),i.normalized){const g=vt(ue[i.componentType]);c.multiplyScalar(g)}u.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}o.expandByVector(u)}d.boundingBox=o;const r=new ps;o.getCenter(r.center),r.radius=o.min.distanceTo(o.max)/2,d.boundingSphere=r}function Jt(d,n,t){const s=n.attributes,o=[];function a(r,u){return t.getDependency("accessor",r).then(function(c){d.setAttribute(u,c)})}for(const r in s){const u=Tt[r]||r.toLowerCase();u in d.attributes||o.push(a(s[r],u))}if(n.indices!==void 0&&!d.index){const r=t.getDependency("accessor",n.indices).then(function(u){d.setIndex(u)});o.push(r)}return gt.workingColorSpace!==V&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${gt.workingColorSpace}" not supported.`),W(d,n),vo(d,n,t),Promise.all(o).then(function(){return n.targets!==void 0?po(d,n.targets,t):d})}var _e=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ft={};/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */var Zt;function wo(){return Zt||(Zt=1,function(d){(function(){var n=function(){this.init()};n.prototype={init:function(){var e=this||t;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator=typeof window<"u"&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var i=this||t;if(e=parseFloat(e),i.ctx||_(),typeof e<"u"&&e>=0&&e<=1){if(i._volume=e,i._muted)return i;i.usingWebAudio&&i.masterGain.gain.setValueAtTime(e,t.ctx.currentTime);for(var l=0;l<i._howls.length;l++)if(!i._howls[l]._webAudio)for(var h=i._howls[l]._getSoundIds(),g=0;g<h.length;g++){var m=i._howls[l]._soundById(h[g]);m&&m._node&&(m._node.volume=m._volume*e)}return i}return i._volume},mute:function(e){var i=this||t;i.ctx||_(),i._muted=e,i.usingWebAudio&&i.masterGain.gain.setValueAtTime(e?0:i._volume,t.ctx.currentTime);for(var l=0;l<i._howls.length;l++)if(!i._howls[l]._webAudio)for(var h=i._howls[l]._getSoundIds(),g=0;g<h.length;g++){var m=i._howls[l]._soundById(h[g]);m&&m._node&&(m._node.muted=e?!0:m._muted)}return i},stop:function(){for(var e=this||t,i=0;i<e._howls.length;i++)e._howls[i].stop();return e},unload:function(){for(var e=this||t,i=e._howls.length-1;i>=0;i--)e._howls[i].unload();return e.usingWebAudio&&e.ctx&&typeof e.ctx.close<"u"&&(e.ctx.close(),e.ctx=null,_()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if(typeof Audio<"u")try{var i=new Audio;typeof i.oncanplaythrough>"u"&&(e._canPlayEvent="canplay")}catch{e.noAudio=!0}else e.noAudio=!0;try{var i=new Audio;i.muted&&(e.noAudio=!0)}catch{}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,i=null;try{i=typeof Audio<"u"?new Audio:null}catch{return e}if(!i||typeof i.canPlayType!="function")return e;var l=i.canPlayType("audio/mpeg;").replace(/^no$/,""),h=e._navigator?e._navigator.userAgent:"",g=h.match(/OPR\/(\d+)/g),m=g&&parseInt(g[0].split("/")[1],10)<33,p=h.indexOf("Safari")!==-1&&h.indexOf("Chrome")===-1,y=h.match(/Version\/(.*?) /),T=p&&y&&parseInt(y[1],10)<15;return e._codecs={mp3:!!(!m&&(l||i.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!l,opus:!!i.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!i.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(i.canPlayType('audio/wav; codecs="1"')||i.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!i.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!i.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(i.canPlayType("audio/x-m4a;")||i.canPlayType("audio/m4a;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(i.canPlayType("audio/x-m4b;")||i.canPlayType("audio/m4b;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(i.canPlayType("audio/x-mp4;")||i.canPlayType("audio/mp4;")||i.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!T&&i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!T&&i.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!i.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(i.canPlayType("audio/x-flac;")||i.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||t;if(!(e._audioUnlocked||!e.ctx)){e._audioUnlocked=!1,e.autoUnlock=!1,!e._mobileUnloaded&&e.ctx.sampleRate!==44100&&(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var i=function(l){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var h=new Audio;h._unlocked=!0,e._releaseHtml5Audio(h)}catch{e.noAudio=!0;break}for(var g=0;g<e._howls.length;g++)if(!e._howls[g]._webAudio)for(var m=e._howls[g]._getSoundIds(),p=0;p<m.length;p++){var y=e._howls[g]._soundById(m[p]);y&&y._node&&!y._node._unlocked&&(y._node._unlocked=!0,y._node.load())}e._autoResume();var T=e.ctx.createBufferSource();T.buffer=e._scratchBuffer,T.connect(e.ctx.destination),typeof T.start>"u"?T.noteOn(0):T.start(0),typeof e.ctx.resume=="function"&&e.ctx.resume(),T.onended=function(){T.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",i,!0),document.removeEventListener("touchend",i,!0),document.removeEventListener("click",i,!0),document.removeEventListener("keydown",i,!0);for(var v=0;v<e._howls.length;v++)e._howls[v]._emit("unlock")}};return document.addEventListener("touchstart",i,!0),document.addEventListener("touchend",i,!0),document.addEventListener("click",i,!0),document.addEventListener("keydown",i,!0),e}},_obtainHtml5Audio:function(){var e=this||t;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var i=new Audio().play();return i&&typeof Promise<"u"&&(i instanceof Promise||typeof i.then=="function")&&i.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(e){var i=this||t;return e._unlocked&&i._html5AudioPool.push(e),i},_autoSuspend:function(){var e=this;if(!(!e.autoSuspend||!e.ctx||typeof e.ctx.suspend>"u"||!t.usingWebAudio)){for(var i=0;i<e._howls.length;i++)if(e._howls[i]._webAudio){for(var l=0;l<e._howls[i]._sounds.length;l++)if(!e._howls[i]._sounds[l]._paused)return e}return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var h=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(h,h)}},3e4),e}},_autoResume:function(){var e=this;if(!(!e.ctx||typeof e.ctx.resume>"u"||!t.usingWebAudio))return e.state==="running"&&e.ctx.state!=="interrupted"&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):e.state==="suspended"||e.state==="running"&&e.ctx.state==="interrupted"?(e.ctx.resume().then(function(){e.state="running";for(var i=0;i<e._howls.length;i++)e._howls[i]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):e.state==="suspending"&&(e._resumeAfterSuspend=!0),e}};var t=new n,s=function(e){var i=this;if(!e.src||e.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}i.init(e)};s.prototype={init:function(e){var i=this;return t.ctx||_(),i._autoplay=e.autoplay||!1,i._format=typeof e.format!="string"?e.format:[e.format],i._html5=e.html5||!1,i._muted=e.mute||!1,i._loop=e.loop||!1,i._pool=e.pool||5,i._preload=typeof e.preload=="boolean"||e.preload==="metadata"?e.preload:!0,i._rate=e.rate||1,i._sprite=e.sprite||{},i._src=typeof e.src!="string"?e.src:[e.src],i._volume=e.volume!==void 0?e.volume:1,i._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:e.xhr&&e.xhr.withCredentials?e.xhr.withCredentials:!1},i._duration=0,i._state="unloaded",i._sounds=[],i._endTimers={},i._queue=[],i._playLock=!1,i._onend=e.onend?[{fn:e.onend}]:[],i._onfade=e.onfade?[{fn:e.onfade}]:[],i._onload=e.onload?[{fn:e.onload}]:[],i._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],i._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],i._onpause=e.onpause?[{fn:e.onpause}]:[],i._onplay=e.onplay?[{fn:e.onplay}]:[],i._onstop=e.onstop?[{fn:e.onstop}]:[],i._onmute=e.onmute?[{fn:e.onmute}]:[],i._onvolume=e.onvolume?[{fn:e.onvolume}]:[],i._onrate=e.onrate?[{fn:e.onrate}]:[],i._onseek=e.onseek?[{fn:e.onseek}]:[],i._onunlock=e.onunlock?[{fn:e.onunlock}]:[],i._onresume=[],i._webAudio=t.usingWebAudio&&!i._html5,typeof t.ctx<"u"&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(i),i._autoplay&&i._queue.push({event:"play",action:function(){i.play()}}),i._preload&&i._preload!=="none"&&i.load(),i},load:function(){var e=this,i=null;if(t.noAudio){e._emit("loaderror",null,"No audio support.");return}typeof e._src=="string"&&(e._src=[e._src]);for(var l=0;l<e._src.length;l++){var h,g;if(e._format&&e._format[l])h=e._format[l];else{if(g=e._src[l],typeof g!="string"){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}h=/^data:audio\/([^;,]+);/i.exec(g),h||(h=/\.([^.]+)$/.exec(g.split("?",1)[0])),h&&(h=h[1].toLowerCase())}if(h||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),h&&t.codecs(h)){i=e._src[l];break}}if(!i){e._emit("loaderror",null,"No codec support for selected audio sources.");return}return e._src=i,e._state="loading",window.location.protocol==="https:"&&i.slice(0,5)==="http:"&&(e._html5=!0,e._webAudio=!1),new o(e),e._webAudio&&r(e),e},play:function(e,i){var l=this,h=null;if(typeof e=="number")h=e,e=null;else{if(typeof e=="string"&&l._state==="loaded"&&!l._sprite[e])return null;if(typeof e>"u"&&(e="__default",!l._playLock)){for(var g=0,m=0;m<l._sounds.length;m++)l._sounds[m]._paused&&!l._sounds[m]._ended&&(g++,h=l._sounds[m]._id);g===1?e=null:h=null}}var p=h?l._soundById(h):l._inactiveSound();if(!p)return null;if(h&&!e&&(e=p._sprite||"__default"),l._state!=="loaded"){p._sprite=e,p._ended=!1;var y=p._id;return l._queue.push({event:"play",action:function(){l.play(y)}}),y}if(h&&!p._paused)return i||l._loadQueue("play"),p._id;l._webAudio&&t._autoResume();var T=Math.max(0,p._seek>0?p._seek:l._sprite[e][0]/1e3),v=Math.max(0,(l._sprite[e][0]+l._sprite[e][1])/1e3-T),E=v*1e3/Math.abs(p._rate),P=l._sprite[e][0]/1e3,R=(l._sprite[e][0]+l._sprite[e][1])/1e3;p._sprite=e,p._ended=!1;var Y=function(){p._paused=!1,p._seek=T,p._start=P,p._stop=R,p._loop=!!(p._loop||l._sprite[e][2])};if(T>=R){l._ended(p);return}var x=p._node;if(l._webAudio){var re=function(){l._playLock=!1,Y(),l._refreshBuffer(p);var ae=p._muted||l._muted?0:p._volume;x.gain.setValueAtTime(ae,t.ctx.currentTime),p._playStart=t.ctx.currentTime,typeof x.bufferSource.start>"u"?p._loop?x.bufferSource.noteGrainOn(0,T,86400):x.bufferSource.noteGrainOn(0,T,v):p._loop?x.bufferSource.start(0,T,86400):x.bufferSource.start(0,T,v),E!==1/0&&(l._endTimers[p._id]=setTimeout(l._ended.bind(l,p),E)),i||setTimeout(function(){l._emit("play",p._id),l._loadQueue()},0)};t.state==="running"&&t.ctx.state!=="interrupted"?re():(l._playLock=!0,l.once("resume",re),l._clearTimer(p._id))}else{var Ft=function(){x.currentTime=T,x.muted=p._muted||l._muted||t._muted||x.muted,x.volume=p._volume*t.volume(),x.playbackRate=p._rate;try{var ae=x.play();if(ae&&typeof Promise<"u"&&(ae instanceof Promise||typeof ae.then=="function")?(l._playLock=!0,Y(),ae.then(function(){l._playLock=!1,x._unlocked=!0,i?l._loadQueue():l._emit("play",p._id)}).catch(function(){l._playLock=!1,l._emit("playerror",p._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),p._ended=!0,p._paused=!0})):i||(l._playLock=!1,Y(),l._emit("play",p._id)),x.playbackRate=p._rate,x.paused){l._emit("playerror",p._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}e!=="__default"||p._loop?l._endTimers[p._id]=setTimeout(l._ended.bind(l,p),E):(l._endTimers[p._id]=function(){l._ended(p),x.removeEventListener("ended",l._endTimers[p._id],!1)},x.addEventListener("ended",l._endTimers[p._id],!1))}catch(On){l._emit("playerror",p._id,On)}};x.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(x.src=l._src,x.load());var kn=window&&window.ejecta||!x.readyState&&t._navigator.isCocoonJS;if(x.readyState>=3||kn)Ft();else{l._playLock=!0,l._state="loading";var Ht=function(){l._state="loaded",Ft(),x.removeEventListener(t._canPlayEvent,Ht,!1)};x.addEventListener(t._canPlayEvent,Ht,!1),l._clearTimer(p._id)}}return p._id},pause:function(e){var i=this;if(i._state!=="loaded"||i._playLock)return i._queue.push({event:"pause",action:function(){i.pause(e)}}),i;for(var l=i._getSoundIds(e),h=0;h<l.length;h++){i._clearTimer(l[h]);var g=i._soundById(l[h]);if(g&&!g._paused&&(g._seek=i.seek(l[h]),g._rateSeek=0,g._paused=!0,i._stopFade(l[h]),g._node))if(i._webAudio){if(!g._node.bufferSource)continue;typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),i._cleanBuffer(g._node)}else(!isNaN(g._node.duration)||g._node.duration===1/0)&&g._node.pause();arguments[1]||i._emit("pause",g?g._id:null)}return i},stop:function(e,i){var l=this;if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"stop",action:function(){l.stop(e)}}),l;for(var h=l._getSoundIds(e),g=0;g<h.length;g++){l._clearTimer(h[g]);var m=l._soundById(h[g]);m&&(m._seek=m._start||0,m._rateSeek=0,m._paused=!0,m._ended=!0,l._stopFade(h[g]),m._node&&(l._webAudio?m._node.bufferSource&&(typeof m._node.bufferSource.stop>"u"?m._node.bufferSource.noteOff(0):m._node.bufferSource.stop(0),l._cleanBuffer(m._node)):(!isNaN(m._node.duration)||m._node.duration===1/0)&&(m._node.currentTime=m._start||0,m._node.pause(),m._node.duration===1/0&&l._clearSound(m._node))),i||l._emit("stop",m._id))}return l},mute:function(e,i){var l=this;if(l._state!=="loaded"||l._playLock)return l._queue.push({event:"mute",action:function(){l.mute(e,i)}}),l;if(typeof i>"u")if(typeof e=="boolean")l._muted=e;else return l._muted;for(var h=l._getSoundIds(i),g=0;g<h.length;g++){var m=l._soundById(h[g]);m&&(m._muted=e,m._interval&&l._stopFade(m._id),l._webAudio&&m._node?m._node.gain.setValueAtTime(e?0:m._volume,t.ctx.currentTime):m._node&&(m._node.muted=t._muted?!0:e),l._emit("mute",m._id))}return l},volume:function(){var e=this,i=arguments,l,h;if(i.length===0)return e._volume;if(i.length===1||i.length===2&&typeof i[1]>"u"){var g=e._getSoundIds(),m=g.indexOf(i[0]);m>=0?h=parseInt(i[0],10):l=parseFloat(i[0])}else i.length>=2&&(l=parseFloat(i[0]),h=parseInt(i[1],10));var p;if(typeof l<"u"&&l>=0&&l<=1){if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"volume",action:function(){e.volume.apply(e,i)}}),e;typeof h>"u"&&(e._volume=l),h=e._getSoundIds(h);for(var y=0;y<h.length;y++)p=e._soundById(h[y]),p&&(p._volume=l,i[2]||e._stopFade(h[y]),e._webAudio&&p._node&&!p._muted?p._node.gain.setValueAtTime(l,t.ctx.currentTime):p._node&&!p._muted&&(p._node.volume=l*t.volume()),e._emit("volume",p._id))}else return p=h?e._soundById(h):e._sounds[0],p?p._volume:0;return e},fade:function(e,i,l,h){var g=this;if(g._state!=="loaded"||g._playLock)return g._queue.push({event:"fade",action:function(){g.fade(e,i,l,h)}}),g;e=Math.min(Math.max(0,parseFloat(e)),1),i=Math.min(Math.max(0,parseFloat(i)),1),l=parseFloat(l),g.volume(e,h);for(var m=g._getSoundIds(h),p=0;p<m.length;p++){var y=g._soundById(m[p]);if(y){if(h||g._stopFade(m[p]),g._webAudio&&!y._muted){var T=t.ctx.currentTime,v=T+l/1e3;y._volume=e,y._node.gain.setValueAtTime(e,T),y._node.gain.linearRampToValueAtTime(i,v)}g._startFadeInterval(y,e,i,l,m[p],typeof h>"u")}}return g},_startFadeInterval:function(e,i,l,h,g,m){var p=this,y=i,T=l-i,v=Math.abs(T/.01),E=Math.max(4,v>0?h/v:h),P=Date.now();e._fadeTo=l,e._interval=setInterval(function(){var R=(Date.now()-P)/h;P=Date.now(),y+=T*R,y=Math.round(y*100)/100,T<0?y=Math.max(l,y):y=Math.min(l,y),p._webAudio?e._volume=y:p.volume(y,e._id,!0),m&&(p._volume=y),(l<i&&y<=l||l>i&&y>=l)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,p.volume(l,e._id),p._emit("fade",e._id))},E)},_stopFade:function(e){var i=this,l=i._soundById(e);return l&&l._interval&&(i._webAudio&&l._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(l._interval),l._interval=null,i.volume(l._fadeTo,e),l._fadeTo=null,i._emit("fade",e)),i},loop:function(){var e=this,i=arguments,l,h,g;if(i.length===0)return e._loop;if(i.length===1)if(typeof i[0]=="boolean")l=i[0],e._loop=l;else return g=e._soundById(parseInt(i[0],10)),g?g._loop:!1;else i.length===2&&(l=i[0],h=parseInt(i[1],10));for(var m=e._getSoundIds(h),p=0;p<m.length;p++)g=e._soundById(m[p]),g&&(g._loop=l,e._webAudio&&g._node&&g._node.bufferSource&&(g._node.bufferSource.loop=l,l&&(g._node.bufferSource.loopStart=g._start||0,g._node.bufferSource.loopEnd=g._stop,e.playing(m[p])&&(e.pause(m[p],!0),e.play(m[p],!0)))));return e},rate:function(){var e=this,i=arguments,l,h;if(i.length===0)h=e._sounds[0]._id;else if(i.length===1){var g=e._getSoundIds(),m=g.indexOf(i[0]);m>=0?h=parseInt(i[0],10):l=parseFloat(i[0])}else i.length===2&&(l=parseFloat(i[0]),h=parseInt(i[1],10));var p;if(typeof l=="number"){if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"rate",action:function(){e.rate.apply(e,i)}}),e;typeof h>"u"&&(e._rate=l),h=e._getSoundIds(h);for(var y=0;y<h.length;y++)if(p=e._soundById(h[y]),p){e.playing(h[y])&&(p._rateSeek=e.seek(h[y]),p._playStart=e._webAudio?t.ctx.currentTime:p._playStart),p._rate=l,e._webAudio&&p._node&&p._node.bufferSource?p._node.bufferSource.playbackRate.setValueAtTime(l,t.ctx.currentTime):p._node&&(p._node.playbackRate=l);var T=e.seek(h[y]),v=(e._sprite[p._sprite][0]+e._sprite[p._sprite][1])/1e3-T,E=v*1e3/Math.abs(p._rate);(e._endTimers[h[y]]||!p._paused)&&(e._clearTimer(h[y]),e._endTimers[h[y]]=setTimeout(e._ended.bind(e,p),E)),e._emit("rate",p._id)}}else return p=e._soundById(h),p?p._rate:e._rate;return e},seek:function(){var e=this,i=arguments,l,h;if(i.length===0)e._sounds.length&&(h=e._sounds[0]._id);else if(i.length===1){var g=e._getSoundIds(),m=g.indexOf(i[0]);m>=0?h=parseInt(i[0],10):e._sounds.length&&(h=e._sounds[0]._id,l=parseFloat(i[0]))}else i.length===2&&(l=parseFloat(i[0]),h=parseInt(i[1],10));if(typeof h>"u")return 0;if(typeof l=="number"&&(e._state!=="loaded"||e._playLock))return e._queue.push({event:"seek",action:function(){e.seek.apply(e,i)}}),e;var p=e._soundById(h);if(p)if(typeof l=="number"&&l>=0){var y=e.playing(h);y&&e.pause(h,!0),p._seek=l,p._ended=!1,e._clearTimer(h),!e._webAudio&&p._node&&!isNaN(p._node.duration)&&(p._node.currentTime=l);var T=function(){y&&e.play(h,!0),e._emit("seek",h)};if(y&&!e._webAudio){var v=function(){e._playLock?setTimeout(v,0):T()};setTimeout(v,0)}else T()}else if(e._webAudio){var E=e.playing(h)?t.ctx.currentTime-p._playStart:0,P=p._rateSeek?p._rateSeek-p._seek:0;return p._seek+(P+E*Math.abs(p._rate))}else return p._node.currentTime;return e},playing:function(e){var i=this;if(typeof e=="number"){var l=i._soundById(e);return l?!l._paused:!1}for(var h=0;h<i._sounds.length;h++)if(!i._sounds[h]._paused)return!0;return!1},duration:function(e){var i=this,l=i._duration,h=i._soundById(e);return h&&(l=i._sprite[h._sprite][1]/1e3),l},state:function(){return this._state},unload:function(){for(var e=this,i=e._sounds,l=0;l<i.length;l++)i[l]._paused||e.stop(i[l]._id),e._webAudio||(e._clearSound(i[l]._node),i[l]._node.removeEventListener("error",i[l]._errorFn,!1),i[l]._node.removeEventListener(t._canPlayEvent,i[l]._loadFn,!1),i[l]._node.removeEventListener("ended",i[l]._endFn,!1),t._releaseHtml5Audio(i[l]._node)),delete i[l]._node,e._clearTimer(i[l]._id);var h=t._howls.indexOf(e);h>=0&&t._howls.splice(h,1);var g=!0;for(l=0;l<t._howls.length;l++)if(t._howls[l]._src===e._src||e._src.indexOf(t._howls[l]._src)>=0){g=!1;break}return a&&g&&delete a[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,i,l,h){var g=this,m=g["_on"+e];return typeof i=="function"&&m.push(h?{id:l,fn:i,once:h}:{id:l,fn:i}),g},off:function(e,i,l){var h=this,g=h["_on"+e],m=0;if(typeof i=="number"&&(l=i,i=null),i||l)for(m=0;m<g.length;m++){var p=l===g[m].id;if(i===g[m].fn&&p||!i&&p){g.splice(m,1);break}}else if(e)h["_on"+e]=[];else{var y=Object.keys(h);for(m=0;m<y.length;m++)y[m].indexOf("_on")===0&&Array.isArray(h[y[m]])&&(h[y[m]]=[])}return h},once:function(e,i,l){var h=this;return h.on(e,i,l,1),h},_emit:function(e,i,l){for(var h=this,g=h["_on"+e],m=g.length-1;m>=0;m--)(!g[m].id||g[m].id===i||e==="load")&&(setTimeout((function(p){p.call(this,i,l)}).bind(h,g[m].fn),0),g[m].once&&h.off(e,g[m].fn,g[m].id));return h._loadQueue(e),h},_loadQueue:function(e){var i=this;if(i._queue.length>0){var l=i._queue[0];l.event===e&&(i._queue.shift(),i._loadQueue()),e||l.action()}return i},_ended:function(e){var i=this,l=e._sprite;if(!i._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(i._ended.bind(i,e),100),i;var h=!!(e._loop||i._sprite[l][2]);if(i._emit("end",e._id),!i._webAudio&&h&&i.stop(e._id,!0).play(e._id),i._webAudio&&h){i._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var g=(e._stop-e._start)*1e3/Math.abs(e._rate);i._endTimers[e._id]=setTimeout(i._ended.bind(i,e),g)}return i._webAudio&&!h&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,i._clearTimer(e._id),i._cleanBuffer(e._node),t._autoSuspend()),!i._webAudio&&!h&&i.stop(e._id,!0),i},_clearTimer:function(e){var i=this;if(i._endTimers[e]){if(typeof i._endTimers[e]!="function")clearTimeout(i._endTimers[e]);else{var l=i._soundById(e);l&&l._node&&l._node.removeEventListener("ended",i._endTimers[e],!1)}delete i._endTimers[e]}return i},_soundById:function(e){for(var i=this,l=0;l<i._sounds.length;l++)if(e===i._sounds[l]._id)return i._sounds[l];return null},_inactiveSound:function(){var e=this;e._drain();for(var i=0;i<e._sounds.length;i++)if(e._sounds[i]._ended)return e._sounds[i].reset();return new o(e)},_drain:function(){var e=this,i=e._pool,l=0,h=0;if(!(e._sounds.length<i)){for(h=0;h<e._sounds.length;h++)e._sounds[h]._ended&&l++;for(h=e._sounds.length-1;h>=0;h--){if(l<=i)return;e._sounds[h]._ended&&(e._webAudio&&e._sounds[h]._node&&e._sounds[h]._node.disconnect(0),e._sounds.splice(h,1),l--)}}},_getSoundIds:function(e){var i=this;if(typeof e>"u"){for(var l=[],h=0;h<i._sounds.length;h++)l.push(i._sounds[h]._id);return l}else return[e]},_refreshBuffer:function(e){var i=this;return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=a[i._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,t.ctx.currentTime),i},_cleanBuffer:function(e){var i=this,l=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(!e.bufferSource)return i;if(t._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),l))try{e.bufferSource.buffer=t._scratchBuffer}catch{}return e.bufferSource=null,i},_clearSound:function(e){var i=/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent);i||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var o=function(e){this._parent=e,this.init()};o.prototype={init:function(){var e=this,i=e._parent;return e._muted=i._muted,e._loop=i._loop,e._volume=i._volume,e._rate=i._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,i._sounds.push(e),e.create(),e},create:function(){var e=this,i=e._parent,l=t._muted||e._muted||e._parent._muted?0:e._volume;return i._webAudio?(e._node=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(l,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):t.noAudio||(e._node=t._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=i._src,e._node.preload=i._preload===!0?"auto":i._preload,e._node.volume=l*t.volume(),e._node.load()),e},reset:function(){var e=this,i=e._parent;return e._muted=i._muted,e._loop=i._loop,e._volume=i._volume,e._rate=i._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,i=e._parent;i._duration=Math.ceil(e._node.duration*10)/10,Object.keys(i._sprite).length===0&&(i._sprite={__default:[0,i._duration*1e3]}),i._state!=="loaded"&&(i._state="loaded",i._emit("load"),i._loadQueue()),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,i=e._parent;i._duration===1/0&&(i._duration=Math.ceil(e._node.duration*10)/10,i._sprite.__default[1]===1/0&&(i._sprite.__default[1]=i._duration*1e3),i._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var a={},r=function(e){var i=e._src;if(a[i]){e._duration=a[i].duration,f(e);return}if(/^data:[^;]+;base64,/.test(i)){for(var l=atob(i.split(",")[1]),h=new Uint8Array(l.length),g=0;g<l.length;++g)h[g]=l.charCodeAt(g);c(h.buffer,e)}else{var m=new XMLHttpRequest;m.open(e._xhr.method,i,!0),m.withCredentials=e._xhr.withCredentials,m.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach(function(p){m.setRequestHeader(p,e._xhr.headers[p])}),m.onload=function(){var p=(m.status+"")[0];if(p!=="0"&&p!=="2"&&p!=="3"){e._emit("loaderror",null,"Failed loading audio file with status: "+m.status+".");return}c(m.response,e)},m.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete a[i],e.load())},u(m)}},u=function(e){try{e.send()}catch{e.onerror()}},c=function(e,i){var l=function(){i._emit("loaderror",null,"Decoding audio data failed.")},h=function(g){g&&i._sounds.length>0?(a[i._src]=g,f(i,g)):l()};typeof Promise<"u"&&t.ctx.decodeAudioData.length===1?t.ctx.decodeAudioData(e).then(h).catch(l):t.ctx.decodeAudioData(e,h,l)},f=function(e,i){i&&!e._duration&&(e._duration=i.duration),Object.keys(e._sprite).length===0&&(e._sprite={__default:[0,e._duration*1e3]}),e._state!=="loaded"&&(e._state="loaded",e._emit("load"),e._loadQueue())},_=function(){if(t.usingWebAudio){try{typeof AudioContext<"u"?t.ctx=new AudioContext:typeof webkitAudioContext<"u"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch{t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),i=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),l=i?parseInt(i[1],10):null;if(e&&l&&l<9){var h=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!h&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};d.Howler=t,d.Howl=s,typeof _e<"u"?(_e.HowlerGlobal=n,_e.Howler=t,_e.Howl=s,_e.Sound=o):typeof window<"u"&&(window.HowlerGlobal=n,window.Howler=t,window.Howl=s,window.Sound=o)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var s=this;if(!s.ctx||!s.ctx.listener)return s;for(var o=s._howls.length-1;o>=0;o--)s._howls[o].stereo(t);return s},HowlerGlobal.prototype.pos=function(t,s,o){var a=this;if(!a.ctx||!a.ctx.listener)return a;if(s=typeof s!="number"?a._pos[1]:s,o=typeof o!="number"?a._pos[2]:o,typeof t=="number")a._pos=[t,s,o],typeof a.ctx.listener.positionX<"u"?(a.ctx.listener.positionX.setTargetAtTime(a._pos[0],Howler.ctx.currentTime,.1),a.ctx.listener.positionY.setTargetAtTime(a._pos[1],Howler.ctx.currentTime,.1),a.ctx.listener.positionZ.setTargetAtTime(a._pos[2],Howler.ctx.currentTime,.1)):a.ctx.listener.setPosition(a._pos[0],a._pos[1],a._pos[2]);else return a._pos;return a},HowlerGlobal.prototype.orientation=function(t,s,o,a,r,u){var c=this;if(!c.ctx||!c.ctx.listener)return c;var f=c._orientation;if(s=typeof s!="number"?f[1]:s,o=typeof o!="number"?f[2]:o,a=typeof a!="number"?f[3]:a,r=typeof r!="number"?f[4]:r,u=typeof u!="number"?f[5]:u,typeof t=="number")c._orientation=[t,s,o,a,r,u],typeof c.ctx.listener.forwardX<"u"?(c.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),c.ctx.listener.forwardY.setTargetAtTime(s,Howler.ctx.currentTime,.1),c.ctx.listener.forwardZ.setTargetAtTime(o,Howler.ctx.currentTime,.1),c.ctx.listener.upX.setTargetAtTime(a,Howler.ctx.currentTime,.1),c.ctx.listener.upY.setTargetAtTime(r,Howler.ctx.currentTime,.1),c.ctx.listener.upZ.setTargetAtTime(u,Howler.ctx.currentTime,.1)):c.ctx.listener.setOrientation(t,s,o,a,r,u);else return f;return c},Howl.prototype.init=function(t){return function(s){var o=this;return o._orientation=s.orientation||[1,0,0],o._stereo=s.stereo||null,o._pos=s.pos||null,o._pannerAttr={coneInnerAngle:typeof s.coneInnerAngle<"u"?s.coneInnerAngle:360,coneOuterAngle:typeof s.coneOuterAngle<"u"?s.coneOuterAngle:360,coneOuterGain:typeof s.coneOuterGain<"u"?s.coneOuterGain:0,distanceModel:typeof s.distanceModel<"u"?s.distanceModel:"inverse",maxDistance:typeof s.maxDistance<"u"?s.maxDistance:1e4,panningModel:typeof s.panningModel<"u"?s.panningModel:"HRTF",refDistance:typeof s.refDistance<"u"?s.refDistance:1,rolloffFactor:typeof s.rolloffFactor<"u"?s.rolloffFactor:1},o._onstereo=s.onstereo?[{fn:s.onstereo}]:[],o._onpos=s.onpos?[{fn:s.onpos}]:[],o._onorientation=s.onorientation?[{fn:s.onorientation}]:[],t.call(this,s)}}(Howl.prototype.init),Howl.prototype.stereo=function(t,s){var o=this;if(!o._webAudio)return o;if(o._state!=="loaded")return o._queue.push({event:"stereo",action:function(){o.stereo(t,s)}}),o;var a=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof s>"u")if(typeof t=="number")o._stereo=t,o._pos=[t,0,0];else return o._stereo;for(var r=o._getSoundIds(s),u=0;u<r.length;u++){var c=o._soundById(r[u]);if(c)if(typeof t=="number")c._stereo=t,c._pos=[t,0,0],c._node&&(c._pannerAttr.panningModel="equalpower",(!c._panner||!c._panner.pan)&&n(c,a),a==="spatial"?typeof c._panner.positionX<"u"?(c._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),c._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),c._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):c._panner.setPosition(t,0,0):c._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),o._emit("stereo",c._id);else return c._stereo}return o},Howl.prototype.pos=function(t,s,o,a){var r=this;if(!r._webAudio)return r;if(r._state!=="loaded")return r._queue.push({event:"pos",action:function(){r.pos(t,s,o,a)}}),r;if(s=typeof s!="number"?0:s,o=typeof o!="number"?-.5:o,typeof a>"u")if(typeof t=="number")r._pos=[t,s,o];else return r._pos;for(var u=r._getSoundIds(a),c=0;c<u.length;c++){var f=r._soundById(u[c]);if(f)if(typeof t=="number")f._pos=[t,s,o],f._node&&((!f._panner||f._panner.pan)&&n(f,"spatial"),typeof f._panner.positionX<"u"?(f._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),f._panner.positionY.setValueAtTime(s,Howler.ctx.currentTime),f._panner.positionZ.setValueAtTime(o,Howler.ctx.currentTime)):f._panner.setPosition(t,s,o)),r._emit("pos",f._id);else return f._pos}return r},Howl.prototype.orientation=function(t,s,o,a){var r=this;if(!r._webAudio)return r;if(r._state!=="loaded")return r._queue.push({event:"orientation",action:function(){r.orientation(t,s,o,a)}}),r;if(s=typeof s!="number"?r._orientation[1]:s,o=typeof o!="number"?r._orientation[2]:o,typeof a>"u")if(typeof t=="number")r._orientation=[t,s,o];else return r._orientation;for(var u=r._getSoundIds(a),c=0;c<u.length;c++){var f=r._soundById(u[c]);if(f)if(typeof t=="number")f._orientation=[t,s,o],f._node&&(f._panner||(f._pos||(f._pos=r._pos||[0,0,-.5]),n(f,"spatial")),typeof f._panner.orientationX<"u"?(f._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),f._panner.orientationY.setValueAtTime(s,Howler.ctx.currentTime),f._panner.orientationZ.setValueAtTime(o,Howler.ctx.currentTime)):f._panner.setOrientation(t,s,o)),r._emit("orientation",f._id);else return f._orientation}return r},Howl.prototype.pannerAttr=function(){var t=this,s=arguments,o,a,r;if(!t._webAudio)return t;if(s.length===0)return t._pannerAttr;if(s.length===1)if(typeof s[0]=="object")o=s[0],typeof a>"u"&&(o.pannerAttr||(o.pannerAttr={coneInnerAngle:o.coneInnerAngle,coneOuterAngle:o.coneOuterAngle,coneOuterGain:o.coneOuterGain,distanceModel:o.distanceModel,maxDistance:o.maxDistance,refDistance:o.refDistance,rolloffFactor:o.rolloffFactor,panningModel:o.panningModel}),t._pannerAttr={coneInnerAngle:typeof o.pannerAttr.coneInnerAngle<"u"?o.pannerAttr.coneInnerAngle:t._coneInnerAngle,coneOuterAngle:typeof o.pannerAttr.coneOuterAngle<"u"?o.pannerAttr.coneOuterAngle:t._coneOuterAngle,coneOuterGain:typeof o.pannerAttr.coneOuterGain<"u"?o.pannerAttr.coneOuterGain:t._coneOuterGain,distanceModel:typeof o.pannerAttr.distanceModel<"u"?o.pannerAttr.distanceModel:t._distanceModel,maxDistance:typeof o.pannerAttr.maxDistance<"u"?o.pannerAttr.maxDistance:t._maxDistance,refDistance:typeof o.pannerAttr.refDistance<"u"?o.pannerAttr.refDistance:t._refDistance,rolloffFactor:typeof o.pannerAttr.rolloffFactor<"u"?o.pannerAttr.rolloffFactor:t._rolloffFactor,panningModel:typeof o.pannerAttr.panningModel<"u"?o.pannerAttr.panningModel:t._panningModel});else return r=t._soundById(parseInt(s[0],10)),r?r._pannerAttr:t._pannerAttr;else s.length===2&&(o=s[0],a=parseInt(s[1],10));for(var u=t._getSoundIds(a),c=0;c<u.length;c++)if(r=t._soundById(u[c]),r){var f=r._pannerAttr;f={coneInnerAngle:typeof o.coneInnerAngle<"u"?o.coneInnerAngle:f.coneInnerAngle,coneOuterAngle:typeof o.coneOuterAngle<"u"?o.coneOuterAngle:f.coneOuterAngle,coneOuterGain:typeof o.coneOuterGain<"u"?o.coneOuterGain:f.coneOuterGain,distanceModel:typeof o.distanceModel<"u"?o.distanceModel:f.distanceModel,maxDistance:typeof o.maxDistance<"u"?o.maxDistance:f.maxDistance,refDistance:typeof o.refDistance<"u"?o.refDistance:f.refDistance,rolloffFactor:typeof o.rolloffFactor<"u"?o.rolloffFactor:f.rolloffFactor,panningModel:typeof o.panningModel<"u"?o.panningModel:f.panningModel};var _=r._panner;_||(r._pos||(r._pos=t._pos||[0,0,-.5]),n(r,"spatial"),_=r._panner),_.coneInnerAngle=f.coneInnerAngle,_.coneOuterAngle=f.coneOuterAngle,_.coneOuterGain=f.coneOuterGain,_.distanceModel=f.distanceModel,_.maxDistance=f.maxDistance,_.refDistance=f.refDistance,_.rolloffFactor=f.rolloffFactor,_.panningModel=f.panningModel}return t},Sound.prototype.init=function(t){return function(){var s=this,o=s._parent;s._orientation=o._orientation,s._stereo=o._stereo,s._pos=o._pos,s._pannerAttr=o._pannerAttr,t.call(this),s._stereo?o.stereo(s._stereo):s._pos&&o.pos(s._pos[0],s._pos[1],s._pos[2],s._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var s=this,o=s._parent;return s._orientation=o._orientation,s._stereo=o._stereo,s._pos=o._pos,s._pannerAttr=o._pannerAttr,s._stereo?o.stereo(s._stereo):s._pos?o.pos(s._pos[0],s._pos[1],s._pos[2],s._id):s._panner&&(s._panner.disconnect(0),s._panner=void 0,o._refreshBuffer(s)),t.call(this)}}(Sound.prototype.reset);var n=function(t,s){s=s||"spatial",s==="spatial"?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,typeof t._panner.positionX<"u"?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),typeof t._panner.orientationX<"u"?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}})()}(ft)),ft}var We=wo();const xo=`varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,bo=`uniform sampler2D uTextureA;
uniform sampler2D uTextureB;
uniform float uBrightness;
uniform float uContrast;
uniform float uMix;
uniform float uAberrationAmount; // Add this uniform in JS
varying vec2 vUv;

void main() {
  // Chromatic offset vector (can be radial, here it's a fixed offset)
  vec2 offset = vec2(uAberrationAmount);

  // Sample each channel at slightly different UVs
  vec4 texA = vec4(
    texture2D(uTextureA, vUv + offset).r,   // Red
    texture2D(uTextureA, vUv).g,            // Green
    texture2D(uTextureA, vUv - offset).b,   // Blue
    1.0
  );

  vec4 texB = vec4(
    texture2D(uTextureB, vUv + offset).r,
    texture2D(uTextureB, vUv).g,
    texture2D(uTextureB, vUv - offset).b,
    1.0
  );

  vec4 mixed = mix(texA, texB, uMix);

  // Apply brightness and contrast
  mixed.rgb = (mixed.rgb - 0.5) * uContrast + 0.5;
  mixed.rgb *= uBrightness;

  gl_FragColor = mixed;
}`,Ao=`varying vec2 vUv;

void main() {
  vUv = uv - 0.5;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,Eo=`varying vec2 vUv;
uniform float uSize;
uniform vec3 uLineColor;

float gridLine(float coord, float size) {
  float line = abs(fract(coord * size) - 0.5);
  return smoothstep(0.05, 0.0, line); // smooth lines
}

void main() {
  float dist = length(vUv) * 2.0;
  float alpha = smoothstep(1.0, 0.5, dist);

  float xLine = gridLine(vUv.x, uSize);
  float yLine = gridLine(vUv.y, uSize);
  float lineStrength = max(xLine, yLine);

  gl_FragColor = vec4(uLineColor, alpha * lineStrength * 0.1);
}`,So=`uniform float uTime;
uniform sampler2D uPerlinTexture;

varying vec2 vUv;

vec2 rotate2D(vec2 pos, float angle) {
  float s = sin(angle);
  float c = cos(angle);
  return mat2(c, -s, s, c) * pos;
}

void main() {
  vec3 newPosition = position;

  float twistPerlin = texture(uPerlinTexture, vec2(0.5, uv.y * 0.2 - uTime * 0.01)).r;
  float angle = twistPerlin * 3.0;
  newPosition.xz = rotate2D(newPosition.xz, angle);

  vec2 windOffset = vec2(
    texture(uPerlinTexture, vec2(0.25, uTime * 0.01)).r - 0.5,
    texture(uPerlinTexture, vec2(0.75, uTime * 0.01)).r - 0.5
  );
  windOffset *= pow(uv.y, 2.0) * 1.5;
  newPosition.xz += windOffset;

  gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
  vUv = uv;
}`,Lo=`uniform float uTime;
uniform sampler2D uPerlinTexture;
uniform vec3 uColor;

varying vec2 vUv;

void main() {
  vec2 smokeUv = vUv;
  smokeUv.x *= 0.5;
  smokeUv.y *= 0.3;
  smokeUv.y -= uTime * 0.04;

  float smoke = texture(uPerlinTexture, smokeUv).r;
  smoke = smoothstep(0.5, 1.0, smoke);

  smoke *= smoothstep(0.0, 0.1, vUv.x);
  smoke *= smoothstep(1.0, 0.9, vUv.x);
  smoke *= smoothstep(0.0, 0.1, vUv.y);
  smoke *= smoothstep(1.0, 0.4, vUv.y);

/* gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0); */
gl_FragColor = vec4(uColor, smoke);
}`,Do=`varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,Ro=`uniform vec3 uColor;
varying vec2 vUv;

void main() {
  float fade = smoothstep(0.0, 0.3, vUv.x) * (1.0 - smoothstep(0.7, 1.0, vUv.x));
  fade *= smoothstep(0.0, 0.3, vUv.y) * (1.0 - smoothstep(0.7, 1.0, vUv.y));
  gl_FragColor = vec4(uColor, fade * 0.3);
}`,Mo=document.querySelector("#experience-canvas"),O={width:window.innerWidth,height:window.innerHeight},Qt=new vs,xe=new k,z=new _s;let C=!1,ie=!1,H=!1,wt=!1;const gn=[],yn=[],Tn=[];let Ue,Ge,je,Ke,B,Et,St,Lt,Dt,Rt,Mt,Pt,It,kt,Re=0,Me=0;const de=[];let j=[],q=null,N=0,ge=1,D,ne,ht=!0;const pt=new b(0,0,-.5),Pe={work:document.querySelector(".modal.work"),about:document.querySelector(".modal.about"),contact:document.querySelector(".modal.contact"),legal:document.querySelector(".modal.legal")},vn=document.getElementById("loading-text"),Po=document.getElementById("progress-bar"),ze=document.getElementById("enter-button"),Ie=document.getElementById("loading-screen"),Ve=document.getElementById("enter-button-mute"),Je=new ms;let wn=!1;Je.onProgress=(d,n,t)=>{const s=Math.floor(n/t*100);L.to(Po,{value:s,duration:.3,ease:"power1.out"}),L.to(vn,{textContent:`Loading ${n} of ${t}...`,duration:.3,ease:"none"})};Je.onLoad=()=>{wn=!0,vn.textContent="Loaded!",ze.disabled=!1,Ve.disabled=!1,ze.classList.add("active"),Ve.classList.add("active")};function Ze(d=!0){L.timeline({onComplete:()=>{wt=!0,Ie.remove(),Bo()}}).to(Ie,{transformOrigin:"center center",rotationX:10,rotationY:-5,scale:1.02,y:"-2vh",duration:.4,ease:"power2.out"}).to(Ie,{rotationX:-5,rotationY:5,scale:.95,y:"1vh",duration:.3,ease:"power1.inOut"}).to(Ie,{rotationX:70,rotationY:-25,scale:.05,x:"20vw",y:"-250vh",opacity:0,duration:1.2,ease:"expo.in"}).to(".white-overlay",{opacity:.7,duration:.35,ease:"sine.inOut",yoyo:!0,repeat:1},"-=0.8"),d&&(be.play(),H=!0,Ae.src="/icon/music_note_124dp_3B3935_FILL0_wght700_GRAD-25_opsz48.svg")}ze.addEventListener("touchend",d=>{C=!0,d.preventDefault(),Ze(!0)},{passive:!1});ze.addEventListener("click",d=>{C||(d.preventDefault(),Ze(!0))},{passive:!1});Ve.addEventListener("touchend",d=>{C=!0,d.preventDefault(),H=!1,Ze(!1)},{passive:!1});Ve.addEventListener("click",d=>{C||(d.preventDefault(),H=!1,Ze(!1))},{passive:!1});document.addEventListener("DOMContentLoaded",function(){localStorage.getItem("theme")==="night"?(F=!0,document.documentElement.setAttribute("data-theme","night"),fe.src="/icon/dark_mode_124dp_3B3935_FILL0_wght700_GRAD200_opsz48.svg",Ee("night")):(F=!1,document.documentElement.removeAttribute("data-theme"),fe.src="/icon/light_mode_124dp_3B3935_FILL0_wght700_GRAD200_opsz48.svg",Ee("day"));const n=document.getElementById("tip-text");"ontouchstart"in window||navigator.maxTouchPoints>0?n.textContent=" Tip: Tap and swipe to explore.":n.textContent=" Tip: Click and drag to explore."});const Qe=document.getElementById("theme-toggle"),fe=document.getElementById("theme-icon");let F=!1;Qe.addEventListener("touchend",d=>{C=!0,d.preventDefault(),F=!F,Ee(F?"night":"day"),F?(document.documentElement.setAttribute("data-theme","night"),fe.src="/icon/dark_mode_124dp_3B3935_FILL0_wght700_GRAD200_opsz48.svg"):(document.documentElement.removeAttribute("data-theme"),fe.src="/icon/light_mode_124dp_3B3935_FILL0_wght700_GRAD200_opsz48.svg"),localStorage.setItem("theme",F?"night":"day")},{passive:!1});Qe.addEventListener("click",d=>{C||(d.preventDefault(),F=!F,Ee(F?"night":"day"),F?(document.documentElement.setAttribute("data-theme","night"),fe.src="/icon/dark_mode_124dp_3B3935_FILL0_wght700_GRAD200_opsz48.svg"):(document.documentElement.removeAttribute("data-theme"),fe.src="/icon/light_mode_124dp_3B3935_FILL0_wght700_GRAD200_opsz48.svg"),localStorage.setItem("theme",F?"night":"day"))},{passive:!1});const Io={DJ1:"DJ1",DJ2:"DJ2",DJ3:"DJ3",DJ4:"DJ4",DJ5:"DJ5",DJ6:"DJ6",DJ7:"DJ7",DJ8:"DJ8",DJ9:"DJ9"},xn={};Object.values(Io).forEach(d=>{xn[d]=new We.Howl({src:[`/audio/DJ/${d}.ogg`],preload:!0,volume:.7})});const ke=new We.Howl({src:["/audio/sound/403007__inspectorj__ui-confirmation-alert-a2.ogg"],volume:.7,preload:!0}),$t=new We.Howl({src:["/audio/sound/770169__j1cr0wav3__itemcollect.ogg"],volume:.7,preload:!0}),be=new We.Howl({src:["/audio/falselyclaimed-bit-beats-3-168873.ogg"],loop:!0,volume:.4}),Ae=document.getElementById("music-icon"),$e=document.getElementById("music-toggle");$e.addEventListener("touchend",d=>{C=!0,d.preventDefault(),H=!H,H?(be.play(),Ae.src="/icon/music_note_124dp_3B3935_FILL0_wght700_GRAD-25_opsz48.svg"):(be.pause(),Ae.src="/icon/music_off_124dp_3B3935_FILL0_wght700_GRAD-25_opsz48.svg")},{passive:!1});$e.addEventListener("click",d=>{C||(d.preventDefault(),H=!H,H?(be.play(),Ae.src="/icon/music_note_124dp_3B3935_FILL0_wght700_GRAD-25_opsz48.svg"):(be.pause(),Ae.src="/icon/music_off_124dp_3B3935_FILL0_wght700_GRAD-25_opsz48.svg"))},{passive:!1});const bn=document.getElementById("experience"),Oe=d=>{d.classList.remove("hidden"),ie=!0,M.enabled=!1,bn.classList.add("blur"),et.style.display="block",$e.classList.add("hidden"),Qe.classList.add("hidden"),tt.classList.add("hidden"),de.forEach(n=>{n.userData&&n.userData.hoverTimeline&&(n.userData.hoverDisabled=!0)}),document.body.style.cursor="default",j=[],L.set(d,{scaleY:0,scaleX:1,opacity:0,transformOrigin:"center center"}),L.to(d,{scaleY:1,opacity:1,duration:.5,ease:"power3.out"})},Xe=d=>{ie=!1,M.enabled=!0,bn.classList.remove("blur"),et.style.display="none",$e.classList.remove("hidden"),Qe.classList.remove("hidden"),tt.classList.remove("hidden"),de.forEach(n=>{n.userData&&n.userData.hoverTimeline&&(n.userData.hoverDisabled=!1)}),L.to(d,{scaleY:0,opacity:0,duration:.4,ease:"power2.in",onComplete:()=>{d.classList.add("hidden")}})},et=document.querySelector(".overlay");et.addEventListener("touchend",d=>{C=!0,d.preventDefault();const n=document.querySelector(".modal:not(.hidden)");ie&&n&&Xe(n)},{passive:!1});et.addEventListener("click",d=>{if(C)return;d.preventDefault();const n=document.querySelector(".modal:not(.hidden)");ie&&n&&Xe(n)},{passive:!1});window.addEventListener("DOMContentLoaded",()=>{const d="ontouchstart"in window||navigator.maxTouchPoints>0;document.body.classList.toggle("no-touch",!d)});const ko=[{position:new b(-5.5,8,14.7),target:new b(-0,2,-.9)},{position:new b(1.2,5.1,6.2),target:new b(-.2,2,-.8)},{position:new b(-.8,6.1,6.6),target:new b(2,5,2.6)}],Oo=[{position:new b(-12.9,8.5,20.5),target:new b(.3,2.6,-.5)},{position:new b(1,4.7,6.3),target:new b(-.3,1.6,-.6)},{position:new b(-1.1,3.6,6.6),target:new b(1.8,3.6,2.6)}],Co=window.innerWidth<768,en=Co?Oo:ko;let ve=1;const tt=document.getElementById("camera-toggle");function An(){const{position:d,target:n}=en[ve];No(d,n),ve=(ve+1)%en.length}tt.addEventListener("click",d=>{d.preventDefault(),An()});tt.addEventListener("touchend",d=>{C=!0,d.preventDefault(),An()},{passive:!1});function No(d,n){L.to($.position,{x:d.x,y:d.y,z:d.z,duration:2,ease:"power2.inOut"}),L.to(M.target,{x:n.x,y:n.y,z:n.z,duration:2,ease:"power2.inOut",onUpdate:()=>M.update()})}const $=new fn(35,O.width/O.height,.1,200),he=new gs({canvas:Mo,antialias:!0});he.setSize(O.width,O.height);he.setPixelRatio(Math.min(window.devicePixelRatio,2));const M=new As($,he.domElement);M.minDistance=5;M.maxDistance=45;M.minPolarAngle=0;M.maxPolarAngle=Math.PI/2;M.minAzimuthAngle=-1/0;M.maxAzimuthAngle=1/0;M.enableDamping=!0;M.dampingFactor=.05;M.update();window.innerWidth<768?($.position.set(-12.9,8.5,20.5),M.target.set(.3,2.6,-.5)):($.position.set(-5.5,8,14.7),M.target.set(-0,2,-.9));window.addEventListener("resize",()=>{O.width=window.innerWidth,O.height=window.innerHeight,$.aspect=O.width/O.height,$.updateProjectionMatrix(),he.setSize(O.width,O.height),he.setPixelRatio(Math.min(window.devicePixelRatio,2))});window.addEventListener("mousemove",d=>{C=!1,xe.x=d.clientX/O.width*2-1,xe.y=-(d.clientY/O.height)*2+1});window.addEventListener("touchstart",d=>{ie||(d.preventDefault(),xe.x=d.touches[0].clientX/O.width*2-1,xe.y=-(d.touches[0].clientY/O.height)*2+1)},{passive:!1});function En(){var t;if(j&&j.length>0){const s=j[0].object;s.userData.clickTimeline&&s.userData.clickTimeline.restart(),s.name.includes("workbtn")?Oe(Pe.work):s.name.includes("aboutbtn")?Oe(Pe.about):s.name.includes("contactbtn")?Oe(Pe.contact):s.name.includes("legalbtn")&&Oe(Pe.legal)}if(!j||j.length===0)return;const d=j[0].object;if(d.name.includes("monitor")&&N<3&&(H&&N<3&&(ke.currentTime=0,ke.play()),ge=N+1,(t=D==null?void 0:D.material)!=null&&t.uniforms)){const s=D.material.uniforms;s.uTextureA.value=J[N],s.uTextureB.value=J[ge],s.uMix.value=0,L.to(s.uMix,{value:1,duration:.5,ease:"power2.inOut",onComplete:()=>{N=ge,s.uTextureA.value=J[N],s.uTextureB.value=J[N],s.uMix.value=0}})}const n=d.name.match(/DJ[1-9]/);if(n&&H&&xn[n[0]].play(),d.name.includes("pcbtn")&&D&&D.material&&D.material.uniforms){N=0,ge=1;const s=D.material.uniforms;s.uTextureA.value=J[N],s.uTextureB.value=J[N],s.uMix.value=0,H&&(ke.currentTime=0,ke.play())}if(d.name.includes("slider")&&ne){H&&($t.currentTime=0,$t.play());const s=ne.userData.originalPosition;ht?L.to(ne.position,{x:s.x+pt.x,y:s.y+pt.y,z:s.z+pt.z,duration:.8,ease:"power2.inOut"}):L.to(ne.position,{x:s.x,y:s.y,z:s.z,duration:.8,ease:"power2.inOut"}),ht=!ht}(d.name.includes("slider")||d.name.includes("pcbtn")||d.name.includes("DJ"))&&(d.userData.originalColor||(d.userData.originalColor=d.material.color.clone()),L.to(d.material.color,{r:1,g:3,b:1,duration:.2,yoyo:!0,repeat:1,onComplete:()=>{d.material.color.copy(d.userData.originalColor)}}))}window.addEventListener("touchend",d=>{ie||(d.preventDefault(),En())},{passive:!1});window.addEventListener("click",En);document.querySelectorAll(".modal-exit-button").forEach(d=>{d.addEventListener("touchend",n=>{C=!0;const t=n.target.closest(".modal");Xe(t)},{passive:!1}),d.addEventListener("click",n=>{if(C)return;const t=n.target.closest(".modal");Xe(t)},{passive:!1})});const se=new ln(Je),Sn={terrain:{day:"/textures/terrain_texture.webp",night:"/textures/night-texture/terrain_texture_night.webp"},other:{day:"/textures/other_texture.webp",night:"/textures/night-texture/other_texture_night.webp"},pcwei:{day:"/textures/pcwei_texture.webp",night:"/textures/night-texture/pcwei_texture_night.webp"}},J=[se.load("/textures/monitor/monitor_A_texture.webp"),se.load("/textures/monitor/monitor_B_texture.webp"),se.load("/textures/monitor/monitor_C_texture.webp"),se.load("/textures/monitor/monitor_D_texture.webp")];J.forEach(d=>{d.flipY=!1});const oe={day:{},night:{}};Object.entries(Sn).forEach(([d,n])=>{const t=se.load(n.day);t.flipY=!1,t.colorSpace=K,t.minFilter=Q,t.magFilter=Q,oe.day[d]=t;const s=se.load(n.night);s.flipY=!1,s.colorSpace=K,s.minFilter=Q,s.magFilter=Q,oe.night[d]=s});const Ln=new Fs;Ln.setDecoderPath("/draco/");const Dn=new Bs(Je);Dn.setDRACOLoader(Ln);const Fo={default:{scale:[1.2,1.2,1.2],position:[0,0,0],rotation:[0,-Math.PI/8,0]},v2:{scale:[1.1,1.5,1.1],position:[0,.05,0],rotation:[0,Math.PI/18,0]},v3:{scale:[1.2,1.5,1.2],position:[0,0,0],rotation:[0,0,0]},DJ:{scale:[1.2,1.2,1.2],position:[0,0,0],rotation:[0,Math.PI/3,0]},slider:{scale:[1.1,1.2,1.1],position:[0,0,0],rotation:[0,0,0]},pcbtn:{scale:[1.2,1.1,1.1],position:[0,0,0],rotation:[0,0,0]},Tthings:{scale:[1.2,1,1.2],position:[0,0,0],rotation:[0,0,0]}},Ho={DJ:{scale:[1,1.5,1],position:[0,-.03,0],duration:.3,easeOut:"elastic.out(1, 0.3)"},pcbtn:{scale:[1,1,1],position:[0,0,-.02],duration:.3,easeOut:"elastic.out(1, 0.3)"}};Dn.load("/models/desert.glb",d=>{const n=d.scene;z.userData.modelRoot=n;const t=new ys().setPath("/textures/skymap/").load(["px.webp","nx.webp","py.webp","ny.webp","pz.webp","nz.webp"]);z.environment=t,d.scene.traverse(s=>{if(!s.isMesh)return;const o=s.name;if(Object.keys(Sn).forEach(r=>{o.includes(r)&&(s.material=new te({map:oe.day[r]}),s.material.map.minFilter=Q,s.userData.textureKey=r)}),o.includes("pcwei")){const r="pcwei";s.material=new bt({map:oe.day[r],metalness:.9,roughness:.2,envMap:t,envMapIntensity:3}),s.userData.textureKey=r}if(o.includes("slider")&&(ne=s,s.userData.originalPosition=s.position.clone(),de.push(s)),o.includes("cloud")){const r="other";s.material=new te({map:oe.day[r],transparent:!0,opacity:.7,depthWrite:!1}),s.userData.textureKey=r,gn.push({mesh:s,baseY:s.position.y,floatSpeed:Math.random()*.1+.05,floatOffset:Math.random()*Math.PI*2,rotationSpeed:Math.random()*2e-4+5e-5})}if(o.includes("roA")&&yn.push({mesh:s}),o.includes("raB")&&Tn.push({mesh:s}),o.includes("raycaster")&&de.push(s),o.includes("monitor")&&(D=s,s.material=new Ye({uniforms:{uTextureA:{value:J[N]},uTextureB:{value:J[ge]},uBrightness:{value:0},uContrast:{value:0},uMix:{value:0},uAberrationAmount:{value:.01}},vertexShader:xo,fragmentShader:bo})),(o.includes("DJ")||o.includes("slider")||o.includes("pcbtn")||o.includes("workbtn")||o.includes("aboutbtn")||o.includes("contactbtn")||o.includes("legalbtn"))&&(s.userData.initialScaleForIntro=s.scale.clone(),s.scale.set(0,0,0)),o.includes("DJ")||o.includes("pcbtn")){let r=o.includes("DJ")?"DJ":"pcbtn";const u=Ho[r],c=s.userData.initialScaleForIntro||s.scale,[f,_,e]=u.scale,[i,l,h]=u.position,g=s.position.clone(),m=L.timeline({paused:!0});m.to(s.scale,{x:c.x*f,y:c.y*_,z:c.z*e,duration:u.duration*.5,ease:"power2.in"}),m.to(s.position,{x:g.x+i,y:g.y+l,z:g.z+h,duration:u.duration*.5,ease:"power2.out"},0),m.to(s.scale,{x:c.x,y:c.y,z:c.z,duration:u.duration,ease:u.easeOut}),m.to(s.position,{x:g.x,y:g.y,z:g.z,duration:u.duration,ease:u.easeOut},`-=${u.duration}`),s.userData.clickTimeline=m,de.push(s)}if(o.includes("workbtn")&&(Ue=s),o.includes("contactbtn")&&(Ge=s),o.includes("aboutbtn")&&(je=s),o.includes("legalbtn")&&(Ke=s),o.includes("pcbtn")&&(B=s),o.includes("DJ1")&&(Et=s),o.includes("DJ2")&&(St=s),o.includes("DJ3")&&(Lt=s),o.includes("DJ4")&&(Dt=s),o.includes("DJ5")&&(Rt=s),o.includes("DJ6")&&(Mt=s),o.includes("DJ7")&&(Pt=s),o.includes("DJ8")&&(It=s),o.includes("DJ9")&&(kt=s),o.includes("DJ")||o.includes("slider")||o.includes("pcbtn")||o.includes("workbtn")||o.includes("aboutbtn")||o.includes("contactbtn")||o.includes("legalbtn")||o.includes("hover")){s.userData.initialScale=s.userData.initialScaleForIntro?s.userData.initialScaleForIntro.clone():s.scale.clone(),s.userData.initialPosition=s.position.clone(),s.userData.initialRotation=s.rotation.clone();let r="default";o.includes("v2")?r="v2":o.includes("v3")?r="v3":o.includes("DJ")?r="DJ":o.includes("Tthings")?r="Tthings":o.includes("slider")?r="slider":o.includes("pcbtn")&&(r="pcbtn");const u=Fo[r],[c,f,_]=u.scale,[e,i,l]=u.position,[h,g,m]=u.rotation,p=L.timeline({paused:!0});p.to(s.scale,{x:s.userData.initialScale.x*c,y:s.userData.initialScale.y*f,z:s.userData.initialScale.z*_,duration:.3,ease:"power2.out"},0),p.to(s.position,{x:s.userData.initialPosition.x+e,y:s.userData.initialPosition.y+i,z:s.userData.initialPosition.z+l,duration:.3,ease:"power2.out"},0),p.to(s.rotation,{x:s.userData.initialRotation.x+h,y:s.userData.initialRotation.y+g,z:s.userData.initialRotation.z+m,duration:.3,ease:"power2.out"},0),s.userData.hoverTimeline=p}Ee(F?"night":"day")}),z.add(n)});function Bo(){L.timeline({defaults:{duration:.8,ease:"back.out(1.8)"}}).to(Ue.scale,{x:1,y:1,z:1}).to(je.scale,{x:1,y:1,z:1},"-=0.6").to(Ge.scale,{x:1,y:1,z:1},"-=0.6").to(Ke.scale,{x:1,y:1,z:1},"-=0.6").eventCallback("onComplete",()=>n.play());const n=L.timeline({paused:!0,defaults:{duration:.8,ease:"back.out(1.8)"}});n.to(B.scale,{x:1,y:1,z:1}).to(ne.scale,{x:1,y:1,z:1},"-=0.6").to(Et.scale,{x:1,y:1,z:1},"-=0.6").to(St.scale,{x:1,y:1,z:1},"-=0.6").to(Lt.scale,{x:1,y:1,z:1},"-=0.6").to(Dt.scale,{x:1,y:1,z:1},"-=0.6").to(Rt.scale,{x:1,y:1,z:1},"-=0.6").to(Mt.scale,{x:1,y:1,z:1},"-=0.6").to(Pt.scale,{x:1,y:1,z:1},"-=0.6").to(It.scale,{x:1,y:1,z:1},"-=0.6").to(kt.scale,{x:1,y:1,z:1},"-=0.6")}const xt=100,tn=1,Uo=new qe(xt,xt,tn,tn),Rn=new Ye({transparent:!0,uniforms:{uSize:{value:xt},uLineColor:{value:new G(.2,.2,.2)}},vertexShader:Ao,fragmentShader:Eo}),Ot=new Se(Uo,Rn);Ot.rotation.x=-Math.PI/2;Ot.position.set(.5,-2.01,.5);z.add(Ot);const Mn=new Ye({uniforms:{uColor:{value:new G(16711680)}},vertexShader:Do,fragmentShader:Ro,transparent:!0,depthWrite:!1}),nt=new Se(new qe(100,.1),Mn.clone());nt.material.uniforms.uColor.value.set(16711680);nt.rotation.x=-Math.PI/2;nt.position.set(0,-2,0);z.add(nt);const Le=new Se(new qe(100,.1),Mn.clone());Le.material.uniforms.uColor.value.set(65280);Le.rotation.z=Math.PI/2;Le.rotation.x=-Math.PI/2;Le.position.set(0,-2,0);z.add(Le);const st=new qe(2.5,8,16,64);st.translate(-.5,5,-2);st.scale(.5,.5,.5);st.rotateY(-Math.PI/2.2);const Ct=se.load("/shaders/perlin.png");Ct.wrapS=we;Ct.wrapT=we;const Nt=new Ye({uniforms:{uTime:new rt(0),uPerlinTexture:new rt(Ct),uColor:new rt(new G(1,1,1))},vertexShader:So,fragmentShader:Lo,side:dn,transparent:!0,depthWrite:!1}),Pn=new Se(st,Nt);Pn.position.set(0,2,0);z.add(Pn);function Ee(d){const n=z.userData.modelRoot;n&&(Rn.uniforms.uLineColor.value.set(d==="night"?.4:.2,d==="night"?.4:.2,d==="night"?.4:.2),Nt.uniforms.uColor.value.set(d==="night"?.7:1,d==="night"?.3:1,d==="night"?.1:1),n.traverse(t=>{var o;if(!t.isMesh)return;const s=t.userData.textureKey;if(s&&((o=oe[d])!=null&&o[s])){const a=oe[d][s];t.material.map!==a&&(t.material.map=a,t.material.needsUpdate=!0)}}),z.background=new G(d==="night"?"#1a1a1a":"#c5dba7"))}const Go=new Ts;let nn="default";function _t(d){d!==nn&&(document.body.style.cursor=d,nn=d)}let mt=!1,me=null,Ce=!1;const In=()=>{var o,a;M.update();const d=Go.getElapsedTime(),s=Fe.degToRad(180)+Math.sin(d*1.5)*Fe.degToRad(10/2);if(Nt.uniforms.uTime.value=d,gn.forEach(r=>{const u=r.mesh;u.position.y=r.baseY+Math.sin(d*r.floatSpeed+r.floatOffset)*.5,u.rotation.y+=r.rotationSpeed}),yn.forEach(r=>{r.mesh.rotation.x=s}),Tn.forEach(r=>{r.mesh.rotation.x=-s}),wn&&!ie){Qt.setFromCamera(xe,$),j=Qt.intersectObjects(de);let r=null,u=!1,c=!1,f=!1;if(j.length>0&&(r=j[0].object,u=r.name.includes("monitor"),c=r.name.includes("pointer"),f=r.name.includes("hover")),f&&!r.userData.hoverDisabled?r!==q&&(q&&q.userData.hoverTimeline&&q.userData.hoverTimeline.reverse(),r.userData.hoverTimeline&&r.userData.hoverTimeline.play(),q=r):q&&q.userData.hoverTimeline&&(q.userData.hoverTimeline.reverse(),q=null),_t(u&&N===3?"not-allowed":c||u?"pointer":"default"),wt&&((o=D==null?void 0:D.material)!=null&&o.uniforms)){const _=D.material.uniforms;Re+=(1-Re)*.05,Me+=(1-Me)*.05,_.uBrightness.value=Re,_.uContrast.value=Me,Math.abs(1-Re)<.01&&Math.abs(1-Me)<.01&&(_.uBrightness.value=1,_.uContrast.value=1,wt=!1)}}if(B&&B.material&&(N===3?B.material.color.setRGB(4,2,2):(B.userData.originalColor||(B.userData.originalColor=B.material.color.clone()),B.material.color.copy(B.userData.originalColor))),ve===2&&!mt&&(mt=!0,(a=D==null?void 0:D.material)!=null&&a.uniforms&&L.to(D.material.uniforms.uBrightness,{value:1.18,duration:.7,yoyo:!0,repeat:1,ease:"power1.inOut"}),[ne,B.userData.glowActive?null:B,Et,St,Lt,Dt,Rt,Mt,Pt,It,kt].filter(Boolean).forEach(u=>{if(!(u!=null&&u.material))return;u.userData.originalColor||(u.userData.originalColor=u.material.color.clone());let c=u.name.includes("slider")?{r:3,g:3,b:3}:{r:1.5,g:1.5,b:1.5};L.to(u.material.color,{...c,duration:.7,yoyo:!0,repeat:1,onComplete:()=>{u.material.color.copy(u.userData.originalColor)}})}),setTimeout(()=>{mt=!1},1500)),ve===0){if(!Ce){Ce=!0;const r=[Ue,Ge,je,Ke];me=L.timeline({repeat:-1,paused:!1}),r.forEach((u,c)=>{u!=null&&u.material&&(u.userData.originalColor||(u.userData.originalColor=u.material.color.clone()),me.to(u.material.color,{r:1.7,g:1.7,b:1.7,duration:.7,yoyo:!0,repeat:1,ease:"power1.inOut",onComplete:()=>{u.material.color.copy(u.userData.originalColor)}},c*.3))})}}else Ce&&me&&(me.kill(),me=null,Ce=!1,[Ue,Ge,je,Ke].forEach(r=>{var u;(u=r==null?void 0:r.userData)!=null&&u.originalColor&&r.material.color.copy(r.userData.originalColor)}));he.render(z,$),requestAnimationFrame(In)};In();
