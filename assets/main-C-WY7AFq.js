import{C as Ls,V as w,M as ue,T as le,Q as ke,S as Ot,a as M,R as As,P as Ds,b as Ne,L as Jt,F as Fe,c as z,d as V,B as Qt,e as Te,f as U,g as mt,h as vs,i as gt,j as $t,k as xe,l as X,m as Ss,n as Ms,D as Ps,o as Ue,I as Is,p as Cs,O as es,q as ts,r as Os,s as ks,t as ss,N as Ns,u as Fs,v as Us,w as $,x as ns,y as be,z as js,A as Hs,E as Bs,G as nt,H as Gs,J as xt,K as is,U as se,W as zs,X as Ks,Y as Le,Z as Vs,_ as Xs,$ as Ys,a0 as Ws,a1 as it,a2 as os,a3 as qs,a4 as Zs,a5 as Js,a6 as Qs,a7 as $s,a8 as rs,a9 as en,aa as kt,ab as Nt,ac as Ft,ad as Ut,ae as tn,af as sn,ag as nn,ah as on,ai as rn,aj as an,ak as A,al as cn,am as ln,an as Xe,ao as Ye,ap as ot,aq as un,ar as hn}from"./vendor-xVeN9iEI.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();const jt={type:"change"},wt={type:"start"},as={type:"end"},De=new As,Ht=new Ds,dn=Math.cos(70*Ne.DEG2RAD),fn=new w(-3,-1,-4),pn=new w(2,5,8),R=new w,S=2*Math.PI,b={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},rt=1e-6;class mn extends Ls{constructor(e,t=null){super(e,t),this.state=b.NONE,this.enabled=!0,this.target=new w,this.cursor=new w,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.keyRotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:ue.ROTATE,MIDDLE:ue.DOLLY,RIGHT:ue.PAN},this.touches={ONE:le.ROTATE,TWO:le.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this._lastPosition=new w,this._lastQuaternion=new ke,this._lastTargetPosition=new w,this._quat=new ke().setFromUnitVectors(e.up,new w(0,1,0)),this._quatInverse=this._quat.clone().invert(),this._spherical=new Ot,this._sphericalDelta=new Ot,this._scale=1,this._panOffset=new w,this._rotateStart=new M,this._rotateEnd=new M,this._rotateDelta=new M,this._panStart=new M,this._panEnd=new M,this._panDelta=new M,this._dollyStart=new M,this._dollyEnd=new M,this._dollyDelta=new M,this._dollyDirection=new w,this._mouse=new M,this._performCursorZoom=!1,this._pointers=[],this._pointerPositions={},this._controlActive=!1,this._onPointerMove=_n.bind(this),this._onPointerDown=gn.bind(this),this._onPointerUp=yn.bind(this),this._onContextMenu=Ln.bind(this),this._onMouseWheel=wn.bind(this),this._onKeyDown=bn.bind(this),this._onTouchStart=En.bind(this),this._onTouchMove=Rn.bind(this),this._onMouseDown=Tn.bind(this),this._onMouseMove=xn.bind(this),this._interceptControlDown=An.bind(this),this._interceptControlUp=Dn.bind(this),this.domElement!==null&&this.connect(),this.update()}connect(){this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointercancel",this._onPointerUp),this.domElement.addEventListener("contextmenu",this._onContextMenu),this.domElement.addEventListener("wheel",this._onMouseWheel,{passive:!1}),this.domElement.getRootNode().addEventListener("keydown",this._interceptControlDown,{passive:!0,capture:!0}),this.domElement.style.touchAction="none"}disconnect(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.domElement.removeEventListener("pointercancel",this._onPointerUp),this.domElement.removeEventListener("wheel",this._onMouseWheel),this.domElement.removeEventListener("contextmenu",this._onContextMenu),this.stopListenToKeyEvents(),this.domElement.getRootNode().removeEventListener("keydown",this._interceptControlDown,{capture:!0}),this.domElement.style.touchAction="auto"}dispose(){this.disconnect()}getPolarAngle(){return this._spherical.phi}getAzimuthalAngle(){return this._spherical.theta}getDistance(){return this.object.position.distanceTo(this.target)}listenToKeyEvents(e){e.addEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=e}stopListenToKeyEvents(){this._domElementKeyEvents!==null&&(this._domElementKeyEvents.removeEventListener("keydown",this._onKeyDown),this._domElementKeyEvents=null)}saveState(){this.target0.copy(this.target),this.position0.copy(this.object.position),this.zoom0=this.object.zoom}reset(){this.target.copy(this.target0),this.object.position.copy(this.position0),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(jt),this.update(),this.state=b.NONE}update(e=null){const t=this.object.position;R.copy(t).sub(this.target),R.applyQuaternion(this._quat),this._spherical.setFromVector3(R),this.autoRotate&&this.state===b.NONE&&this._rotateLeft(this._getAutoRotationAngle(e)),this.enableDamping?(this._spherical.theta+=this._sphericalDelta.theta*this.dampingFactor,this._spherical.phi+=this._sphericalDelta.phi*this.dampingFactor):(this._spherical.theta+=this._sphericalDelta.theta,this._spherical.phi+=this._sphericalDelta.phi);let s=this.minAzimuthAngle,n=this.maxAzimuthAngle;isFinite(s)&&isFinite(n)&&(s<-Math.PI?s+=S:s>Math.PI&&(s-=S),n<-Math.PI?n+=S:n>Math.PI&&(n-=S),s<=n?this._spherical.theta=Math.max(s,Math.min(n,this._spherical.theta)):this._spherical.theta=this._spherical.theta>(s+n)/2?Math.max(s,this._spherical.theta):Math.min(n,this._spherical.theta)),this._spherical.phi=Math.max(this.minPolarAngle,Math.min(this.maxPolarAngle,this._spherical.phi)),this._spherical.makeSafe(),this.enableDamping===!0?this.target.addScaledVector(this._panOffset,this.dampingFactor):this.target.add(this._panOffset),this.target.clamp(fn,pn),this.target.sub(this.cursor),this.target.clampLength(this.minTargetRadius,this.maxTargetRadius),this.target.add(this.cursor);let o=!1;if(this.zoomToCursor&&this._performCursorZoom||this.object.isOrthographicCamera)this._spherical.radius=this._clampDistance(this._spherical.radius);else{const i=this._spherical.radius;this._spherical.radius=this._clampDistance(this._spherical.radius*this._scale),o=i!=this._spherical.radius}if(R.setFromSpherical(this._spherical),R.applyQuaternion(this._quatInverse),t.copy(this.target).add(R),this.object.lookAt(this.target),this.enableDamping===!0?(this._sphericalDelta.theta*=1-this.dampingFactor,this._sphericalDelta.phi*=1-this.dampingFactor,this._panOffset.multiplyScalar(1-this.dampingFactor)):(this._sphericalDelta.set(0,0,0),this._panOffset.set(0,0,0)),this.zoomToCursor&&this._performCursorZoom){let i=null;if(this.object.isPerspectiveCamera){const r=R.length();i=this._clampDistance(r*this._scale);const c=r-i;this.object.position.addScaledVector(this._dollyDirection,c),this.object.updateMatrixWorld(),o=!!c}else if(this.object.isOrthographicCamera){const r=new w(this._mouse.x,this._mouse.y,0);r.unproject(this.object);const c=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),this.object.updateProjectionMatrix(),o=c!==this.object.zoom;const l=new w(this._mouse.x,this._mouse.y,0);l.unproject(this.object),this.object.position.sub(l).add(r),this.object.updateMatrixWorld(),i=R.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),this.zoomToCursor=!1;i!==null&&(this.screenSpacePanning?this.target.set(0,0,-1).transformDirection(this.object.matrix).multiplyScalar(i).add(this.object.position):(De.origin.copy(this.object.position),De.direction.set(0,0,-1).transformDirection(this.object.matrix),Math.abs(this.object.up.dot(De.direction))<dn?this.object.lookAt(this.target):(Ht.setFromNormalAndCoplanarPoint(this.object.up,this.target),De.intersectPlane(Ht,this.target))))}else if(this.object.isOrthographicCamera){const i=this.object.zoom;this.object.zoom=Math.max(this.minZoom,Math.min(this.maxZoom,this.object.zoom/this._scale)),i!==this.object.zoom&&(this.object.updateProjectionMatrix(),o=!0)}return this._scale=1,this._performCursorZoom=!1,o||this._lastPosition.distanceToSquared(this.object.position)>rt||8*(1-this._lastQuaternion.dot(this.object.quaternion))>rt||this._lastTargetPosition.distanceToSquared(this.target)>rt?(this.dispatchEvent(jt),this._lastPosition.copy(this.object.position),this._lastQuaternion.copy(this.object.quaternion),this._lastTargetPosition.copy(this.target),!0):!1}_getAutoRotationAngle(e){return e!==null?S/60*this.autoRotateSpeed*e:S/60/60*this.autoRotateSpeed}_getZoomScale(e){const t=Math.abs(e*.01);return Math.pow(.95,this.zoomSpeed*t)}_rotateLeft(e){this._sphericalDelta.theta-=e}_rotateUp(e){this._sphericalDelta.phi-=e}_panLeft(e,t){R.setFromMatrixColumn(t,0),R.multiplyScalar(-e),this._panOffset.add(R)}_panUp(e,t){this.screenSpacePanning===!0?R.setFromMatrixColumn(t,1):(R.setFromMatrixColumn(t,0),R.crossVectors(this.object.up,R)),R.multiplyScalar(e),this._panOffset.add(R)}_pan(e,t){const s=this.domElement;if(this.object.isPerspectiveCamera){const n=this.object.position;R.copy(n).sub(this.target);let o=R.length();o*=Math.tan(this.object.fov/2*Math.PI/180),this._panLeft(2*e*o/s.clientHeight,this.object.matrix),this._panUp(2*t*o/s.clientHeight,this.object.matrix)}else this.object.isOrthographicCamera?(this._panLeft(e*(this.object.right-this.object.left)/this.object.zoom/s.clientWidth,this.object.matrix),this._panUp(t*(this.object.top-this.object.bottom)/this.object.zoom/s.clientHeight,this.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),this.enablePan=!1)}_dollyOut(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale/=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_dollyIn(e){this.object.isPerspectiveCamera||this.object.isOrthographicCamera?this._scale*=e:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),this.enableZoom=!1)}_updateZoomParameters(e,t){if(!this.zoomToCursor)return;this._performCursorZoom=!0;const s=this.domElement.getBoundingClientRect(),n=e-s.left,o=t-s.top,i=s.width,r=s.height;this._mouse.x=n/i*2-1,this._mouse.y=-(o/r)*2+1,this._dollyDirection.set(this._mouse.x,this._mouse.y,1).unproject(this.object).sub(this.object.position).normalize()}_clampDistance(e){return Math.max(this.minDistance,Math.min(this.maxDistance,e))}_handleMouseDownRotate(e){this._rotateStart.set(e.clientX,e.clientY)}_handleMouseDownDolly(e){this._updateZoomParameters(e.clientX,e.clientX),this._dollyStart.set(e.clientX,e.clientY)}_handleMouseDownPan(e){this._panStart.set(e.clientX,e.clientY)}_handleMouseMoveRotate(e){this._rotateEnd.set(e.clientX,e.clientY),this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(S*this._rotateDelta.x/t.clientHeight),this._rotateUp(S*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd),this.update()}_handleMouseMoveDolly(e){this._dollyEnd.set(e.clientX,e.clientY),this._dollyDelta.subVectors(this._dollyEnd,this._dollyStart),this._dollyDelta.y>0?this._dollyOut(this._getZoomScale(this._dollyDelta.y)):this._dollyDelta.y<0&&this._dollyIn(this._getZoomScale(this._dollyDelta.y)),this._dollyStart.copy(this._dollyEnd),this.update()}_handleMouseMovePan(e){this._panEnd.set(e.clientX,e.clientY),this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd),this.update()}_handleMouseWheel(e){this._updateZoomParameters(e.clientX,e.clientY),e.deltaY<0?this._dollyIn(this._getZoomScale(e.deltaY)):e.deltaY>0&&this._dollyOut(this._getZoomScale(e.deltaY)),this.update()}_handleKeyDown(e){let t=!1;switch(e.code){case this.keys.UP:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(S*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,this.keyPanSpeed),t=!0;break;case this.keys.BOTTOM:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateUp(-S*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(0,-this.keyPanSpeed),t=!0;break;case this.keys.LEFT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(S*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(this.keyPanSpeed,0),t=!0;break;case this.keys.RIGHT:e.ctrlKey||e.metaKey||e.shiftKey?this.enableRotate&&this._rotateLeft(-S*this.keyRotateSpeed/this.domElement.clientHeight):this.enablePan&&this._pan(-this.keyPanSpeed,0),t=!0;break}t&&(e.preventDefault(),this.update())}_handleTouchStartRotate(e){if(this._pointers.length===1)this._rotateStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._rotateStart.set(s,n)}}_handleTouchStartPan(e){if(this._pointers.length===1)this._panStart.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panStart.set(s,n)}}_handleTouchStartDolly(e){const t=this._getSecondPointerPosition(e),s=e.pageX-t.x,n=e.pageY-t.y,o=Math.sqrt(s*s+n*n);this._dollyStart.set(0,o)}_handleTouchStartDollyPan(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enablePan&&this._handleTouchStartPan(e)}_handleTouchStartDollyRotate(e){this.enableZoom&&this._handleTouchStartDolly(e),this.enableRotate&&this._handleTouchStartRotate(e)}_handleTouchMoveRotate(e){if(this._pointers.length==1)this._rotateEnd.set(e.pageX,e.pageY);else{const s=this._getSecondPointerPosition(e),n=.5*(e.pageX+s.x),o=.5*(e.pageY+s.y);this._rotateEnd.set(n,o)}this._rotateDelta.subVectors(this._rotateEnd,this._rotateStart).multiplyScalar(this.rotateSpeed);const t=this.domElement;this._rotateLeft(S*this._rotateDelta.x/t.clientHeight),this._rotateUp(S*this._rotateDelta.y/t.clientHeight),this._rotateStart.copy(this._rotateEnd)}_handleTouchMovePan(e){if(this._pointers.length===1)this._panEnd.set(e.pageX,e.pageY);else{const t=this._getSecondPointerPosition(e),s=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);this._panEnd.set(s,n)}this._panDelta.subVectors(this._panEnd,this._panStart).multiplyScalar(this.panSpeed),this._pan(this._panDelta.x,this._panDelta.y),this._panStart.copy(this._panEnd)}_handleTouchMoveDolly(e){const t=this._getSecondPointerPosition(e),s=e.pageX-t.x,n=e.pageY-t.y,o=Math.sqrt(s*s+n*n);this._dollyEnd.set(0,o),this._dollyDelta.set(0,Math.pow(this._dollyEnd.y/this._dollyStart.y,this.zoomSpeed)),this._dollyOut(this._dollyDelta.y),this._dollyStart.copy(this._dollyEnd);const i=(e.pageX+t.x)*.5,r=(e.pageY+t.y)*.5;this._updateZoomParameters(i,r)}_handleTouchMoveDollyPan(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enablePan&&this._handleTouchMovePan(e)}_handleTouchMoveDollyRotate(e){this.enableZoom&&this._handleTouchMoveDolly(e),this.enableRotate&&this._handleTouchMoveRotate(e)}_addPointer(e){this._pointers.push(e.pointerId)}_removePointer(e){delete this._pointerPositions[e.pointerId];for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId){this._pointers.splice(t,1);return}}_isTrackingPointer(e){for(let t=0;t<this._pointers.length;t++)if(this._pointers[t]==e.pointerId)return!0;return!1}_trackPointer(e){let t=this._pointerPositions[e.pointerId];t===void 0&&(t=new M,this._pointerPositions[e.pointerId]=t),t.set(e.pageX,e.pageY)}_getSecondPointerPosition(e){const t=e.pointerId===this._pointers[0]?this._pointers[1]:this._pointers[0];return this._pointerPositions[t]}_customWheelEvent(e){const t=e.deltaMode,s={clientX:e.clientX,clientY:e.clientY,deltaY:e.deltaY};switch(t){case 1:s.deltaY*=16;break;case 2:s.deltaY*=100;break}return e.ctrlKey&&!this._controlActive&&(s.deltaY*=10),s}}function gn(a){this.enabled!==!1&&(this._pointers.length===0&&(this.domElement.setPointerCapture(a.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.domElement.addEventListener("pointerup",this._onPointerUp)),!this._isTrackingPointer(a)&&(this._addPointer(a),a.pointerType==="touch"?this._onTouchStart(a):this._onMouseDown(a)))}function _n(a){this.enabled!==!1&&(a.pointerType==="touch"?this._onTouchMove(a):this._onMouseMove(a))}function yn(a){switch(this._removePointer(a),this._pointers.length){case 0:this.domElement.releasePointerCapture(a.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.dispatchEvent(as),this.state=b.NONE;break;case 1:const e=this._pointers[0],t=this._pointerPositions[e];this._onTouchStart({pointerId:e,pageX:t.x,pageY:t.y});break}}function Tn(a){let e;switch(a.button){case 0:e=this.mouseButtons.LEFT;break;case 1:e=this.mouseButtons.MIDDLE;break;case 2:e=this.mouseButtons.RIGHT;break;default:e=-1}switch(e){case ue.DOLLY:if(this.enableZoom===!1)return;this._handleMouseDownDolly(a),this.state=b.DOLLY;break;case ue.ROTATE:if(a.ctrlKey||a.metaKey||a.shiftKey){if(this.enablePan===!1)return;this._handleMouseDownPan(a),this.state=b.PAN}else{if(this.enableRotate===!1)return;this._handleMouseDownRotate(a),this.state=b.ROTATE}break;case ue.PAN:if(a.ctrlKey||a.metaKey||a.shiftKey){if(this.enableRotate===!1)return;this._handleMouseDownRotate(a),this.state=b.ROTATE}else{if(this.enablePan===!1)return;this._handleMouseDownPan(a),this.state=b.PAN}break;default:this.state=b.NONE}this.state!==b.NONE&&this.dispatchEvent(wt)}function xn(a){switch(this.state){case b.ROTATE:if(this.enableRotate===!1)return;this._handleMouseMoveRotate(a);break;case b.DOLLY:if(this.enableZoom===!1)return;this._handleMouseMoveDolly(a);break;case b.PAN:if(this.enablePan===!1)return;this._handleMouseMovePan(a);break}}function wn(a){this.enabled===!1||this.enableZoom===!1||this.state!==b.NONE||(a.preventDefault(),this.dispatchEvent(wt),this._handleMouseWheel(this._customWheelEvent(a)),this.dispatchEvent(as))}function bn(a){this.enabled!==!1&&this._handleKeyDown(a)}function En(a){switch(this._trackPointer(a),this._pointers.length){case 1:switch(this.touches.ONE){case le.ROTATE:if(this.enableRotate===!1)return;this._handleTouchStartRotate(a),this.state=b.TOUCH_ROTATE;break;case le.PAN:if(this.enablePan===!1)return;this._handleTouchStartPan(a),this.state=b.TOUCH_PAN;break;default:this.state=b.NONE}break;case 2:switch(this.touches.TWO){case le.DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchStartDollyPan(a),this.state=b.TOUCH_DOLLY_PAN;break;case le.DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchStartDollyRotate(a),this.state=b.TOUCH_DOLLY_ROTATE;break;default:this.state=b.NONE}break;default:this.state=b.NONE}this.state!==b.NONE&&this.dispatchEvent(wt)}function Rn(a){switch(this._trackPointer(a),this.state){case b.TOUCH_ROTATE:if(this.enableRotate===!1)return;this._handleTouchMoveRotate(a),this.update();break;case b.TOUCH_PAN:if(this.enablePan===!1)return;this._handleTouchMovePan(a),this.update();break;case b.TOUCH_DOLLY_PAN:if(this.enableZoom===!1&&this.enablePan===!1)return;this._handleTouchMoveDollyPan(a),this.update();break;case b.TOUCH_DOLLY_ROTATE:if(this.enableZoom===!1&&this.enableRotate===!1)return;this._handleTouchMoveDollyRotate(a),this.update();break;default:this.state=b.NONE}}function Ln(a){this.enabled!==!1&&a.preventDefault()}function An(a){a.key==="Control"&&(this._controlActive=!0,this.domElement.getRootNode().addEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}function Dn(a){a.key==="Control"&&(this._controlActive=!1,this.domElement.getRootNode().removeEventListener("keyup",this._interceptControlUp,{passive:!0,capture:!0}))}const at=new WeakMap;class vn extends Jt{constructor(e){super(e),this.decoderPath="",this.decoderConfig={},this.decoderBinary=null,this.decoderPending=null,this.workerLimit=4,this.workerPool=[],this.workerNextTaskID=1,this.workerSourceURL="",this.defaultAttributeIDs={position:"POSITION",normal:"NORMAL",color:"COLOR",uv:"TEX_COORD"},this.defaultAttributeTypes={position:"Float32Array",normal:"Float32Array",color:"Float32Array",uv:"Float32Array"}}setDecoderPath(e){return this.decoderPath=e,this}setDecoderConfig(e){return this.decoderConfig=e,this}setWorkerLimit(e){return this.workerLimit=e,this}load(e,t,s,n){const o=new Fe(this.manager);o.setPath(this.path),o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,i=>{this.parse(i,t,n)},s,n)}parse(e,t,s=()=>{}){this.decodeDracoFile(e,t,null,null,z,s).catch(s)}decodeDracoFile(e,t,s,n,o=V,i=()=>{}){const r={attributeIDs:s||this.defaultAttributeIDs,attributeTypes:n||this.defaultAttributeTypes,useUniqueIDs:!!s,vertexColorSpace:o};return this.decodeGeometry(e,r).then(t).catch(i)}decodeGeometry(e,t){const s=JSON.stringify(t);if(at.has(e)){const c=at.get(e);if(c.key===s)return c.promise;if(e.byteLength===0)throw new Error("THREE.DRACOLoader: Unable to re-decode a buffer with different settings. Buffer has already been transferred.")}let n;const o=this.workerNextTaskID++,i=e.byteLength,r=this._getWorker(o,i).then(c=>(n=c,new Promise((l,u)=>{n._callbacks[o]={resolve:l,reject:u},n.postMessage({type:"decode",id:o,taskConfig:t,buffer:e},[e])}))).then(c=>this._createGeometry(c.geometry));return r.catch(()=>!0).then(()=>{n&&o&&this._releaseTask(n,o)}),at.set(e,{key:s,promise:r}),r}_createGeometry(e){const t=new Qt;e.index&&t.setIndex(new Te(e.index.array,1));for(let s=0;s<e.attributes.length;s++){const n=e.attributes[s],o=n.name,i=n.array,r=n.itemSize,c=new Te(i,r);o==="color"&&(this._assignVertexColorSpace(c,n.vertexColorSpace),c.normalized=!(i instanceof Float32Array)),t.setAttribute(o,c)}return t}_assignVertexColorSpace(e,t){if(t!==z)return;const s=new U;for(let n=0,o=e.count;n<o;n++)s.fromBufferAttribute(e,n),mt.toWorkingColorSpace(s,z),e.setXYZ(n,s.r,s.g,s.b)}_loadLibrary(e,t){const s=new Fe(this.manager);return s.setPath(this.decoderPath),s.setResponseType(t),s.setWithCredentials(this.withCredentials),new Promise((n,o)=>{s.load(e,n,void 0,o)})}preload(){return this._initDecoder(),this}_initDecoder(){if(this.decoderPending)return this.decoderPending;const e=typeof WebAssembly!="object"||this.decoderConfig.type==="js",t=[];return e?t.push(this._loadLibrary("draco_decoder.js","text")):(t.push(this._loadLibrary("draco_wasm_wrapper.js","text")),t.push(this._loadLibrary("draco_decoder.wasm","arraybuffer"))),this.decoderPending=Promise.all(t).then(s=>{const n=s[0];e||(this.decoderConfig.wasmBinary=s[1]);const o=Sn.toString(),i=["/* draco decoder */",n,"","/* worker */",o.substring(o.indexOf("{")+1,o.lastIndexOf("}"))].join(`
`);this.workerSourceURL=URL.createObjectURL(new Blob([i]))}),this.decoderPending}_getWorker(e,t){return this._initDecoder().then(()=>{if(this.workerPool.length<this.workerLimit){const n=new Worker(this.workerSourceURL);n._callbacks={},n._taskCosts={},n._taskLoad=0,n.postMessage({type:"init",decoderConfig:this.decoderConfig}),n.onmessage=function(o){const i=o.data;switch(i.type){case"decode":n._callbacks[i.id].resolve(i);break;case"error":n._callbacks[i.id].reject(i);break;default:console.error('THREE.DRACOLoader: Unexpected message, "'+i.type+'"')}},this.workerPool.push(n)}else this.workerPool.sort(function(n,o){return n._taskLoad>o._taskLoad?-1:1});const s=this.workerPool[this.workerPool.length-1];return s._taskCosts[e]=t,s._taskLoad+=t,s})}_releaseTask(e,t){e._taskLoad-=e._taskCosts[t],delete e._callbacks[t],delete e._taskCosts[t]}debug(){console.log("Task load: ",this.workerPool.map(e=>e._taskLoad))}dispose(){for(let e=0;e<this.workerPool.length;++e)this.workerPool[e].terminate();return this.workerPool.length=0,this.workerSourceURL!==""&&URL.revokeObjectURL(this.workerSourceURL),this}}function Sn(){let a,e;onmessage=function(i){const r=i.data;switch(r.type){case"init":a=r.decoderConfig,e=new Promise(function(u){a.onModuleLoaded=function(h){u({draco:h})},DracoDecoderModule(a)});break;case"decode":const c=r.buffer,l=r.taskConfig;e.then(u=>{const h=u.draco,d=new h.Decoder;try{const f=t(h,d,new Int8Array(c),l),m=f.attributes.map(g=>g.array.buffer);f.index&&m.push(f.index.array.buffer),self.postMessage({type:"decode",id:r.id,geometry:f},m)}catch(f){console.error(f),self.postMessage({type:"error",id:r.id,error:f.message})}finally{h.destroy(d)}});break}};function t(i,r,c,l){const u=l.attributeIDs,h=l.attributeTypes;let d,f;const m=r.GetEncodedGeometryType(c);if(m===i.TRIANGULAR_MESH)d=new i.Mesh,f=r.DecodeArrayToMesh(c,c.byteLength,d);else if(m===i.POINT_CLOUD)d=new i.PointCloud,f=r.DecodeArrayToPointCloud(c,c.byteLength,d);else throw new Error("THREE.DRACOLoader: Unexpected geometry type.");if(!f.ok()||d.ptr===0)throw new Error("THREE.DRACOLoader: Decoding failed: "+f.error_msg());const g={index:null,attributes:[]};for(const p in u){const _=self[h[p]];let T,E;if(l.useUniqueIDs)E=u[p],T=r.GetAttributeByUniqueId(d,E);else{if(E=r.GetAttributeId(d,i[u[p]]),E===-1)continue;T=r.GetAttribute(d,E)}const x=n(i,r,d,p,_,T);p==="color"&&(x.vertexColorSpace=l.vertexColorSpace),g.attributes.push(x)}return m===i.TRIANGULAR_MESH&&(g.index=s(i,r,d)),i.destroy(d),g}function s(i,r,c){const u=c.num_faces()*3,h=u*4,d=i._malloc(h);r.GetTrianglesUInt32Array(c,h,d);const f=new Uint32Array(i.HEAPF32.buffer,d,u).slice();return i._free(d),{array:f,itemSize:1}}function n(i,r,c,l,u,h){const d=h.num_components(),m=c.num_points()*d,g=m*u.BYTES_PER_ELEMENT,p=o(i,u),_=i._malloc(g);r.GetAttributeDataArrayForAllPoints(c,h,p,g,_);const T=new u(i.HEAPF32.buffer,_,m).slice();return i._free(_),{name:l,array:T,itemSize:d}}function o(i,r){switch(r){case Float32Array:return i.DT_FLOAT32;case Int8Array:return i.DT_INT8;case Int16Array:return i.DT_INT16;case Int32Array:return i.DT_INT32;case Uint8Array:return i.DT_UINT8;case Uint16Array:return i.DT_UINT16;case Uint32Array:return i.DT_UINT32}}}function Bt(a,e){if(e===vs)return console.warn("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles."),a;if(e===gt||e===$t){let t=a.getIndex();if(t===null){const i=[],r=a.getAttribute("position");if(r!==void 0){for(let c=0;c<r.count;c++)i.push(c);a.setIndex(i),t=a.getIndex()}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}const s=t.count-2,n=[];if(e===gt)for(let i=1;i<=s;i++)n.push(t.getX(0)),n.push(t.getX(i)),n.push(t.getX(i+1));else for(let i=0;i<s;i++)i%2===0?(n.push(t.getX(i)),n.push(t.getX(i+1)),n.push(t.getX(i+2))):(n.push(t.getX(i+2)),n.push(t.getX(i+1)),n.push(t.getX(i)));n.length/3!==s&&console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const o=a.clone();return o.setIndex(n),o.clearGroups(),o}else return console.error("THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:",e),a}class Mn extends Jt{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new kn(t)}),this.register(function(t){return new Nn(t)}),this.register(function(t){return new Vn(t)}),this.register(function(t){return new Xn(t)}),this.register(function(t){return new Yn(t)}),this.register(function(t){return new Un(t)}),this.register(function(t){return new jn(t)}),this.register(function(t){return new Hn(t)}),this.register(function(t){return new Bn(t)}),this.register(function(t){return new On(t)}),this.register(function(t){return new Gn(t)}),this.register(function(t){return new Fn(t)}),this.register(function(t){return new Kn(t)}),this.register(function(t){return new zn(t)}),this.register(function(t){return new In(t)}),this.register(function(t){return new Wn(t)}),this.register(function(t){return new qn(t)})}load(e,t,s,n){const o=this;let i;if(this.resourcePath!=="")i=this.resourcePath;else if(this.path!==""){const l=xe.extractUrlBase(e);i=xe.resolveURL(l,this.path)}else i=xe.extractUrlBase(e);this.manager.itemStart(e);const r=function(l){n?n(l):console.error(l),o.manager.itemError(e),o.manager.itemEnd(e)},c=new Fe(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{o.parse(l,i,function(u){t(u),o.manager.itemEnd(e)},r)}catch(u){r(u)}},s,r)}setDRACOLoader(e){return this.dracoLoader=e,this}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){let o;const i={},r={},c=new TextDecoder;if(typeof e=="string")o=JSON.parse(e);else if(e instanceof ArrayBuffer)if(c.decode(new Uint8Array(e,0,4))===cs){try{i[y.KHR_BINARY_GLTF]=new Zn(e)}catch(h){n&&n(h);return}o=JSON.parse(i[y.KHR_BINARY_GLTF].content)}else o=JSON.parse(c.decode(e));else o=e;if(o.asset===void 0||o.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new li(o,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let u=0;u<this.pluginCallbacks.length;u++){const h=this.pluginCallbacks[u](l);h.name||console.error("THREE.GLTFLoader: Invalid plugin found: missing name"),r[h.name]=h,i[h.name]=!0}if(o.extensionsUsed)for(let u=0;u<o.extensionsUsed.length;++u){const h=o.extensionsUsed[u],d=o.extensionsRequired||[];switch(h){case y.KHR_MATERIALS_UNLIT:i[h]=new Cn;break;case y.KHR_DRACO_MESH_COMPRESSION:i[h]=new Jn(o,this.dracoLoader);break;case y.KHR_TEXTURE_TRANSFORM:i[h]=new Qn;break;case y.KHR_MESH_QUANTIZATION:i[h]=new $n;break;default:d.indexOf(h)>=0&&r[h]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+h+'".')}}l.setExtensions(i),l.setPlugins(r),l.parse(s,n)}parseAsync(e,t){const s=this;return new Promise(function(n,o){s.parse(e,t,n,o)})}}function Pn(){let a={};return{get:function(e){return a[e]},add:function(e,t){a[e]=t},remove:function(e){delete a[e]},removeAll:function(){a={}}}}const y={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_DISPERSION:"KHR_materials_dispersion",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_ANISOTROPY:"KHR_materials_anisotropy",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_MATERIALS_BUMP:"EXT_materials_bump",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_TEXTURE_AVIF:"EXT_texture_avif",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression",EXT_MESH_GPU_INSTANCING:"EXT_mesh_gpu_instancing"};class In{constructor(e){this.parser=e,this.name=y.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,n=t.length;s<n;s++){const o=t[s];o.extensions&&o.extensions[this.name]&&o.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,o.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let n=t.cache.get(s);if(n)return n;const o=t.json,c=((o.extensions&&o.extensions[this.name]||{}).lights||[])[e];let l;const u=new U(16777215);c.color!==void 0&&u.setRGB(c.color[0],c.color[1],c.color[2],V);const h=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new Ps(u),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new Ms(u),l.distance=h;break;case"spot":l=new Ss(u),l.distance=h,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),W(l,c),c.intensity!==void 0&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),n=Promise.resolve(l),t.cache.add(s,n),n}getDependency(e,t){if(e==="light")return this._loadLight(t)}createNodeAttachment(e){const t=this,s=this.parser,o=s.json.nodes[e],r=(o.extensions&&o.extensions[this.name]||{}).light;return r===void 0?null:this._loadLight(r).then(function(c){return s._getNodeRef(t.cache,r,c)})}}class Cn{constructor(){this.name=y.KHR_MATERIALS_UNLIT}getMaterialType(){return se}extendParams(e,t,s){const n=[];e.color=new U(1,1,1),e.opacity=1;const o=t.pbrMetallicRoughness;if(o){if(Array.isArray(o.baseColorFactor)){const i=o.baseColorFactor;e.color.setRGB(i[0],i[1],i[2],V),e.opacity=i[3]}o.baseColorTexture!==void 0&&n.push(s.assignTexture(e,"map",o.baseColorTexture,z))}return Promise.all(n)}}class On{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=n.extensions[this.name].emissiveStrength;return o!==void 0&&(t.emissiveIntensity=o),Promise.resolve()}}class kn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];if(i.clearcoatFactor!==void 0&&(t.clearcoat=i.clearcoatFactor),i.clearcoatTexture!==void 0&&o.push(s.assignTexture(t,"clearcoatMap",i.clearcoatTexture)),i.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=i.clearcoatRoughnessFactor),i.clearcoatRoughnessTexture!==void 0&&o.push(s.assignTexture(t,"clearcoatRoughnessMap",i.clearcoatRoughnessTexture)),i.clearcoatNormalTexture!==void 0&&(o.push(s.assignTexture(t,"clearcoatNormalMap",i.clearcoatNormalTexture)),i.clearcoatNormalTexture.scale!==void 0)){const r=i.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new M(r,r)}return Promise.all(o)}}class Nn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_DISPERSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=n.extensions[this.name];return t.dispersion=o.dispersion!==void 0?o.dispersion:0,Promise.resolve()}}class Fn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];return i.iridescenceFactor!==void 0&&(t.iridescence=i.iridescenceFactor),i.iridescenceTexture!==void 0&&o.push(s.assignTexture(t,"iridescenceMap",i.iridescenceTexture)),i.iridescenceIor!==void 0&&(t.iridescenceIOR=i.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),i.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=i.iridescenceThicknessMinimum),i.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=i.iridescenceThicknessMaximum),i.iridescenceThicknessTexture!==void 0&&o.push(s.assignTexture(t,"iridescenceThicknessMap",i.iridescenceThicknessTexture)),Promise.all(o)}}class Un{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[];t.sheenColor=new U(0,0,0),t.sheenRoughness=0,t.sheen=1;const i=n.extensions[this.name];if(i.sheenColorFactor!==void 0){const r=i.sheenColorFactor;t.sheenColor.setRGB(r[0],r[1],r[2],V)}return i.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=i.sheenRoughnessFactor),i.sheenColorTexture!==void 0&&o.push(s.assignTexture(t,"sheenColorMap",i.sheenColorTexture,z)),i.sheenRoughnessTexture!==void 0&&o.push(s.assignTexture(t,"sheenRoughnessMap",i.sheenRoughnessTexture)),Promise.all(o)}}class jn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];return i.transmissionFactor!==void 0&&(t.transmission=i.transmissionFactor),i.transmissionTexture!==void 0&&o.push(s.assignTexture(t,"transmissionMap",i.transmissionTexture)),Promise.all(o)}}class Hn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];t.thickness=i.thicknessFactor!==void 0?i.thicknessFactor:0,i.thicknessTexture!==void 0&&o.push(s.assignTexture(t,"thicknessMap",i.thicknessTexture)),t.attenuationDistance=i.attenuationDistance||1/0;const r=i.attenuationColor||[1,1,1];return t.attenuationColor=new U().setRGB(r[0],r[1],r[2],V),Promise.all(o)}}class Bn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=n.extensions[this.name];return t.ior=o.ior!==void 0?o.ior:1.5,Promise.resolve()}}class Gn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];t.specularIntensity=i.specularFactor!==void 0?i.specularFactor:1,i.specularTexture!==void 0&&o.push(s.assignTexture(t,"specularIntensityMap",i.specularTexture));const r=i.specularColorFactor||[1,1,1];return t.specularColor=new U().setRGB(r[0],r[1],r[2],V),i.specularColorTexture!==void 0&&o.push(s.assignTexture(t,"specularColorMap",i.specularColorTexture,z)),Promise.all(o)}}class zn{constructor(e){this.parser=e,this.name=y.EXT_MATERIALS_BUMP}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];return t.bumpScale=i.bumpFactor!==void 0?i.bumpFactor:1,i.bumpTexture!==void 0&&o.push(s.assignTexture(t,"bumpMap",i.bumpTexture)),Promise.all(o)}}class Kn{constructor(e){this.parser=e,this.name=y.KHR_MATERIALS_ANISOTROPY}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:X}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const o=[],i=n.extensions[this.name];return i.anisotropyStrength!==void 0&&(t.anisotropy=i.anisotropyStrength),i.anisotropyRotation!==void 0&&(t.anisotropyRotation=i.anisotropyRotation),i.anisotropyTexture!==void 0&&o.push(s.assignTexture(t,"anisotropyMap",i.anisotropyTexture)),Promise.all(o)}}class Vn{constructor(e){this.parser=e,this.name=y.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,n=s.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const o=n.extensions[this.name],i=t.options.ktx2Loader;if(!i){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,o.source,i)}}class Xn{constructor(e){this.parser=e,this.name=y.EXT_TEXTURE_WEBP}loadTexture(e){const t=this.name,s=this.parser,n=s.json,o=n.textures[e];if(!o.extensions||!o.extensions[t])return null;const i=o.extensions[t],r=n.images[i.source];let c=s.textureLoader;if(r.uri){const l=s.options.manager.getHandler(r.uri);l!==null&&(c=l)}return s.loadTextureImage(e,i.source,c)}}class Yn{constructor(e){this.parser=e,this.name=y.EXT_TEXTURE_AVIF}loadTexture(e){const t=this.name,s=this.parser,n=s.json,o=n.textures[e];if(!o.extensions||!o.extensions[t])return null;const i=o.extensions[t],r=n.images[i.source];let c=s.textureLoader;if(r.uri){const l=s.options.manager.getHandler(r.uri);l!==null&&(c=l)}return s.loadTextureImage(e,i.source,c)}}class Wn{constructor(e){this.name=y.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const n=s.extensions[this.name],o=this.parser.getDependency("buffer",n.buffer),i=this.parser.options.meshoptDecoder;if(!i||!i.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return o.then(function(r){const c=n.byteOffset||0,l=n.byteLength||0,u=n.count,h=n.byteStride,d=new Uint8Array(r,c,l);return i.decodeGltfBufferAsync?i.decodeGltfBufferAsync(u,h,d,n.mode,n.filter).then(function(f){return f.buffer}):i.ready.then(function(){const f=new ArrayBuffer(u*h);return i.decodeGltfBuffer(new Uint8Array(f),u,h,d,n.mode,n.filter),f})})}else return null}}class qn{constructor(e){this.name=y.EXT_MESH_GPU_INSTANCING,this.parser=e}createNodeMesh(e){const t=this.parser.json,s=t.nodes[e];if(!s.extensions||!s.extensions[this.name]||s.mesh===void 0)return null;const n=t.meshes[s.mesh];for(const l of n.primitives)if(l.mode!==N.TRIANGLES&&l.mode!==N.TRIANGLE_STRIP&&l.mode!==N.TRIANGLE_FAN&&l.mode!==void 0)return null;const i=s.extensions[this.name].attributes,r=[],c={};for(const l in i)r.push(this.parser.getDependency("accessor",i[l]).then(u=>(c[l]=u,c[l])));return r.length<1?null:(r.push(this.parser.createNodeMesh(e)),Promise.all(r).then(l=>{const u=l.pop(),h=u.isGroup?u.children:[u],d=l[0].count,f=[];for(const m of h){const g=new Ue,p=new w,_=new ke,T=new w(1,1,1),E=new Is(m.geometry,m.material,d);for(let x=0;x<d;x++)c.TRANSLATION&&p.fromBufferAttribute(c.TRANSLATION,x),c.ROTATION&&_.fromBufferAttribute(c.ROTATION,x),c.SCALE&&T.fromBufferAttribute(c.SCALE,x),E.setMatrixAt(x,g.compose(p,_,T));for(const x in c)if(x==="_COLOR_0"){const H=c[x];E.instanceColor=new Cs(H.array,H.itemSize,H.normalized)}else x!=="TRANSLATION"&&x!=="ROTATION"&&x!=="SCALE"&&m.geometry.setAttribute(x,c[x]);es.prototype.copy.call(E,m),this.parser.assignFinalMaterial(E),f.push(E)}return u.isGroup?(u.clear(),u.add(...f),u):f[0]}))}}const cs="glTF",ge=12,Gt={JSON:1313821514,BIN:5130562};class Zn{constructor(e){this.name=y.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,ge),s=new TextDecoder;if(this.header={magic:s.decode(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==cs)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const n=this.header.length-ge,o=new DataView(e,ge);let i=0;for(;i<n;){const r=o.getUint32(i,!0);i+=4;const c=o.getUint32(i,!0);if(i+=4,c===Gt.JSON){const l=new Uint8Array(e,ge+i,r);this.content=s.decode(l)}else if(c===Gt.BIN){const l=ge+i;this.body=e.slice(l,l+r)}i+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Jn{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=y.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,o=e.extensions[this.name].bufferView,i=e.extensions[this.name].attributes,r={},c={},l={};for(const u in i){const h=_t[u]||u.toLowerCase();r[h]=i[u]}for(const u in e.attributes){const h=_t[u]||u.toLowerCase();if(i[u]!==void 0){const d=s.accessors[e.attributes[u]],f=he[d.componentType];l[h]=f.name,c[h]=d.normalized===!0}}return t.getDependency("bufferView",o).then(function(u){return new Promise(function(h,d){n.decodeDracoFile(u,function(f){for(const m in f.attributes){const g=f.attributes[m],p=c[m];p!==void 0&&(g.normalized=p)}h(f)},r,l,V,d)})})}}class Qn{constructor(){this.name=y.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return(t.texCoord===void 0||t.texCoord===e.channel)&&t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.texCoord!==void 0&&(e.channel=t.texCoord),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class $n{constructor(){this.name=y.KHR_MESH_QUANTIZATION}}class ls extends sn{constructor(e,t,s,n){super(e,t,s,n)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,o=e*n*3+n;for(let i=0;i!==n;i++)t[i]=s[o+i];return t}interpolate_(e,t,s,n){const o=this.resultBuffer,i=this.sampleValues,r=this.valueSize,c=r*2,l=r*3,u=n-t,h=(s-t)/u,d=h*h,f=d*h,m=e*l,g=m-l,p=-2*f+3*d,_=f-d,T=1-p,E=_-d+h;for(let x=0;x!==r;x++){const H=i[g+x+r],Z=i[g+x+c]*u,j=i[m+x+r],me=i[m+x]*u;o[x]=T*H+E*Z+p*j+_*me}return o}}const ei=new ke;class ti extends ls{interpolate_(e,t,s,n){const o=super.interpolate_(e,t,s,n);return ei.fromArray(o).normalize().toArray(o),o}}const N={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6},he={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},zt={9728:ns,9729:$,9984:Us,9985:Fs,9986:Ns,9987:ss},Kt={33071:Hs,33648:js,10497:be},ct={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},_t={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv1",TEXCOORD_2:"uv2",TEXCOORD_3:"uv3",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Q={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},si={CUBICSPLINE:void 0,LINEAR:rs,STEP:$s},lt={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function ni(a){return a.DefaultMaterial===void 0&&(a.DefaultMaterial=new xt({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:tn})),a.DefaultMaterial}function te(a,e,t){for(const s in t.extensions)a[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}function W(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function ii(a,e,t){let s=!1,n=!1,o=!1;for(let l=0,u=e.length;l<u;l++){const h=e[l];if(h.POSITION!==void 0&&(s=!0),h.NORMAL!==void 0&&(n=!0),h.COLOR_0!==void 0&&(o=!0),s&&n&&o)break}if(!s&&!n&&!o)return Promise.resolve(a);const i=[],r=[],c=[];for(let l=0,u=e.length;l<u;l++){const h=e[l];if(s){const d=h.POSITION!==void 0?t.getDependency("accessor",h.POSITION):a.attributes.position;i.push(d)}if(n){const d=h.NORMAL!==void 0?t.getDependency("accessor",h.NORMAL):a.attributes.normal;r.push(d)}if(o){const d=h.COLOR_0!==void 0?t.getDependency("accessor",h.COLOR_0):a.attributes.color;c.push(d)}}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(c)]).then(function(l){const u=l[0],h=l[1],d=l[2];return s&&(a.morphAttributes.position=u),n&&(a.morphAttributes.normal=h),o&&(a.morphAttributes.color=d),a.morphTargetsRelative=!0,a})}function oi(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)a.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(a.morphTargetInfluences.length===t.length){a.morphTargetDictionary={};for(let s=0,n=t.length;s<n;s++)a.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function ri(a){let e;const t=a.extensions&&a.extensions[y.KHR_DRACO_MESH_COMPRESSION];if(t?e="draco:"+t.bufferView+":"+t.indices+":"+ut(t.attributes):e=a.indices+":"+ut(a.attributes)+":"+a.mode,a.targets!==void 0)for(let s=0,n=a.targets.length;s<n;s++)e+=":"+ut(a.targets[s]);return e}function ut(a){let e="";const t=Object.keys(a).sort();for(let s=0,n=t.length;s<n;s++)e+=t[s]+":"+a[t[s]]+";";return e}function yt(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function ai(a){return a.search(/\.jpe?g($|\?)/i)>0||a.search(/^data\:image\/jpeg/)===0?"image/jpeg":a.search(/\.webp($|\?)/i)>0||a.search(/^data\:image\/webp/)===0?"image/webp":a.search(/\.ktx2($|\?)/i)>0||a.search(/^data\:image\/ktx2/)===0?"image/ktx2":"image/png"}const ci=new Ue;class li{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Pn,this.associations=new Map,this.primitiveCache={},this.nodeCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};let s=!1,n=-1,o=!1,i=-1;if(typeof navigator<"u"){const r=navigator.userAgent;s=/^((?!chrome|android).)*safari/i.test(r)===!0;const c=r.match(/Version\/(\d+)/);n=s&&c?parseInt(c[1],10):-1,o=r.indexOf("Firefox")>-1,i=o?r.match(/Firefox\/([0-9]+)\./)[1]:-1}typeof createImageBitmap>"u"||s&&n<17||o&&i<98?this.textureLoader=new ts(this.options.manager):this.textureLoader=new Os(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Fe(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,n=this.json,o=this.extensions;this.cache.removeAll(),this.nodeCache={},this._invokeAll(function(i){return i._markDefs&&i._markDefs()}),Promise.all(this._invokeAll(function(i){return i.beforeRoot&&i.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(i){const r={scene:i[0][n.scene||0],scenes:i[0],animations:i[1],cameras:i[2],asset:n.asset,parser:s,userData:{}};return te(o,r,n),W(r,n),Promise.all(s._invokeAll(function(c){return c.afterRoot&&c.afterRoot(r)})).then(function(){for(const c of r.scenes)c.updateMatrixWorld();e(r)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let n=0,o=t.length;n<o;n++){const i=t[n].joints;for(let r=0,c=i.length;r<c;r++)e[i[r]].isBone=!0}for(let n=0,o=e.length;n<o;n++){const i=e[n];i.mesh!==void 0&&(this._addNodeRef(this.meshCache,i.mesh),i.skin!==void 0&&(s[i.mesh].isSkinnedMesh=!0)),i.camera!==void 0&&this._addNodeRef(this.cameraCache,i.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const n=s.clone(),o=(i,r)=>{const c=this.associations.get(i);c!=null&&this.associations.set(r,c);for(const[l,u]of i.children.entries())o(u,r.children[l])};return o(s,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const n=e(t[s]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let n=0;n<t.length;n++){const o=e(t[n]);o&&s.push(o)}return s}getDependency(e,t){const s=e+":"+t;let n=this.cache.get(s);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this._invokeOne(function(o){return o.loadNode&&o.loadNode(t)});break;case"mesh":n=this._invokeOne(function(o){return o.loadMesh&&o.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(o){return o.loadBufferView&&o.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(o){return o.loadMaterial&&o.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(o){return o.loadTexture&&o.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(o){return o.loadAnimation&&o.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:if(n=this._invokeOne(function(o){return o!=this&&o.getDependency&&o.getDependency(e,t)}),!n)throw new Error("Unknown type: "+e);break}this.cache.add(s,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(o,i){return s.getDependency(e,i)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[y.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(o,i){s.load(xe.resolveURL(t.uri,n.path),o,void 0,function(){i(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const n=t.byteLength||0,o=t.byteOffset||0;return s.slice(o,o+n)})}loadAccessor(e){const t=this,s=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0){const i=ct[n.type],r=he[n.componentType],c=n.normalized===!0,l=new r(n.count*i);return Promise.resolve(new Te(l,i,c))}const o=[];return n.bufferView!==void 0?o.push(this.getDependency("bufferView",n.bufferView)):o.push(null),n.sparse!==void 0&&(o.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),o.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(o).then(function(i){const r=i[0],c=ct[n.type],l=he[n.componentType],u=l.BYTES_PER_ELEMENT,h=u*c,d=n.byteOffset||0,f=n.bufferView!==void 0?s.bufferViews[n.bufferView].byteStride:void 0,m=n.normalized===!0;let g,p;if(f&&f!==h){const _=Math.floor(d/f),T="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+_+":"+n.count;let E=t.cache.get(T);E||(g=new l(r,_*f,n.count*f/u),E=new ks(g,f/u),t.cache.add(T,E)),p=new en(E,c,d%f/u,m)}else r===null?g=new l(n.count*c):g=new l(r,d,n.count*c),p=new Te(g,c,m);if(n.sparse!==void 0){const _=ct.SCALAR,T=he[n.sparse.indices.componentType],E=n.sparse.indices.byteOffset||0,x=n.sparse.values.byteOffset||0,H=new T(i[1],E,n.sparse.count*_),Z=new l(i[2],x,n.sparse.count*c);r!==null&&(p=new Te(p.array.slice(),p.itemSize,p.normalized)),p.normalized=!1;for(let j=0,me=H.length;j<me;j++){const J=H[j];if(p.setX(J,Z[j*c]),c>=2&&p.setY(J,Z[j*c+1]),c>=3&&p.setZ(J,Z[j*c+2]),c>=4&&p.setW(J,Z[j*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}p.normalized=m}return p})}loadTexture(e){const t=this.json,s=this.options,o=t.textures[e].source,i=t.images[o];let r=this.textureLoader;if(i.uri){const c=s.manager.getHandler(i.uri);c!==null&&(r=c)}return this.loadTextureImage(e,o,r)}loadTextureImage(e,t,s){const n=this,o=this.json,i=o.textures[e],r=o.images[t],c=(r.uri||r.bufferView)+":"+i.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,s).then(function(u){u.flipY=!1,u.name=i.name||r.name||"",u.name===""&&typeof r.uri=="string"&&r.uri.startsWith("data:image/")===!1&&(u.name=r.uri);const d=(o.samplers||{})[i.sampler]||{};return u.magFilter=zt[d.magFilter]||$,u.minFilter=zt[d.minFilter]||ss,u.wrapS=Kt[d.wrapS]||be,u.wrapT=Kt[d.wrapT]||be,u.generateMipmaps=!u.isCompressedTexture&&u.minFilter!==ns&&u.minFilter!==$,n.associations.set(u,{textures:e}),u}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const s=this,n=this.json,o=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(h=>h.clone());const i=n.images[e],r=self.URL||self.webkitURL;let c=i.uri||"",l=!1;if(i.bufferView!==void 0)c=s.getDependency("bufferView",i.bufferView).then(function(h){l=!0;const d=new Blob([h],{type:i.mimeType});return c=r.createObjectURL(d),c});else if(i.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const u=Promise.resolve(c).then(function(h){return new Promise(function(d,f){let m=d;t.isImageBitmapLoader===!0&&(m=function(g){const p=new kt(g);p.needsUpdate=!0,d(p)}),t.load(xe.resolveURL(h,o.path),m,void 0,f)})}).then(function(h){return l===!0&&r.revokeObjectURL(c),W(h,i),h.userData.mimeType=i.mimeType||ai(i.uri),h}).catch(function(h){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),h});return this.sourceCache[e]=u,u}assignTexture(e,t,s,n){const o=this;return this.getDependency("texture",s.index).then(function(i){if(!i)return null;if(s.texCoord!==void 0&&s.texCoord>0&&(i=i.clone(),i.channel=s.texCoord),o.extensions[y.KHR_TEXTURE_TRANSFORM]){const r=s.extensions!==void 0?s.extensions[y.KHR_TEXTURE_TRANSFORM]:void 0;if(r){const c=o.associations.get(i);i=o.extensions[y.KHR_TEXTURE_TRANSFORM].extendTexture(i,r),o.associations.set(i,c)}}return n!==void 0&&(i.colorSpace=n),e[t]=i,i})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const n=t.attributes.tangent===void 0,o=t.attributes.color!==void 0,i=t.attributes.normal===void 0;if(e.isPoints){const r="PointsMaterial:"+s.uuid;let c=this.cache.get(r);c||(c=new Bs,nt.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,c.sizeAttenuation=!1,this.cache.add(r,c)),s=c}else if(e.isLine){const r="LineBasicMaterial:"+s.uuid;let c=this.cache.get(r);c||(c=new Gs,nt.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,this.cache.add(r,c)),s=c}if(n||o||i){let r="ClonedMaterial:"+s.uuid+":";n&&(r+="derivative-tangents:"),o&&(r+="vertex-colors:"),i&&(r+="flat-shading:");let c=this.cache.get(r);c||(c=s.clone(),o&&(c.vertexColors=!0),i&&(c.flatShading=!0),n&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(r,c),this.associations.set(c,this.associations.get(s))),s=c}e.material=s}getMaterialType(){return xt}loadMaterial(e){const t=this,s=this.json,n=this.extensions,o=s.materials[e];let i;const r={},c=o.extensions||{},l=[];if(c[y.KHR_MATERIALS_UNLIT]){const h=n[y.KHR_MATERIALS_UNLIT];i=h.getMaterialType(),l.push(h.extendParams(r,o,t))}else{const h=o.pbrMetallicRoughness||{};if(r.color=new U(1,1,1),r.opacity=1,Array.isArray(h.baseColorFactor)){const d=h.baseColorFactor;r.color.setRGB(d[0],d[1],d[2],V),r.opacity=d[3]}h.baseColorTexture!==void 0&&l.push(t.assignTexture(r,"map",h.baseColorTexture,z)),r.metalness=h.metallicFactor!==void 0?h.metallicFactor:1,r.roughness=h.roughnessFactor!==void 0?h.roughnessFactor:1,h.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(r,"metalnessMap",h.metallicRoughnessTexture)),l.push(t.assignTexture(r,"roughnessMap",h.metallicRoughnessTexture))),i=this._invokeOne(function(d){return d.getMaterialType&&d.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(d){return d.extendMaterialParams&&d.extendMaterialParams(e,r)})))}o.doubleSided===!0&&(r.side=is);const u=o.alphaMode||lt.OPAQUE;if(u===lt.BLEND?(r.transparent=!0,r.depthWrite=!1):(r.transparent=!1,u===lt.MASK&&(r.alphaTest=o.alphaCutoff!==void 0?o.alphaCutoff:.5)),o.normalTexture!==void 0&&i!==se&&(l.push(t.assignTexture(r,"normalMap",o.normalTexture)),r.normalScale=new M(1,1),o.normalTexture.scale!==void 0)){const h=o.normalTexture.scale;r.normalScale.set(h,h)}if(o.occlusionTexture!==void 0&&i!==se&&(l.push(t.assignTexture(r,"aoMap",o.occlusionTexture)),o.occlusionTexture.strength!==void 0&&(r.aoMapIntensity=o.occlusionTexture.strength)),o.emissiveFactor!==void 0&&i!==se){const h=o.emissiveFactor;r.emissive=new U().setRGB(h[0],h[1],h[2],V)}return o.emissiveTexture!==void 0&&i!==se&&l.push(t.assignTexture(r,"emissiveMap",o.emissiveTexture,z)),Promise.all(l).then(function(){const h=new i(r);return o.name&&(h.name=o.name),W(h,o),t.associations.set(h,{materials:e}),o.extensions&&te(n,h,o),h})}createUniqueName(e){const t=zs.sanitizeNodeName(e||"");return t in this.nodeNamesUsed?t+"_"+ ++this.nodeNamesUsed[t]:(this.nodeNamesUsed[t]=0,t)}loadGeometries(e){const t=this,s=this.extensions,n=this.primitiveCache;function o(r){return s[y.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(r,t).then(function(c){return Vt(c,r,t)})}const i=[];for(let r=0,c=e.length;r<c;r++){const l=e[r],u=ri(l),h=n[u];if(h)i.push(h.promise);else{let d;l.extensions&&l.extensions[y.KHR_DRACO_MESH_COMPRESSION]?d=o(l):d=Vt(new Qt,l,t),n[u]={primitive:l,promise:d},i.push(d)}}return Promise.all(i)}loadMesh(e){const t=this,s=this.json,n=this.extensions,o=s.meshes[e],i=o.primitives,r=[];for(let c=0,l=i.length;c<l;c++){const u=i[c].material===void 0?ni(this.cache):this.getDependency("material",i[c].material);r.push(u)}return r.push(t.loadGeometries(i)),Promise.all(r).then(function(c){const l=c.slice(0,c.length-1),u=c[c.length-1],h=[];for(let f=0,m=u.length;f<m;f++){const g=u[f],p=i[f];let _;const T=l[f];if(p.mode===N.TRIANGLES||p.mode===N.TRIANGLE_STRIP||p.mode===N.TRIANGLE_FAN||p.mode===void 0)_=o.isSkinnedMesh===!0?new Ks(g,T):new Le(g,T),_.isSkinnedMesh===!0&&_.normalizeSkinWeights(),p.mode===N.TRIANGLE_STRIP?_.geometry=Bt(_.geometry,$t):p.mode===N.TRIANGLE_FAN&&(_.geometry=Bt(_.geometry,gt));else if(p.mode===N.LINES)_=new Vs(g,T);else if(p.mode===N.LINE_STRIP)_=new Xs(g,T);else if(p.mode===N.LINE_LOOP)_=new Ys(g,T);else if(p.mode===N.POINTS)_=new Ws(g,T);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+p.mode);Object.keys(_.geometry.morphAttributes).length>0&&oi(_,o),_.name=t.createUniqueName(o.name||"mesh_"+e),W(_,o),p.extensions&&te(n,_,p),t.assignFinalMaterial(_),h.push(_)}for(let f=0,m=h.length;f<m;f++)t.associations.set(h[f],{meshes:e,primitives:f});if(h.length===1)return o.extensions&&te(n,h[0],o),h[0];const d=new it;o.extensions&&te(n,d,o),t.associations.set(d,{meshes:e});for(let f=0,m=h.length;f<m;f++)d.add(h[f]);return d})}loadCamera(e){let t;const s=this.json.cameras[e],n=s[s.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new os(Ne.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):s.type==="orthographic"&&(t=new qs(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),W(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s=[];for(let n=0,o=t.joints.length;n<o;n++)s.push(this._loadNodeShallow(t.joints[n]));return t.inverseBindMatrices!==void 0?s.push(this.getDependency("accessor",t.inverseBindMatrices)):s.push(null),Promise.all(s).then(function(n){const o=n.pop(),i=n,r=[],c=[];for(let l=0,u=i.length;l<u;l++){const h=i[l];if(h){r.push(h);const d=new Ue;o!==null&&d.fromArray(o.array,l*16),c.push(d)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',t.joints[l])}return new Zs(r,c)})}loadAnimation(e){const t=this.json,s=this,n=t.animations[e],o=n.name?n.name:"animation_"+e,i=[],r=[],c=[],l=[],u=[];for(let h=0,d=n.channels.length;h<d;h++){const f=n.channels[h],m=n.samplers[f.sampler],g=f.target,p=g.node,_=n.parameters!==void 0?n.parameters[m.input]:m.input,T=n.parameters!==void 0?n.parameters[m.output]:m.output;g.node!==void 0&&(i.push(this.getDependency("node",p)),r.push(this.getDependency("accessor",_)),c.push(this.getDependency("accessor",T)),l.push(m),u.push(g))}return Promise.all([Promise.all(i),Promise.all(r),Promise.all(c),Promise.all(l),Promise.all(u)]).then(function(h){const d=h[0],f=h[1],m=h[2],g=h[3],p=h[4],_=[];for(let T=0,E=d.length;T<E;T++){const x=d[T],H=f[T],Z=m[T],j=g[T],me=p[T];if(x===void 0)continue;x.updateMatrix&&x.updateMatrix();const J=s._createAnimationTracks(x,H,Z,j,me);if(J)for(let st=0;st<J.length;st++)_.push(J[st])}return new Js(o,void 0,_)})}createNodeMesh(e){const t=this.json,s=this,n=t.nodes[e];return n.mesh===void 0?null:s.getDependency("mesh",n.mesh).then(function(o){const i=s._getNodeRef(s.meshCache,n.mesh,o);return n.weights!==void 0&&i.traverse(function(r){if(r.isMesh)for(let c=0,l=n.weights.length;c<l;c++)r.morphTargetInfluences[c]=n.weights[c]}),i})}loadNode(e){const t=this.json,s=this,n=t.nodes[e],o=s._loadNodeShallow(e),i=[],r=n.children||[];for(let l=0,u=r.length;l<u;l++)i.push(s.getDependency("node",r[l]));const c=n.skin===void 0?Promise.resolve(null):s.getDependency("skin",n.skin);return Promise.all([o,Promise.all(i),c]).then(function(l){const u=l[0],h=l[1],d=l[2];d!==null&&u.traverse(function(f){f.isSkinnedMesh&&f.bind(d,ci)});for(let f=0,m=h.length;f<m;f++)u.add(h[f]);return u})}_loadNodeShallow(e){const t=this.json,s=this.extensions,n=this;if(this.nodeCache[e]!==void 0)return this.nodeCache[e];const o=t.nodes[e],i=o.name?n.createUniqueName(o.name):"",r=[],c=n._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&r.push(c),o.camera!==void 0&&r.push(n.getDependency("camera",o.camera).then(function(l){return n._getNodeRef(n.cameraCache,o.camera,l)})),n._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){r.push(l)}),this.nodeCache[e]=Promise.all(r).then(function(l){let u;if(o.isBone===!0?u=new Qs:l.length>1?u=new it:l.length===1?u=l[0]:u=new es,u!==l[0])for(let h=0,d=l.length;h<d;h++)u.add(l[h]);if(o.name&&(u.userData.name=o.name,u.name=i),W(u,o),o.extensions&&te(s,u,o),o.matrix!==void 0){const h=new Ue;h.fromArray(o.matrix),u.applyMatrix4(h)}else o.translation!==void 0&&u.position.fromArray(o.translation),o.rotation!==void 0&&u.quaternion.fromArray(o.rotation),o.scale!==void 0&&u.scale.fromArray(o.scale);return n.associations.has(u)||n.associations.set(u,{}),n.associations.get(u).nodes=e,u}),this.nodeCache[e]}loadScene(e){const t=this.extensions,s=this.json.scenes[e],n=this,o=new it;s.name&&(o.name=n.createUniqueName(s.name)),W(o,s),s.extensions&&te(t,o,s);const i=s.nodes||[],r=[];for(let c=0,l=i.length;c<l;c++)r.push(n.getDependency("node",i[c]));return Promise.all(r).then(function(c){for(let u=0,h=c.length;u<h;u++)o.add(c[u]);const l=u=>{const h=new Map;for(const[d,f]of n.associations)(d instanceof nt||d instanceof kt)&&h.set(d,f);return u.traverse(d=>{const f=n.associations.get(d);f!=null&&h.set(d,f)}),h};return n.associations=l(o),o})}_createAnimationTracks(e,t,s,n,o){const i=[],r=e.name?e.name:e.uuid,c=[];Q[o.path]===Q.weights?e.traverse(function(d){d.morphTargetInfluences&&c.push(d.name?d.name:d.uuid)}):c.push(r);let l;switch(Q[o.path]){case Q.weights:l=Ft;break;case Q.rotation:l=Ut;break;case Q.translation:case Q.scale:l=Nt;break;default:switch(s.itemSize){case 1:l=Ft;break;case 2:case 3:default:l=Nt;break}break}const u=n.interpolation!==void 0?si[n.interpolation]:rs,h=this._getArrayFromAccessor(s);for(let d=0,f=c.length;d<f;d++){const m=new l(c[d]+"."+Q[o.path],t.array,h,u);n.interpolation==="CUBICSPLINE"&&this._createCubicSplineTrackInterpolant(m),i.push(m)}return i}_getArrayFromAccessor(e){let t=e.array;if(e.normalized){const s=yt(t.constructor),n=new Float32Array(t.length);for(let o=0,i=t.length;o<i;o++)n[o]=t[o]*s;t=n}return t}_createCubicSplineTrackInterpolant(e){e.createInterpolant=function(s){const n=this instanceof Ut?ti:ls;return new n(this.times,this.values,this.getValueSize()/3,s)},e.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0}}function ui(a,e,t){const s=e.attributes,n=new nn;if(s.POSITION!==void 0){const r=t.json.accessors[s.POSITION],c=r.min,l=r.max;if(c!==void 0&&l!==void 0){if(n.set(new w(c[0],c[1],c[2]),new w(l[0],l[1],l[2])),r.normalized){const u=yt(he[r.componentType]);n.min.multiplyScalar(u),n.max.multiplyScalar(u)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const o=e.targets;if(o!==void 0){const r=new w,c=new w;for(let l=0,u=o.length;l<u;l++){const h=o[l];if(h.POSITION!==void 0){const d=t.json.accessors[h.POSITION],f=d.min,m=d.max;if(f!==void 0&&m!==void 0){if(c.setX(Math.max(Math.abs(f[0]),Math.abs(m[0]))),c.setY(Math.max(Math.abs(f[1]),Math.abs(m[1]))),c.setZ(Math.max(Math.abs(f[2]),Math.abs(m[2]))),d.normalized){const g=yt(he[d.componentType]);c.multiplyScalar(g)}r.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(r)}a.boundingBox=n;const i=new on;n.getCenter(i.center),i.radius=n.min.distanceTo(n.max)/2,a.boundingSphere=i}function Vt(a,e,t){const s=e.attributes,n=[];function o(i,r){return t.getDependency("accessor",i).then(function(c){a.setAttribute(r,c)})}for(const i in s){const r=_t[i]||i.toLowerCase();r in a.attributes||n.push(o(s[i],r))}if(e.indices!==void 0&&!a.index){const i=t.getDependency("accessor",e.indices).then(function(r){a.setIndex(r)});n.push(i)}return mt.workingColorSpace!==V&&"COLOR_0"in s&&console.warn(`THREE.GLTFLoader: Converting vertex colors from "srgb-linear" to "${mt.workingColorSpace}" not supported.`),W(a,e),ui(a,e,t),Promise.all(n).then(function(){return e.targets!==void 0?ii(a,e.targets,t):a})}const hi=`varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,di=`uniform sampler2D uTextureA;
uniform sampler2D uTextureB;
uniform float uBrightness;
uniform float uContrast;
uniform float uMix;
uniform float uAberrationAmount; // Add this uniform in JS
varying vec2 vUv;

void main() {
  // Chromatic offset vector (can be radial, here it's a fixed offset)
  vec2 offset = vec2(uAberrationAmount);

  // Sample each channel at slightly different UVs
  vec4 texA = vec4(
    texture2D(uTextureA, vUv + offset).r,   // Red
    texture2D(uTextureA, vUv).g,            // Green
    texture2D(uTextureA, vUv - offset).b,   // Blue
    1.0
  );

  vec4 texB = vec4(
    texture2D(uTextureB, vUv + offset).r,
    texture2D(uTextureB, vUv).g,
    texture2D(uTextureB, vUv - offset).b,
    1.0
  );

  vec4 mixed = mix(texA, texB, uMix);

  // Apply brightness and contrast
  mixed.rgb = (mixed.rgb - 0.5) * uContrast + 0.5;
  mixed.rgb *= uBrightness;

  gl_FragColor = mixed;
}`,fi=`varying vec2 vUv;

void main() {
  vUv = uv - 0.5;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,pi=`varying vec2 vUv;
uniform float uSize;
uniform vec3 uLineColor;

float gridLine(float coord, float size) {
  float line = abs(fract(coord * size) - 0.5);
  return smoothstep(0.05, 0.0, line); // smooth lines
}

void main() {
  float dist = length(vUv) * 2.0;
  float alpha = smoothstep(1.0, 0.5, dist);

  float xLine = gridLine(vUv.x, uSize);
  float yLine = gridLine(vUv.y, uSize);
  float lineStrength = max(xLine, yLine);

  gl_FragColor = vec4(uLineColor, alpha * lineStrength * 0.1);
}`,mi=`uniform float uTime;
uniform sampler2D uPerlinTexture;

varying vec2 vUv;

vec2 rotate2D(vec2 pos, float angle) {
  float s = sin(angle);
  float c = cos(angle);
  return mat2(c, -s, s, c) * pos;
}

void main() {
  vec3 newPosition = position;

  float twistPerlin = texture(uPerlinTexture, vec2(0.5, uv.y * 0.2 - uTime * 0.01)).r;
  float angle = twistPerlin * 3.0;
  newPosition.xz = rotate2D(newPosition.xz, angle);

  vec2 windOffset = vec2(
    texture(uPerlinTexture, vec2(0.25, uTime * 0.01)).r - 0.5,
    texture(uPerlinTexture, vec2(0.75, uTime * 0.01)).r - 0.5
  );
  windOffset *= pow(uv.y, 2.0) * 1.5;
  newPosition.xz += windOffset;

  gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
  vUv = uv;
}`,gi=`uniform float uTime;
uniform sampler2D uPerlinTexture;
uniform vec3 uColor;

varying vec2 vUv;

void main() {
  vec2 smokeUv = vUv;
  smokeUv.x *= 0.5;
  smokeUv.y *= 0.3;
  smokeUv.y -= uTime * 0.04;

  float smoke = texture(uPerlinTexture, smokeUv).r;
  smoke = smoothstep(0.5, 1.0, smoke);

  smoke *= smoothstep(0.0, 0.1, vUv.x);
  smoke *= smoothstep(1.0, 0.9, vUv.x);
  smoke *= smoothstep(0.0, 0.1, vUv.y);
  smoke *= smoothstep(1.0, 0.4, vUv.y);

/* gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0); */
gl_FragColor = vec4(uColor, smoke);
}`,_i=`varying vec2 vUv;

void main() {
  vUv = uv;
  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
}`,yi=`uniform vec3 uColor;
varying vec2 vUv;

void main() {
  float fade = smoothstep(0.0, 0.3, vUv.x) * (1.0 - smoothstep(0.7, 1.0, vUv.x));
  fade *= smoothstep(0.0, 0.3, vUv.y) * (1.0 - smoothstep(0.7, 1.0, vUv.y));
  gl_FragColor = vec4(uColor, fade * 0.3);
}`,Ti=document.querySelector("#experience-canvas"),P={width:window.innerWidth,height:window.innerHeight},Xt=new hn,Ee=new M,K=new rn;let I=!1,ce=!1,L=!1,re=!1;const us=[],hs=[],ds=[];let je,He,Be,Ge,k,bt,Et,Rt,Lt,At,Dt,vt,St,Mt,ve=0,Se=0;const de=[];let B=[],Y=null,C=0,ye=1,D,ne,ht=!0;const dt=new w(0,0,-.5),Me={work:document.querySelector(".modal.work"),about:document.querySelector(".modal.about"),contact:document.querySelector(".modal.contact"),legal:document.querySelector(".modal.legal")},fs=document.getElementById("loading-text"),xi=document.getElementById("progress-bar"),ze=document.getElementById("enter-button"),Pe=document.getElementById("loading-screen"),Ke=document.getElementById("enter-button-mute"),We=new an;let ps=!1;We.onProgress=(a,e,t)=>{const s=Math.floor(e/t*100);A.to(xi,{value:s,duration:.3,ease:"power1.out"}),A.to(fs,{textContent:`Loading ${e} of ${t}...`,duration:.3,ease:"none"})};We.onLoad=()=>{ps=!0,fs.textContent="Loaded!",ze.disabled=!1,Ke.disabled=!1,ze.classList.add("active"),Ke.classList.add("active")};function qe(a=!0){A.timeline({onComplete:()=>{re=!0,Pe.remove(),Di()}}).to(Pe,{transformOrigin:"center center",rotationX:10,rotationY:-5,scale:1.02,y:"-2vh",duration:.4,ease:"power2.out"}).to(Pe,{rotationX:-5,rotationY:5,scale:.95,y:"1vh",duration:.3,ease:"power1.inOut"}).to(Pe,{rotationX:70,rotationY:-25,scale:.05,x:"20vw",y:"-250vh",opacity:0,duration:1.2,ease:"expo.in"}).to(".white-overlay",{opacity:.7,duration:.35,ease:"sine.inOut",yoyo:!0,repeat:1},"-=0.8"),a&&(F.play(),F.volume=.4,L=!0,ae.src="/icon/music_note_124dp_3B3935_FILL0_wght700_GRAD-25_opsz48.svg")}ze.addEventListener("touchend",a=>{I=!0,a.preventDefault(),F.play(),F.volume=.4,L=!0,ae.src="/icon/music_note_124dp_3B3935_FILL0_wght700_GRAD-25_opsz48.svg",re=!0,qe(!0)},{passive:!1});ze.addEventListener("click",a=>{I||(a.preventDefault(),F.play(),F.volume=.4,L=!0,ae.src="/icon/music_note_124dp_3B3935_FILL0_wght700_GRAD-25_opsz48.svg",re=!0,qe(!0))},{passive:!1});Ke.addEventListener("touchend",a=>{I=!0,a.preventDefault(),L=!1,re=!0,qe(!1)},{passive:!1});Ke.addEventListener("click",a=>{I||(a.preventDefault(),L=!1,re=!0,qe(!1))},{passive:!1});document.addEventListener("DOMContentLoaded",function(){localStorage.getItem("theme")==="night"?(O=!0,document.documentElement.setAttribute("data-theme","night"),fe.src="/icon/dark_mode_124dp_3B3935_FILL0_wght700_GRAD200_opsz48.svg",Re("night")):(O=!1,document.documentElement.removeAttribute("data-theme"),fe.src="/icon/light_mode_124dp_3B3935_FILL0_wght700_GRAD200_opsz48.svg",Re("day"));const e=document.getElementById("tip-text");"ontouchstart"in window||navigator.maxTouchPoints>0?e.textContent="💡 Tip: Tap and swipe to explore.":e.textContent="💡 Tip: Click and drag to explore."});const Ze=document.getElementById("theme-toggle"),fe=document.getElementById("theme-icon");let O=!1;Ze.addEventListener("touchend",a=>{I=!0,a.preventDefault(),O=!O,Re(O?"night":"day"),O?(document.documentElement.setAttribute("data-theme","night"),fe.src="/icon/dark_mode_124dp_3B3935_FILL0_wght700_GRAD200_opsz48.svg"):(document.documentElement.removeAttribute("data-theme"),fe.src="/icon/light_mode_124dp_3B3935_FILL0_wght700_GRAD200_opsz48.svg"),localStorage.setItem("theme",O?"night":"day")},{passive:!1});Ze.addEventListener("click",a=>{I||(a.preventDefault(),O=!O,Re(O?"night":"day"),O?(document.documentElement.setAttribute("data-theme","night"),fe.src="/icon/dark_mode_124dp_3B3935_FILL0_wght700_GRAD200_opsz48.svg"):(document.documentElement.removeAttribute("data-theme"),fe.src="/icon/light_mode_124dp_3B3935_FILL0_wght700_GRAD200_opsz48.svg"),localStorage.setItem("theme",O?"night":"day"))},{passive:!1});const G=new Audio;G.volume=.7;G.preload="auto";const Ie=new Audio("/audio/sound/403007__inspectorj__ui-confirmation-alert-a2.ogg"),Yt=new Audio("/audio/sound/770169__j1cr0wav3__itemcollect.ogg"),F=document.getElementById("bg-music"),ae=document.getElementById("music-icon"),Je=document.getElementById("music-toggle");Je.addEventListener("touchend",a=>{I=!0,a.preventDefault(),L=!L,L?(F.play(),F.volume=.4,ae.src="/icon/music_note_124dp_3B3935_FILL0_wght700_GRAD-25_opsz48.svg"):(F.pause(),ae.src="/icon/music_off_124dp_3B3935_FILL0_wght700_GRAD-25_opsz48.svg"),G.muted=!L,L||G.pause()},{passive:!1});Je.addEventListener("click",a=>{I||(a.preventDefault(),L=!L,L?(F.play(),F.volume=.4,ae.src="/icon/music_note_124dp_3B3935_FILL0_wght700_GRAD-25_opsz48.svg"):(F.pause(),ae.src="/icon/music_off_124dp_3B3935_FILL0_wght700_GRAD-25_opsz48.svg"),G.muted=!L,L||G.pause())},{passive:!1});const ms=document.getElementById("experience"),Ce=a=>{a.classList.remove("hidden"),ce=!0,v.enabled=!1,ms.classList.add("blur"),Qe.style.display="block",Je.classList.add("hidden"),Ze.classList.add("hidden"),$e.classList.add("hidden"),de.forEach(e=>{e.userData&&e.userData.hoverTimeline&&(e.userData.hoverDisabled=!0)}),document.body.style.cursor="default",B=[],A.set(a,{scaleY:0,scaleX:1,opacity:0,transformOrigin:"center center"}),A.to(a,{scaleY:1,opacity:1,duration:.5,ease:"power3.out"})},Ve=a=>{ce=!1,v.enabled=!0,ms.classList.remove("blur"),Qe.style.display="none",Je.classList.remove("hidden"),Ze.classList.remove("hidden"),$e.classList.remove("hidden"),de.forEach(e=>{e.userData&&e.userData.hoverTimeline&&(e.userData.hoverDisabled=!1)}),A.to(a,{scaleY:0,opacity:0,duration:.4,ease:"power2.in",onComplete:()=>{a.classList.add("hidden")}})},Qe=document.querySelector(".overlay");Qe.addEventListener("touchend",a=>{I=!0,a.preventDefault();const e=document.querySelector(".modal:not(.hidden)");ce&&e&&Ve(e)},{passive:!1});Qe.addEventListener("click",a=>{if(I)return;a.preventDefault();const e=document.querySelector(".modal:not(.hidden)");ce&&e&&Ve(e)},{passive:!1});window.addEventListener("DOMContentLoaded",()=>{const a="ontouchstart"in window||navigator.maxTouchPoints>0;document.body.classList.toggle("no-touch",!a)});const wi=[{position:new w(-5.5,8,14.7),target:new w(-0,2,-.9)},{position:new w(1.2,5.1,6.2),target:new w(-.2,2,-.8)},{position:new w(-.8,6.1,6.6),target:new w(2,5,2.6)}],bi=[{position:new w(-12.9,8.5,20.5),target:new w(.3,2.6,-.5)},{position:new w(1,4.7,6.3),target:new w(-.3,1.6,-.6)},{position:new w(-1.1,3.6,6.6),target:new w(1.8,3.6,2.6)}],Ei=window.innerWidth<768,Wt=Ei?bi:wi;let we=1;const $e=document.getElementById("camera-toggle");function gs(){const{position:a,target:e}=Wt[we];Ri(a,e),we=(we+1)%Wt.length}$e.addEventListener("click",a=>{a.preventDefault(),gs()});$e.addEventListener("touchend",a=>{I=!0,a.preventDefault(),gs()},{passive:!1});function Ri(a,e){A.to(ee.position,{x:a.x,y:a.y,z:a.z,duration:2,ease:"power2.inOut"}),A.to(v.target,{x:e.x,y:e.y,z:e.z,duration:2,ease:"power2.inOut",onUpdate:()=>v.update()})}let ft=!1,_e=null,Oe=!1;const ee=new os(35,P.width/P.height,.1,200),pe=new cn({canvas:Ti,antialias:!0});pe.setSize(P.width,P.height);pe.setPixelRatio(Math.min(window.devicePixelRatio,2));const v=new mn(ee,pe.domElement);v.minDistance=5;v.maxDistance=45;v.minPolarAngle=0;v.maxPolarAngle=Math.PI/2;v.minAzimuthAngle=-1/0;v.maxAzimuthAngle=1/0;v.enableDamping=!0;v.dampingFactor=.05;v.update();window.innerWidth<768?(ee.position.set(-12.9,8.5,20.5),v.target.set(.3,2.6,-.5)):(ee.position.set(-5.5,8,14.7),v.target.set(-0,2,-.9));window.addEventListener("resize",()=>{P.width=window.innerWidth,P.height=window.innerHeight,ee.aspect=P.width/P.height,ee.updateProjectionMatrix(),pe.setSize(P.width,P.height),pe.setPixelRatio(Math.min(window.devicePixelRatio,2))});window.addEventListener("mousemove",a=>{I=!1,Ee.x=a.clientX/P.width*2-1,Ee.y=-(a.clientY/P.height)*2+1});window.addEventListener("touchstart",a=>{ce||(a.preventDefault(),Ee.x=a.touches[0].clientX/P.width*2-1,Ee.y=-(a.touches[0].clientY/P.height)*2+1)},{passive:!1});function _s(){var t;if(B&&B.length>0){const s=B[0].object;s.userData.clickTimeline&&s.userData.clickTimeline.restart(),s.name.includes("workbtn")?Ce(Me.work):s.name.includes("aboutbtn")?Ce(Me.about):s.name.includes("contactbtn")?Ce(Me.contact):s.name.includes("legalbtn")&&Ce(Me.legal)}if(!B||B.length===0)return;const a=B[0].object;if(a.name.includes("monitor")&&C<3&&(L&&C<3&&(Ie.currentTime=0,Ie.play()),ye=C+1,(t=D==null?void 0:D.material)!=null&&t.uniforms)){const s=D.material.uniforms;s.uTextureA.value=q[C],s.uTextureB.value=q[ye],s.uMix.value=0,A.to(s.uMix,{value:1,duration:.5,ease:"power2.inOut",onComplete:()=>{C=ye,s.uTextureA.value=q[C],s.uTextureB.value=q[C],s.uMix.value=0}})}const e=a.name.match(/DJ[1-9]/);if(e){const n=`/audio/DJ/${e[0]}.ogg`;L&&(G.src.endsWith(n)||(G.src=n),G.currentTime=0,G.play())}if(a.name.includes("pcbtn")&&D&&D.material&&D.material.uniforms){C=0,ye=1;const s=D.material.uniforms;s.uTextureA.value=q[C],s.uTextureB.value=q[C],s.uMix.value=0,L&&(Ie.currentTime=0,Ie.play())}if(a.name.includes("slider")&&ne){L&&(Yt.currentTime=0,Yt.play());const s=ne.userData.originalPosition;ht?A.to(ne.position,{x:s.x+dt.x,y:s.y+dt.y,z:s.z+dt.z,duration:.8,ease:"power2.inOut"}):A.to(ne.position,{x:s.x,y:s.y,z:s.z,duration:.8,ease:"power2.inOut"}),ht=!ht}(a.name.includes("slider")||a.name.includes("pcbtn")||a.name.includes("DJ"))&&(a.userData.originalColor||(a.userData.originalColor=a.material.color.clone()),A.to(a.material.color,{r:1,g:3,b:1,duration:.2,yoyo:!0,repeat:1,onComplete:()=>{a.material.color.copy(a.userData.originalColor)}}))}window.addEventListener("touchend",a=>{ce||(a.preventDefault(),_s())},{passive:!1});window.addEventListener("click",_s);document.querySelectorAll(".modal-exit-button").forEach(a=>{a.addEventListener("touchend",e=>{I=!0;const t=e.target.closest(".modal");Ve(t)},{passive:!1}),a.addEventListener("click",e=>{if(I)return;const t=e.target.closest(".modal");Ve(t)},{passive:!1})});const ie=new ts(We),ys={terrain:{day:"/textures/terrain_texture.webp",night:"/textures/night-texture/terrain_texture_night.webp"},other:{day:"/textures/other_texture.webp",night:"/textures/night-texture/other_texture_night.webp"},pcwei:{day:"/textures/pcwei_texture.webp",night:"/textures/night-texture/pcwei_texture_night.webp"}},q=[ie.load("/textures/monitor/monitor_A_texture.webp"),ie.load("/textures/monitor/monitor_B_texture.webp"),ie.load("/textures/monitor/monitor_C_texture.webp"),ie.load("/textures/monitor/monitor_D_texture.webp")];q.forEach(a=>{a.flipY=!1});const oe={day:{},night:{}};Object.entries(ys).forEach(([a,e])=>{const t=ie.load(e.day);t.flipY=!1,t.colorSpace=z,t.minFilter=$,t.magFilter=$,oe.day[a]=t;const s=ie.load(e.night);s.flipY=!1,s.colorSpace=z,s.minFilter=$,s.magFilter=$,oe.night[a]=s});const Ts=new vn;Ts.setDecoderPath("/draco/");const xs=new Mn(We);xs.setDRACOLoader(Ts);const Li={default:{scale:[1.2,1.2,1.2],position:[0,0,0],rotation:[0,-Math.PI/8,0]},v2:{scale:[1.1,1.5,1.1],position:[0,.05,0],rotation:[0,Math.PI/18,0]},v3:{scale:[1.2,1.5,1.2],position:[0,0,0],rotation:[0,0,0]},DJ:{scale:[1.2,1.2,1.2],position:[0,0,0],rotation:[0,Math.PI/3,0]},slider:{scale:[1.1,1.2,1.1],position:[0,0,0],rotation:[0,0,0]},pcbtn:{scale:[1.2,1.1,1.1],position:[0,0,0],rotation:[0,0,0]},Tthings:{scale:[1.2,1,1.2],position:[0,0,0],rotation:[0,0,0]}},Ai={DJ:{scale:[1,1.5,1],position:[0,-.03,0],duration:.3,easeOut:"elastic.out(1, 0.3)"},pcbtn:{scale:[1,1,1],position:[0,0,-.02],duration:.3,easeOut:"elastic.out(1, 0.3)"}};xs.load("/models/desert.glb",a=>{const e=a.scene;K.userData.modelRoot=e;const t=new ln().setPath("/textures/skymap/").load(["px.webp","nx.webp","py.webp","ny.webp","pz.webp","nz.webp"]);K.environment=t,a.scene.traverse(s=>{if(!s.isMesh)return;const n=s.name;if(Object.keys(ys).forEach(i=>{n.includes(i)&&(s.material=new se({map:oe.day[i]}),s.material.map.minFilter=$,s.userData.textureKey=i)}),n.includes("pcwei")){const i="pcwei";s.material=new xt({map:oe.day[i],metalness:.9,roughness:.2,envMap:t,envMapIntensity:3}),s.userData.textureKey=i}if(n.includes("slider")&&(ne=s,s.userData.originalPosition=s.position.clone(),de.push(s)),n.includes("cloud")){const i="other";s.material=new se({map:oe.day[i],transparent:!0,opacity:.7,depthWrite:!1}),s.userData.textureKey=i,us.push({mesh:s,baseY:s.position.y,floatSpeed:Math.random()*.1+.05,floatOffset:Math.random()*Math.PI*2,rotationSpeed:Math.random()*2e-4+5e-5})}if(n.includes("roA")&&hs.push({mesh:s}),n.includes("raB")&&ds.push({mesh:s}),n.includes("raycaster")&&de.push(s),n.includes("monitor")&&(D=s,s.material=new Xe({uniforms:{uTextureA:{value:q[C]},uTextureB:{value:q[ye]},uBrightness:{value:0},uContrast:{value:0},uMix:{value:0},uAberrationAmount:{value:.01}},vertexShader:hi,fragmentShader:di})),(n.includes("DJ")||n.includes("slider")||n.includes("pcbtn")||n.includes("workbtn")||n.includes("aboutbtn")||n.includes("contactbtn")||n.includes("legalbtn"))&&(s.userData.initialScaleForIntro=s.scale.clone(),s.scale.set(0,0,0)),n.includes("DJ")||n.includes("pcbtn")){let i=n.includes("DJ")?"DJ":"pcbtn";const r=Ai[i],c=s.userData.initialScaleForIntro||s.scale,[l,u,h]=r.scale,[d,f,m]=r.position,g=s.position.clone(),p=A.timeline({paused:!0});p.to(s.scale,{x:c.x*l,y:c.y*u,z:c.z*h,duration:r.duration*.5,ease:"power2.in"}),p.to(s.position,{x:g.x+d,y:g.y+f,z:g.z+m,duration:r.duration*.5,ease:"power2.out"},0),p.to(s.scale,{x:c.x,y:c.y,z:c.z,duration:r.duration,ease:r.easeOut}),p.to(s.position,{x:g.x,y:g.y,z:g.z,duration:r.duration,ease:r.easeOut},`-=${r.duration}`),s.userData.clickTimeline=p,de.push(s)}if(n.includes("workbtn")&&(je=s),n.includes("contactbtn")&&(He=s),n.includes("aboutbtn")&&(Be=s),n.includes("legalbtn")&&(Ge=s),n.includes("pcbtn")&&(k=s),n.includes("DJ1")&&(bt=s),n.includes("DJ2")&&(Et=s),n.includes("DJ3")&&(Rt=s),n.includes("DJ4")&&(Lt=s),n.includes("DJ5")&&(At=s),n.includes("DJ6")&&(Dt=s),n.includes("DJ7")&&(vt=s),n.includes("DJ8")&&(St=s),n.includes("DJ9")&&(Mt=s),n.includes("DJ")||n.includes("slider")||n.includes("pcbtn")||n.includes("workbtn")||n.includes("aboutbtn")||n.includes("contactbtn")||n.includes("legalbtn")||n.includes("hover")){s.userData.initialScale=s.userData.initialScaleForIntro?s.userData.initialScaleForIntro.clone():s.scale.clone(),s.userData.initialPosition=s.position.clone(),s.userData.initialRotation=s.rotation.clone();let i="default";n.includes("v2")?i="v2":n.includes("v3")?i="v3":n.includes("DJ")?i="DJ":n.includes("Tthings")?i="Tthings":n.includes("slider")?i="slider":n.includes("pcbtn")&&(i="pcbtn");const r=Li[i],[c,l,u]=r.scale,[h,d,f]=r.position,[m,g,p]=r.rotation,_=A.timeline({paused:!0});_.to(s.scale,{x:s.userData.initialScale.x*c,y:s.userData.initialScale.y*l,z:s.userData.initialScale.z*u,duration:.3,ease:"power2.out"},0),_.to(s.position,{x:s.userData.initialPosition.x+h,y:s.userData.initialPosition.y+d,z:s.userData.initialPosition.z+f,duration:.3,ease:"power2.out"},0),_.to(s.rotation,{x:s.userData.initialRotation.x+m,y:s.userData.initialRotation.y+g,z:s.userData.initialRotation.z+p,duration:.3,ease:"power2.out"},0),s.userData.hoverTimeline=_}Re(O?"night":"day")}),K.add(e)});function Di(){A.timeline({defaults:{duration:.8,ease:"back.out(1.8)"}}).to(je.scale,{x:1,y:1,z:1}).to(Be.scale,{x:1,y:1,z:1},"-=0.6").to(He.scale,{x:1,y:1,z:1},"-=0.6").to(Ge.scale,{x:1,y:1,z:1},"-=0.6").eventCallback("onComplete",()=>e.play());const e=A.timeline({paused:!0,defaults:{duration:.8,ease:"back.out(1.8)"}});e.to(k.scale,{x:1,y:1,z:1}).to(ne.scale,{x:1,y:1,z:1},"-=0.6").to(bt.scale,{x:1,y:1,z:1},"-=0.6").to(Et.scale,{x:1,y:1,z:1},"-=0.6").to(Rt.scale,{x:1,y:1,z:1},"-=0.6").to(Lt.scale,{x:1,y:1,z:1},"-=0.6").to(At.scale,{x:1,y:1,z:1},"-=0.6").to(Dt.scale,{x:1,y:1,z:1},"-=0.6").to(vt.scale,{x:1,y:1,z:1},"-=0.6").to(St.scale,{x:1,y:1,z:1},"-=0.6").to(Mt.scale,{x:1,y:1,z:1},"-=0.6")}const Tt=100,qt=1,vi=new Ye(Tt,Tt,qt,qt),ws=new Xe({transparent:!0,uniforms:{uSize:{value:Tt},uLineColor:{value:new U(.2,.2,.2)}},vertexShader:fi,fragmentShader:pi}),Pt=new Le(vi,ws);Pt.rotation.x=-Math.PI/2;Pt.position.set(.5,-2.01,.5);K.add(Pt);const bs=new Xe({uniforms:{uColor:{value:new U(16711680)}},vertexShader:_i,fragmentShader:yi,transparent:!0,depthWrite:!1}),et=new Le(new Ye(100,.1),bs.clone());et.material.uniforms.uColor.value.set(16711680);et.rotation.x=-Math.PI/2;et.position.set(0,-2,0);K.add(et);const Ae=new Le(new Ye(100,.1),bs.clone());Ae.material.uniforms.uColor.value.set(65280);Ae.rotation.z=Math.PI/2;Ae.rotation.x=-Math.PI/2;Ae.position.set(0,-2,0);K.add(Ae);const tt=new Ye(2.5,8,16,64);tt.translate(-.5,5,-2);tt.scale(.5,.5,.5);tt.rotateY(-Math.PI/2.2);const It=ie.load("/shaders/perlin.png");It.wrapS=be;It.wrapT=be;const Ct=new Xe({uniforms:{uTime:new ot(0),uPerlinTexture:new ot(It),uColor:new ot(new U(1,1,1))},vertexShader:mi,fragmentShader:gi,side:is,transparent:!0,depthWrite:!1}),Es=new Le(tt,Ct);Es.position.set(0,2,0);K.add(Es);function Re(a){const e=K.userData.modelRoot;e&&(ws.uniforms.uLineColor.value.set(a==="night"?.4:.2,a==="night"?.4:.2,a==="night"?.4:.2),Ct.uniforms.uColor.value.set(a==="night"?.7:1,a==="night"?.3:1,a==="night"?.1:1),e.traverse(t=>{var n;if(!t.isMesh)return;const s=t.userData.textureKey;if(s&&((n=oe[a])!=null&&n[s])){const o=oe[a][s];t.material.map!==o&&(t.material.map=o,t.material.needsUpdate=!0)}}),K.background=new U(a==="night"?"#1a1a1a":"#c5dba7"))}const Si=new un;let Zt="default";function pt(a){a!==Zt&&(document.body.style.cursor=a,Zt=a)}const Rs=()=>{var n,o;v.update();const a=Si.getElapsedTime(),s=Ne.degToRad(180)+Math.sin(a*1.5)*Ne.degToRad(10/2);if(Ct.uniforms.uTime.value=a,us.forEach(i=>{const r=i.mesh;r.position.y=i.baseY+Math.sin(a*i.floatSpeed+i.floatOffset)*.5,r.rotation.y+=i.rotationSpeed}),hs.forEach(i=>{i.mesh.rotation.x=s}),ds.forEach(i=>{i.mesh.rotation.x=-s}),ps&&!ce){Xt.setFromCamera(Ee,ee),B=Xt.intersectObjects(de);let i=null,r=!1,c=!1,l=!1;if(B.length>0&&(i=B[0].object,r=i.name.includes("monitor"),c=i.name.includes("pointer"),l=i.name.includes("hover")),l&&!i.userData.hoverDisabled?i!==Y&&(Y&&Y.userData.hoverTimeline&&Y.userData.hoverTimeline.reverse(),i.userData.hoverTimeline&&i.userData.hoverTimeline.play(),Y=i):Y&&Y.userData.hoverTimeline&&(Y.userData.hoverTimeline.reverse(),Y=null),pt(r&&C===3?"not-allowed":c||r?"pointer":"default"),re&&((n=D==null?void 0:D.material)!=null&&n.uniforms)){const u=D.material.uniforms;ve+=(1-ve)*.05,Se+=(1-Se)*.05,u.uBrightness.value=ve,u.uContrast.value=Se,Math.abs(1-ve)<.01&&Math.abs(1-Se)<.01&&(u.uBrightness.value=1,u.uContrast.value=1,re=!1)}}if(k&&k.material&&(C===3?k.material.color.setRGB(4,2,2):(k.userData.originalColor||(k.userData.originalColor=k.material.color.clone()),k.material.color.copy(k.userData.originalColor))),we===2&&!ft&&(ft=!0,(o=D==null?void 0:D.material)!=null&&o.uniforms&&A.to(D.material.uniforms.uBrightness,{value:1.18,duration:.7,yoyo:!0,repeat:1,ease:"power1.inOut"}),[ne,k.userData.glowActive?null:k,bt,Et,Rt,Lt,At,Dt,vt,St,Mt].filter(Boolean).forEach(r=>{if(!(r!=null&&r.material))return;r.userData.originalColor||(r.userData.originalColor=r.material.color.clone());let c=r.name.includes("slider")?{r:3,g:3,b:3}:{r:1.5,g:1.5,b:1.5};A.to(r.material.color,{...c,duration:.7,yoyo:!0,repeat:1,onComplete:()=>{r.material.color.copy(r.userData.originalColor)}})}),setTimeout(()=>{ft=!1},1500)),we===0){if(!Oe){Oe=!0;const i=[je,He,Be,Ge];_e=A.timeline({repeat:-1,paused:!1}),i.forEach((r,c)=>{r!=null&&r.material&&(r.userData.originalColor||(r.userData.originalColor=r.material.color.clone()),_e.to(r.material.color,{r:1.7,g:1.7,b:1.7,duration:.7,yoyo:!0,repeat:1,ease:"power1.inOut",onComplete:()=>{r.material.color.copy(r.userData.originalColor)}},c*.3))})}}else Oe&&_e&&(_e.kill(),_e=null,Oe=!1,[je,He,Be,Ge].forEach(i=>{var r;(r=i==null?void 0:i.userData)!=null&&r.originalColor&&i.material.color.copy(i.userData.originalColor)}));pe.render(K,ee),requestAnimationFrame(Rs)};Rs();
